###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    10/Nov/2009  09:22:58 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components #
#                          \hal\target\CC2430EB\Hal_Sensor.c                  #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\p2p_test(coordinator)\CC2430DB\. #
#                          .\..\..\Tools\CC2430DB\f8wCoord.cfg" (-DCPU32MHZ   #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS           #
#                          "-DCONST=const __code" -DGENERIC=__generic) -f     #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\p2p_test(coordinator)\CC2430DB\..\. #
#                          .\..\Tools\CC2430DB\f8wConfig.cfg" (-DSECURE=0     #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Components\hal\targ #
#                          et\CC2430EB\Hal_Sensor.c" -D CC2430EB -D           #
#                          xREFLECTOR -D ZTOOL_P1 -D MT_TASK -D MT_ZDO_FUNC   #
#                          -D xLCD_SUPPORTED=DEBUG -D NV_RESTORE -lC          #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\p2p_test(coordinator)\CC2430DB\Coor #
#                          dinatorEB\List\" -lA "C:\Texas                     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\CoordinatorEB\ #
#                          List\" --diag_suppress Pe001,Pa010 --diag_remark   #
#                          pe550 -o "C:\Texas Instruments\ZStack-1.4.3-1.2.1\ #
#                          Projects\zstack\Samples\p2p_test(coordinator)\CC24 #
#                          30DB\CoordinatorEB\Obj\" -e --require_prototypes   #
#                          -z9 --no_code_motion --debug --core=plain          #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data --nr_virtual_regs 8  #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\p2p_test(coordinator)\CC2430DB\" #
#                           -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Proje #
#                          cts\zstack\Samples\p2p_test(coordinator)\CC2430DB\ #
#                          ..\SOURCE\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\ZMAIN #
#                          \TI2430DB\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MT\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\TARGET\CC2430EB\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\INCLUDE\" -I "C:\Texas            #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\AF\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\NWK\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SEC\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SYS\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\ZDO\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\F8W\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SADDR\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SDATA\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I   #
#                          "F:\Program Files\IAR Systems\Embedded Workbench   #
#                          4.0 Evaluation version\8051\INC\" -I "F:\Program   #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\p2p_test(coordinator)\CC2430DB\Coord #
#                          inatorEB\List\Hal_Sensor.lst                       #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\p2p_test(coordinator)\CC2430DB\Coord #
#                          inatorEB\Obj\Hal_Sensor.r51                        #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components\hal\target\CC2430EB\Hal_Sensor.c
      1          
      2          #include "hal_mcu.h"

   \                                 In  segment SFR_AN, at 0x8a
   \   unsigned char volatile __sfr P1IFG
   \                     P1IFG:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x8c
   \   unsigned char volatile __sfr PICTL
   \                     PICTL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x8d
   \   unsigned char volatile __sfr P1IEN
   \                     P1IEN:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x9a
   \   unsigned char volatile __sfr IEN2
   \                     IEN2:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xe8
   \   union <unnamed> volatile __sfr _A_IRCON2
   \                     _A_IRCON2:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf4
   \   unsigned char volatile __sfr P1SEL
   \                     P1SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf7
   \   unsigned char volatile __sfr P2INP
   \                     P2INP:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
      3          #include "hal_defs.h"
      4          #include "hal_types.h"
      5          #include "hal_drivers.h"
      6          #include "hal_adc.h"
      7          #include "OSAL.h"
      8          #include "Hal_Sensor.h"
      9          #include "p2p_test.h"
     10          
     11           extern uint8 p2p_msg[8];//the collect message
     12          
     13           extern uint16 shortaddr;
     14           extern uint16 fatheraddr;
     15           
     16          
     17          
     18          
     19          
     20          
     21          
     22          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     23          void HalSensorConfig ( void )
   \                     HalSensorConfig:
     24          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
     25              //HONGWAI SENSOR<<P1_2
     26           
     27            P2INP |= 0x40;    /* config the input mode to poll_down */
   \   000000   43F740       ORL     0xf7,#0x40
     28            P1SEL &= ~( InfraredSensorBit );   /* Set pin function to GPIO */
   \   000003   53F4FB       ANL     0xf4,#0xfb
     29            P1DIR &= ~( InfraredSensorBit );   /* Set pin direction to Input */
   \   000006   53FEFB       ANL     0xfe,#0xfb
     30            PICTL &= ~( IENBIT );   /* rising edge on input give interrupt */ 
   \   000009   538CFD       ANL     0x8c,#0xfd
     31            IEN2 |= 0x10;     /*enabled interrupt*/
   \   00000C   439A10       ORL     0x9a,#0x10
     32            P1IEN |= InfraredSensorBit;    /*enabled interrupt*/
   \   00000F   438D04       ORL     0x8d,#0x4
     33            P1IFG &= ~(InfraredSensorBit);
   \   000012   538AFB       ANL     0x8a,#0xfb
     34             //HONGWAI SENSOR>
     35            
     36            //YANWU SENSOR<<P1_3
     37              P1SEL &= ~( SmokeSensorBit );   /* Set pin function to GPIO */
   \   000015   53F4F7       ANL     0xf4,#0xf7
     38            //P1SEL &= 0xF7;
     39            P1DIR &= ~( SmokeSensorBit );   /* Set pin direction to Input */
   \   000018   53FEF7       ANL     0xfe,#0xf7
     40            //P1DIR &= 0xF7;
     41            IEN2 |= 0x10;     /*enabled interrupt*/
   \   00001B   439A10       ORL     0x9a,#0x10
     42            P1IEN |= SmokeSensorBit;    /*enabled interrupt*/
   \   00001E   438D08       ORL     0x8d,#0x8
     43            P1IFG &= ~(SmokeSensorBit);
   \   000021   538AF7       ANL     0x8a,#0xf7
     44            //YANWU SENSOR>
     45            
     46          
     47          }
   \   000024   02....       LJMP    ?BRET
   \   000027                REQUIRE IEN2
   \   000027                REQUIRE P1IFG
   \   000027                REQUIRE PICTL
   \   000027                REQUIRE P1IEN
   \   000027                REQUIRE P1SEL
   \   000027                REQUIRE P2INP
   \   000027                REQUIRE P1DIR
     48          
     49          
     50          /**************************************************************************************************
     51           * @fn      halProcessSensorInterrupt
     52           *
     53           * @brief   Checks to see if it's a valid Sensor interrupt,and send the data to the router 
     54           * 
     55           *
     56           * @param
     57           *
     58           * @return
     59           **************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     60          void halProcessSensorInterrupt (void)
   \                     halProcessSensorInterrupt:
     61          {   
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
     62          
     63              p2p_msg[0] = 0xFF;
   \   000004   74FF         MOV     A,#-0x1
   \   000006   90....       MOV     DPTR,#p2p_msg
   \   000009   F0           MOVX    @DPTR,A
     64             
     65                p2p_msg[1] = LO_UINT16(shortaddr);
   \   00000A   90....       MOV     DPTR,#shortaddr
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   90....       MOV     DPTR,#(p2p_msg + 1)
   \   000011   F0           MOVX    @DPTR,A
     66                p2p_msg[2] = HI_UINT16(shortaddr);
   \   000012   90....       MOV     DPTR,#(shortaddr + 1)
   \   000015   E0           MOVX    A,@DPTR
   \   000016   90....       MOV     DPTR,#(p2p_msg + 2)
   \   000019   F0           MOVX    @DPTR,A
     67                p2p_msg[3] = LO_UINT16(fatheraddr);
   \   00001A   90....       MOV     DPTR,#fatheraddr
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   90....       MOV     DPTR,#(p2p_msg + 3)
   \   000021   F0           MOVX    @DPTR,A
     68                p2p_msg[4] = HI_UINT16(fatheraddr);
   \   000022   90....       MOV     DPTR,#(fatheraddr + 1)
   \   000025   E0           MOVX    A,@DPTR
   \   000026   90....       MOV     DPTR,#(p2p_msg + 4)
   \   000029   F0           MOVX    @DPTR,A
     69             //改了跟p2p_test.c里面的一致   by luzi
     70               // p2p_msg[5]=0;//wendu
     71              
     72               // p2p_msg[6]=0;//shidu
     73                
     74                p2p_msg[5]=haltemp();//wendu   
   \   00002A                ; Setup parameters for call to function haltemp
   \   00002A   12....       LCALL   ??haltemp?relay
   \   00002D   E9           MOV     A,R1
   \   00002E   90....       MOV     DPTR,#(p2p_msg + 5)
   \   000031   F0           MOVX    @DPTR,A
     75                
     76                p2p_msg[6]=halhumi();//shidu
   \   000032                ; Setup parameters for call to function halhumi
   \   000032   12....       LCALL   ??halhumi?relay
   \   000035   E9           MOV     A,R1
   \   000036   90....       MOV     DPTR,#(p2p_msg + 6)
   \   000039   F0           MOVX    @DPTR,A
     77                
     78                p2p_msg[7] = 0;
   \   00003A   E4           CLR     A
   \   00003B   90....       MOV     DPTR,#(p2p_msg + 7)
   \   00003E   F0           MOVX    @DPTR,A
     79           
     80              if(P1_3 == 1)//烟雾    
   \   00003F   A293         MOV     C,0x90.3
   \   000041   5003         JNC     ??halProcessSensorInterrupt_0
     81              {
     82                //P1IFG &= ~(SmokeSensorBit);
     83                p2p_msg[7] |= 1;
   \   000043   7401         MOV     A,#0x1
   \   000045   F0           MOVX    @DPTR,A
     84              }
     85              else
     86              {
     87                p2p_msg[7] |= 0;
     88              }
     89              
     90              if (P1IFG & InfraredSensorBit)  //hongwai
   \                     ??halProcessSensorInterrupt_0:
   \   000046   E58A         MOV     A,0x8a
   \   000048   A2E2         MOV     C,0xE0 /* A   */.2
   \   00004A   5007         JNC     ??halProcessSensorInterrupt_1
     91              {
     92                P1IFG &= ~(InfraredSensorBit);
   \   00004C   538AFB       ANL     0x8a,#0xfb
     93                p2p_msg[7] |= 2;
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   D2E1         SETB    0xE0 /* A   */.1
   \   000052   F0           MOVX    @DPTR,A
     94              }
     95              else
     96              {
     97                p2p_msg[7] |= 0;
     98              }
     99          	// Send "the" message
    100              P1IF = 0;
   \                     ??halProcessSensorInterrupt_1:
   \   000053   C2EB         CLR     0xe8.3
    101              p2p_test_SendTheMessage();
   \   000055                ; Setup parameters for call to function p2p_test_SendTheMessage
   \   000055   12....       LCALL   ??p2p_test_SendTheMessage?relay
    102                
    103                
    104                
    105          
    106          }
   \   000058   D083         POP     DPH
   \   00005A   D082         POP     DPL
   \   00005C   02....       LJMP    ?BRET
   \   00005F                REQUIRE _A_P1
   \   00005F                REQUIRE P1IFG
   \   00005F                REQUIRE _A_IRCON2
    107          
    108          /***************************************************************************************************
    109           *                                    INTERRUPT SERVICE ROUTINE
    110           ***************************************************************************************************/
    111          
    112          /**************************************************************************************************
    113           * @fn      halSensorPort1Isr
    114           *
    115           * @brief   红外烟雾 ISR
    116           *
    117           * @param
    118           *
    119           * @return
    120           **************************************************************************************************/

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    121          HAL_ISR_FUNCTION( halSensorPort1Isr, P1INT_VECTOR )
   \                     halSensorPort1Isr:
    122          {
   \   000000   C0E0         PUSH    A
   \   000002   74F2         MOV     A,#-0xe
   \   000004   12....       LCALL   ?INTERRUPT_ENTER_XSP
   \   000007                ; Saved register size: 15
   \   000007                ; Auto size: 0
    123              
    124              CLEAR_SLEEP_MODE();
    125              halProcessSensorInterrupt();
   \   000007                ; Setup parameters for call to function halProcessSensorInterrupt
   \   000007   12....       LCALL   ??halProcessSensorInterrupt?relay
    126          }
   \   00000A   7F01         MOV     R7,#0x1
   \   00000C   02....       LJMP    ?INTERRUPT_LEAVE_XSP

   \                                 In  segment INTVEC, offset 0x7b, root
   \                     `??halSensorPort1Isr??INTVEC 123`:
   \   00007B   02....       LJMP       (halSensorPort1Isr)

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalSensorConfig?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalSensorConfig

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??halProcessSensorInterrupt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    halProcessSensorInterrupt
    127          

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     HalSensorConfig                    0      0      0
     halProcessSensorInterrupt          2      0      0
       -> haltemp                       4      0      0
       -> halhumi                       4      0      0
       -> p2p_test_SendTheMessage       4      0      0
     halSensorPort1Isr                 15      0      0
       -> halProcessSensorInterrupt    30      0      0


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     P1IFG                             1
     PICTL                             1
     P1IEN                             1
     _A_P1                             1
     IEN2                              1
     _A_IRCON2                         1
     P1SEL                             1
     P2INP                             1
     P1DIR                             1
     HalSensorConfig                  39
     halProcessSensorInterrupt        95
     halSensorPort1Isr                15
     ??halSensorPort1Isr??INTVEC 123
                                       3
     ??HalSensorConfig?relay           6
     ??halProcessSensorInterrupt?relay
                                       6

 
 134 bytes in segment BANKED_CODE
  12 bytes in segment BANK_RELAYS
   3 bytes in segment INTVEC
  15 bytes in segment NEAR_CODE
   9 bytes in segment SFR_AN
 
 161 bytes of CODE memory (+ 3 bytes shared)
   0 bytes of DATA memory (+ 9 bytes shared)

Errors: none
Warnings: none
