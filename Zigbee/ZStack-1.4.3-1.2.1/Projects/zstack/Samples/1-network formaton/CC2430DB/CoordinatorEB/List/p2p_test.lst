###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    19/Jun/2011  21:26:58 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\network formaton\Source\p2p_test.c   #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\network                          #
#                          formaton\CC2430DB\..\..\..\Tools\CC2430DB\f8wCoord #
#                          .cfg" (-DCPU32MHZ -DFORCE_MAC_NEAR                 #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS         #
#                          "-DCONST=const __code" -DGENERIC=__generic) -f     #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\network formaton\CC2430DB\..\..\..\ #
#                          Tools\CC2430DB\f8wConfig.cfg" (-DSECURE=0          #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\Source\p2p_test.c" -D        #
#                          CC2430EB -D xREFLECTOR -D ZTOOL_P1 -D MT_TASK -D   #
#                          MT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG -D NV_RESTORE  #
#                          -lC "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Proje #
#                          cts\zstack\Samples\network                         #
#                          formaton\CC2430DB\CoordinatorEB\List\" -lA         #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\network formaton\CC2430DB\Coordinat #
#                          orEB\List\" --diag_suppress Pe001,Pa010            #
#                          --diag_remark pe550 -o "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\CoordinatorEB\Obj\" #
#                           -e --require_prototypes -z9 --no_code_motion      #
#                          --debug --core=plain --dptr=16,1                   #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data --nr_virtual_regs 8 -I      #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\network formaton\CC2430DB\" -I      #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\network formaton\CC2430DB\..\SOURCE #
#                          \" -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Pro #
#                          jects\zstack\Samples\network                       #
#                          formaton\CC2430DB\..\..\..\ZMAIN\TI2430DB\" -I     #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\network formaton\CC2430DB\..\..\..\ #
#                          ..\..\COMPONENTS\MT\" -I "C:\Texas                 #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\HAL\INCLUDE\" -I "C:\Texas                  #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\HAL\TARGET\CC2430EB\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\OSAL\INCLUDE\" -I "C:\Texas                 #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\STACK\AF\" -I "C:\Texas                     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\STACK\NWK\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\STACK\SEC\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\STACK\SYS\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\STACK\ZDO\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\ZMAC\F8W\" -I "C:\Texas                     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\ZMAC\" -I "C:\Texas                         #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\SERVICES\SADDR\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\SERVICES\SDATA\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\MAC\INCLUDE\" -I "C:\Texas                  #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\MAC\LOW_LEVEL\SRF03\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\network formaton\CC2430DB\..\..\..\..\..\COMP #
#                          ONENTS\MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I        #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          4.0 Evaluation version\8051\INC\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\network formaton\CC2430DB\Coordinato #
#                          rEB\List\p2p_test.lst                              #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\network formaton\CC2430DB\Coordinato #
#                          rEB\Obj\p2p_test.r51                               #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\network formaton\Source\p2p_test.c
      1          /**************************************************************************************************
      2            Filename:       p2p_test.c
      3            Revised:        $Date: 2007-10-27 17:16:54 -0700 (Sat, 27 Oct 2007) $
      4            Revision:       $Revision: 15793 $
      5          
      6            Description:    Generic Application (no Profile).
      7          
      8          
      9            Copyright 2004-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends "Hello World" to another "Generic"
     45            application every 15 seconds.  The application will also
     46            receive "Hello World" packets.
     47          
     48            The "Hello World" messages are sent/received as MSG type message.
     49          
     50            This applications doesn't have a profile, so it handles everything
     51            directly - itself.
     52          
     53            Key control:
     54              SW1:
     55              SW2:  initiates end device binding
     56              SW3:
     57              SW4:  initiates a match description request
     58          *********************************************************************/
     59          
     60          /*********************************************************************
     61           * INCLUDES
     62           */
     63          #include "OSAL.h"
     64          #include "AF.h"
     65          #include "ZDApp.h"
     66          #include "ZDObject.h"
     67          #include "ZDProfile.h"
     68          
     69          #include "p2p_test.h"
     70          #include "DebugTrace.h"
     71          
     72          #if !defined( WIN32 )
     73            #include "OnBoard.h"
     74          #endif
     75          
     76          /* HAL */
     77          #include "hal_lcd.h"
     78          #include "hal_led.h"
     79          #include "hal_key.h"
     80          #include "hal_uart.h"
     81          //#include "Hal_Sensor.h"  
     82          #include "Hal_defs.h"
     83          #include "hal_adc.h"
     84          /*********************************************************************
     85           * MACROS
     86           */
     87           #define DATA P1_1
     88          
     89          #define SCK P1_0
     90          
     91          /*********************************************************************
     92           * CONSTANTS
     93           */
     94          #define CLKSPD_1  (CLKCON & 0x01)
     95          
     96          
     97          // This list should be filled with Application specific Cluster IDs.
     98          /*********************************************************************
     99           * TYPEDEFS
    100           */
    101          
    102          /*********************************************************************
    103           * GLOBAL VARIABLES
    104           */
    105          
    106          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_I, align 1, keep-with-next
    107          const cId_t p2p_test_ClusterList[p2p_test_MAX_CLUSTERS] =
   \                     p2p_test_ClusterList:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for p2p_test_ClusterList>`
   \   000004                REQUIRE __INIT_XDATA_I
    108          {
    109            p2p_test_CLUSTERID,
    110            //fire_extinguisher_clusterId
    111          };
    112          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    113          const SimpleDescriptionFormat_t p2p_test_SimpleDesc =
   \                     p2p_test_SimpleDesc:
   \   000000                DS 12
   \   00000C                REQUIRE `?<Initializer for p2p_test_SimpleDesc>`
   \   00000C                REQUIRE __INIT_XDATA_I
    114          {
    115            p2p_test_ENDPOINT,              //  int Endpoint;
    116            p2p_test_PROFID,                //  uint16 AppProfId[2];
    117            p2p_test_DEVICEID,              //  uint16 AppDeviceId[2];
    118            p2p_test_DEVICE_VERSION,        //  int   AppDevVer:4;
    119            p2p_test_FLAGS,                 //  int   AppFlags:4;
    120            p2p_test_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    121            (cId_t *)p2p_test_ClusterList,  //  byte *pAppInClusterList;
    122            p2p_test_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    123            (cId_t *)p2p_test_ClusterList   //  byte *pAppInClusterList;
    124          };
    125          
    126          // This is the Endpoint/Interface description.  It is defined here, but
    127          // filled-in in p2p_test_Init().  Another way to go would be to fill
    128          // in the structure here and make it a "const" (in code space).  The
    129          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    130          endPointDesc_t p2p_test_epDesc;
   \                     p2p_test_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    131          
    132          /*********************************************************************
    133           * EXTERNAL VARIABLES
    134           */
    135          
    136          /*********************************************************************
    137           * EXTERNAL FUNCTIONS
    138           */
    139          
    140          /*********************************************************************
    141           * LOCAL VARIABLES
    142           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          byte p2p_test_TaskID;   // Task ID for internal task/event processing
   \                     p2p_test_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    144                                    // This variable will be received when
    145                                    // p2p_test_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          devStates_t p2p_test_NwkState;
   \                     p2p_test_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    147          
    148          
    149          byte p2p_test_TransID;  // This is the unique message ID (counter)
    150          
    151          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          byte p2p_test_TransID;  // This is the unique message ID (counter)
   \                     p2p_test_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    153          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          afAddrType_t p2p_test_DstAddr;
   \                     p2p_test_DstAddr:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    155            uint8 p2p_msg[6];//the collect message
   \                     p2p_msg:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156           uint16 shortaddr;
   \                     shortaddr:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    157           uint16 fatheraddr;
   \                     fatheraddr:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    158          
    159          /*********************************************************************
    160           * LOCAL FUNCTIONS
    161           */
    162          void p2p_test_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    163          void p2p_test_HandleKeys( byte shift, byte keys );
    164          void p2p_test_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    165          void p2p_test_SendTheMessage( void );
    166          
    167          /*********************************************************************
    168           * NETWORK LAYER CALLBACKS
    169           */
    170          
    171          /*********************************************************************
    172           * PUBLIC FUNCTIONS
    173           */
    174          
    175          /*********************************************************************
    176           * @fn      p2p_test_Init
    177           *
    178           * @brief   Initialization function for the Generic App Task.
    179           *          This is called during initialization and should contain
    180           *          any application specific initialization (ie. hardware
    181           *          initialization/setup, table initialization, power up
    182           *          notificaiton ... ).
    183           *
    184           * @param   task_id - the ID assigned by OSAL.  This ID should be
    185           *                    used to send messages and set timers.
    186           *
    187           * @return  none
    188           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    189          void p2p_test_Init( byte task_id )
   \                     p2p_test_Init:
    190          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    191            p2p_test_TaskID = task_id;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#p2p_test_TaskID
   \   000008   F0           MOVX    @DPTR,A
    192            p2p_test_NwkState = DEV_INIT;
   \   000009   7401         MOV     A,#0x1
   \   00000B   90....       MOV     DPTR,#p2p_test_NwkState
   \   00000E   F0           MOVX    @DPTR,A
    193            p2p_test_TransID = 0;
   \   00000F   E4           CLR     A
   \   000010   90....       MOV     DPTR,#p2p_test_TransID
   \   000013   F0           MOVX    @DPTR,A
    194          
    195            // Device hardware initialization can be added here or in main() (Zmain.c).
    196            // If the hardware is application specific - add it here.
    197            // If the hardware is other parts of the device add it in main().
    198          
    199            p2p_test_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000014   7402         MOV     A,#0x2
   \   000016   90....       MOV     DPTR,#(p2p_test_DstAddr + 2)
   \   000019   F0           MOVX    @DPTR,A
    200            p2p_test_DstAddr.endPoint = p2p_test_ENDPOINT;
   \   00001A   740A         MOV     A,#0xa
   \   00001C   90....       MOV     DPTR,#(p2p_test_DstAddr + 3)
   \   00001F   F0           MOVX    @DPTR,A
    201            p2p_test_DstAddr.addr.shortAddr = 0x0000;
   \   000020   90....       MOV     DPTR,#p2p_test_DstAddr
   \   000023   E4           CLR     A
   \   000024   F0           MOVX    @DPTR,A
   \   000025   A3           INC     DPTR
   \   000026   F0           MOVX    @DPTR,A
    202          
    203            // Fill out the endpoint description.
    204            p2p_test_epDesc.endPoint = p2p_test_ENDPOINT;
   \   000027   740A         MOV     A,#0xa
   \   000029   90....       MOV     DPTR,#p2p_test_epDesc
   \   00002C   F0           MOVX    @DPTR,A
    205            p2p_test_epDesc.task_id = &p2p_test_TaskID;
   \   00002D   90....       MOV     DPTR,#(p2p_test_epDesc + 1)
   \   000030   74..         MOV     A,#(p2p_test_TaskID & 0xff)
   \   000032   F0           MOVX    @DPTR,A
   \   000033   A3           INC     DPTR
   \   000034   74..         MOV     A,#((p2p_test_TaskID >> 8) & 0xff)
   \   000036   F0           MOVX    @DPTR,A
    206            p2p_test_epDesc.simpleDesc
    207                      = (SimpleDescriptionFormat_t *)&p2p_test_SimpleDesc;
   \   000037   90....       MOV     DPTR,#(p2p_test_epDesc + 3)
   \   00003A   74..         MOV     A,#(p2p_test_SimpleDesc & 0xff)
   \   00003C   F0           MOVX    @DPTR,A
   \   00003D   A3           INC     DPTR
   \   00003E   74..         MOV     A,#((p2p_test_SimpleDesc >> 8) & 0xff)
   \   000040   F0           MOVX    @DPTR,A
    208            p2p_test_epDesc.latencyReq = noLatencyReqs;
   \   000041   E4           CLR     A
   \   000042   90....       MOV     DPTR,#(p2p_test_epDesc + 5)
   \   000045   F0           MOVX    @DPTR,A
    209          
    210            // Register the endpoint description with the AF
    211            afRegister( &p2p_test_epDesc );
   \   000046                ; Setup parameters for call to function afRegister
   \   000046   7A..         MOV     R2,#(p2p_test_epDesc & 0xff)
   \   000048   7B..         MOV     R3,#((p2p_test_epDesc >> 8) & 0xff)
   \   00004A   12....       LCALL   ??afRegister?relay
    212          
    213            // Register for all key events - This app will handle all key events
    214            RegisterForKeys( p2p_test_TaskID );
   \   00004D                ; Setup parameters for call to function RegisterForKeys
   \   00004D   90....       MOV     DPTR,#p2p_test_TaskID
   \   000050   E0           MOVX    A,@DPTR
   \   000051   F9           MOV     R1,A
   \   000052   12....       LCALL   ??RegisterForKeys?relay
    215          
    216          
    217          
    218            // Update the display
    219          #if defined ( LCD_SUPPORTED )
    220              HalLcdWriteString( "p2p_test", HAL_LCD_LINE_1 );
    221          #endif
    222          
    223            ZDO_RegisterForZDOMsg( p2p_test_TaskID, End_Device_Bind_rsp );
   \   000055                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000055   7A20         MOV     R2,#0x20
   \   000057   7B80         MOV     R3,#-0x80
   \   000059   90....       MOV     DPTR,#p2p_test_TaskID
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   F9           MOV     R1,A
   \   00005E   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    224            ZDO_RegisterForZDOMsg( p2p_test_TaskID, Match_Desc_rsp );
   \   000061                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000061   7A06         MOV     R2,#0x6
   \   000063   7B80         MOV     R3,#-0x80
   \   000065   90....       MOV     DPTR,#p2p_test_TaskID
   \   000068   E0           MOVX    A,@DPTR
   \   000069   F9           MOV     R1,A
   \   00006A   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    225          }
   \   00006D   D083         POP     DPH
   \   00006F   D082         POP     DPL
   \   000071   02....       LJMP    ?BRET
    226          
    227          /*********************************************************************
    228           * @fn      p2p_test_ProcessEvent
    229           *
    230           * @brief   Generic Application Task event processor.  This function
    231           *          is called to process all events for the task.  Events
    232           *          include timers, messages and any other user defined events.
    233           *
    234           * @param   task_id  - The OSAL assigned task ID.
    235           * @param   events - events to process.  This is a bit map and can
    236           *                   contain more than one event.
    237           *
    238           * @return  none
    239           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    240          UINT16 p2p_test_ProcessEvent( byte task_id, UINT16 events )
   \                     p2p_test_ProcessEvent:
    241          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    242            afIncomingMSGPacket_t *MSGpkt;
    243            afDataConfirm_t *afDataConfirm;
    244          
    245            // Data Confirmation message fields
    246            byte sentEP;
    247            ZStatus_t sentStatus;
    248            byte sentTransID;       // This should match the value sent
    249          
    250            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??p2p_test_ProcessEvent_0
   \   000010   E9           MOV     A,R1
   \                     ??p2p_test_ProcessEvent_0:
   \   000011   6062         JZ      ??p2p_test_ProcessEvent_1
    251            {
    252              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( p2p_test_TaskID );
   \   000013                ; Setup parameters for call to function osal_msg_receive
   \   000013   8013         SJMP    ??p2p_test_ProcessEvent_2
    253              while ( MSGpkt )
    254              {
    255                switch ( MSGpkt->hdr.event )
    256                {
    257                  case ZDO_CB_MSG:
    258                    p2p_test_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    259                    break;
    260          
    261                  case KEY_CHANGE:
    262                    // p2p_test_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    263                    
    264                    break;
    265                case INTER_CHANGE:
    266                    p2p_test_SendRainfall();
    267                    break;
    268          
    269                  case AF_DATA_CONFIRM_CMD:
    270                    // This message is received as a confirmation of a data packet sent.
    271                    // The status is of ZStatus_t type [defined in ZComDef.h]
    272                    // The message fields are defined in AF.h
    273                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    274                    sentEP = afDataConfirm->endpoint;
    275                    sentStatus = afDataConfirm->hdr.status;
    276                    sentTransID = afDataConfirm->transID;
    277                    (void)sentEP;
    278                    (void)sentTransID;
    279          
    280                    // Action taken when confirmation is received.
    281                    if ( sentStatus != ZSuccess )
    282                    {
    283                      // The data wasn't delivered -- Do something
    284                    }
    285                    break;
    286          
    287                  case AF_INCOMING_MSG_CMD:
    288                    p2p_test_MessageMSGCB( MSGpkt );
    289                    
    290           //         HalLedSet( HAL_LED_1, HAL_LED_MODE_ON );
    291            //        MicroWait( 62500 );
    292            //        MicroWait( 62500 );
    293             //       HalLedSet( HAL_LED_1, HAL_LED_MODE_OFF );
    294                    break;
    295          
    296                  case ZDO_STATE_CHANGE:
    297                    p2p_test_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \                     ??p2p_test_ProcessEvent_3:
   \   000015   85..82       MOV     DPL,?V0 + 0
   \   000018   85..83       MOV     DPH,?V0 + 1
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   90....       MOV     DPTR,#p2p_test_NwkState
   \   000020   F0           MOVX    @DPTR,A
    298                    if (  (p2p_test_NwkState == DEV_ROUTER)
    299                        || (p2p_test_NwkState == DEV_END_DEVICE) )
    300                    {
    301                        //osal_start_timerEx( p2p_test_TaskID,
    302                        //                  p2p_test_SEND_MSG_EVT,
    303                        //                 10 );
    304                    }
    305                    break;
    306          
    307                  default:
    308                    break;
    309                }
    310          
    311                // Release the memory
    312                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??p2p_test_ProcessEvent_4:
   \   000021                ; Setup parameters for call to function osal_msg_deallocate
   \   000021   AA..         MOV     R2,?V0 + 0
   \   000023   AB..         MOV     R3,?V0 + 1
   \   000025   12....       LCALL   ??osal_msg_deallocate?relay
    313          
    314                // Next
    315                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( p2p_test_TaskID );
   \   000028                ; Setup parameters for call to function osal_msg_receive
   \                     ??p2p_test_ProcessEvent_2:
   \   000028   90....       MOV     DPTR,#p2p_test_TaskID
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F9           MOV     R1,A
   \   00002D   12....       LCALL   ??osal_msg_receive?relay
   \   000030   8A..         MOV     ?V0 + 0,R2
   \   000032   8B..         MOV     ?V0 + 1,R3
   \   000034   E5..         MOV     A,?V0 + 0
   \   000036   7002         JNZ     ??p2p_test_ProcessEvent_5
   \   000038   E5..         MOV     A,?V0 + 1
   \                     ??p2p_test_ProcessEvent_5:
   \   00003A   6031         JZ      ??p2p_test_ProcessEvent_6
   \   00003C   85..82       MOV     DPL,?V0 + 0
   \   00003F   85..83       MOV     DPH,?V0 + 1
   \   000042   E0           MOVX    A,@DPTR
   \   000043   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for p2p_test_ProcessEvent>_0`:
   \   000046   00           DB        0
   \   000047   04           DB        4
   \   000048   1A           DB        26
   \   000049   ....         DW        ??p2p_test_ProcessEvent_7
   \   00004B   C1           DB        193
   \   00004C   ....         DW        ??p2p_test_ProcessEvent_8
   \   00004E   D1           DB        209
   \   00004F   ....         DW        ??p2p_test_ProcessEvent_3
   \   000051   D3           DB        211
   \   000052   ....         DW        ??p2p_test_ProcessEvent_9
   \   000054   ....         DW        ??p2p_test_ProcessEvent_4
   \                     ??p2p_test_ProcessEvent_9:
   \   000056                ; Setup parameters for call to function p2p_test_ProcessZDOMsgs
   \   000056   AA..         MOV     R2,?V0 + 0
   \   000058   AB..         MOV     R3,?V0 + 1
   \   00005A   12....       LCALL   ??p2p_test_ProcessZDOMsgs?relay
   \   00005D   80C2         SJMP    ??p2p_test_ProcessEvent_4
   \                     ??p2p_test_ProcessEvent_8:
   \   00005F                ; Setup parameters for call to function p2p_test_SendRainfall
   \   00005F   12....       LCALL   ??p2p_test_SendRainfall?relay
   \   000062   80BD         SJMP    ??p2p_test_ProcessEvent_4
   \                     ??p2p_test_ProcessEvent_7:
   \   000064                ; Setup parameters for call to function p2p_test_MessageMSGCB
   \   000064   AA..         MOV     R2,?V0 + 0
   \   000066   AB..         MOV     R3,?V0 + 1
   \   000068   12....       LCALL   ??p2p_test_MessageMSGCB?relay
   \   00006B   80B4         SJMP    ??p2p_test_ProcessEvent_4
    316              }
    317          
    318              // return unprocessed events
    319              return (events ^ SYS_EVENT_MSG);
   \                     ??p2p_test_ProcessEvent_6:
   \   00006D   EE           MOV     A,R6
   \   00006E   FA           MOV     R2,A
   \   00006F   7480         MOV     A,#-0x80
   \   000071   6F           XRL     A,R7
   \                     ??p2p_test_ProcessEvent_10:
   \   000072   FB           MOV     R3,A
   \   000073   8072         SJMP    ??p2p_test_ProcessEvent_11
    320            }
    321          
    322            // Send a message out - This event is generated by a timer
    323            //  (setup in p2p_test_Init()).
    324            if ( events & p2p_test_SEND_MSG_EVT )
   \                     ??p2p_test_ProcessEvent_1:
   \   000075   EE           MOV     A,R6
   \   000076   A2E0         MOV     C,0xE0 /* A   */.0
   \   000078   5069         JNC     ??p2p_test_ProcessEvent_12
    325            {
    326              p2p_msg[0] = 0xFF;
   \   00007A   74FF         MOV     A,#-0x1
   \   00007C   90....       MOV     DPTR,#p2p_msg
   \   00007F   F0           MOVX    @DPTR,A
    327              //next is for ieeaddr
    328              shortaddr = NLME_GetShortAddr();
   \   000080                ; Setup parameters for call to function NLME_GetShortAddr
   \   000080   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000083   90....       MOV     DPTR,#shortaddr
   \   000086   EA           MOV     A,R2
   \   000087   F0           MOVX    @DPTR,A
   \   000088   A3           INC     DPTR
   \   000089   EB           MOV     A,R3
   \   00008A   F0           MOVX    @DPTR,A
    329              p2p_msg[1] = LO_UINT16(shortaddr);
   \   00008B   90....       MOV     DPTR,#shortaddr
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   90....       MOV     DPTR,#(p2p_msg + 1)
   \   000092   F0           MOVX    @DPTR,A
    330              p2p_msg[2] = HI_UINT16(shortaddr);
   \   000093   90....       MOV     DPTR,#(shortaddr + 1)
   \   000096   E0           MOVX    A,@DPTR
   \   000097   90....       MOV     DPTR,#(p2p_msg + 2)
   \   00009A   F0           MOVX    @DPTR,A
    331              fatheraddr = NLME_GetCoordShortAddr();
   \   00009B                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   00009B   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   00009E   90....       MOV     DPTR,#fatheraddr
   \   0000A1   EA           MOV     A,R2
   \   0000A2   F0           MOVX    @DPTR,A
   \   0000A3   A3           INC     DPTR
   \   0000A4   EB           MOV     A,R3
   \   0000A5   F0           MOVX    @DPTR,A
    332              p2p_msg[3] = LO_UINT16(fatheraddr);
   \   0000A6   90....       MOV     DPTR,#fatheraddr
   \   0000A9   E0           MOVX    A,@DPTR
   \   0000AA   90....       MOV     DPTR,#(p2p_msg + 3)
   \   0000AD   F0           MOVX    @DPTR,A
    333              p2p_msg[4] = HI_UINT16(fatheraddr);
   \   0000AE   90....       MOV     DPTR,#(fatheraddr + 1)
   \   0000B1   E0           MOVX    A,@DPTR
   \   0000B2   90....       MOV     DPTR,#(p2p_msg + 4)
   \   0000B5   F0           MOVX    @DPTR,A
    334              uint8 *ieeeAddr;
    335              ieeeAddr = NLME_GetExtAddr();
    336              p2p_msg[5]=  *(uint8 *)(ieeeAddr+7);//p2p_DeviceID; 
   \   0000B6                ; Setup parameters for call to function NLME_GetExtAddr
   \   0000B6   12....       LCALL   ??NLME_GetExtAddr?relay
   \   0000B9   8A82         MOV     DPL,R2
   \   0000BB   8B83         MOV     DPH,R3
   \   0000BD   A3           INC     DPTR
   \   0000BE   A3           INC     DPTR
   \   0000BF   A3           INC     DPTR
   \   0000C0   A3           INC     DPTR
   \   0000C1   A3           INC     DPTR
   \   0000C2   A3           INC     DPTR
   \   0000C3   A3           INC     DPTR
   \   0000C4   E0           MOVX    A,@DPTR
   \   0000C5   90....       MOV     DPTR,#(p2p_msg + 5)
   \   0000C8   F0           MOVX    @DPTR,A
    337              // Send "the" message
    338              p2p_test_SendTheMessage();
   \   0000C9                ; Setup parameters for call to function p2p_test_SendTheMessage
   \   0000C9   12....       LCALL   ??p2p_test_SendTheMessage?relay
    339              osal_start_timerEx( p2p_test_TaskID,
    340                                  p2p_test_SEND_MSG_EVT,
    341                                  p2p_test_SEND_MSG_TIMEOUT );
   \   0000CC                ; Setup parameters for call to function osal_start_timerEx
   \   0000CC   7C70         MOV     R4,#0x70
   \   0000CE   7D17         MOV     R5,#0x17
   \   0000D0   7A01         MOV     R2,#0x1
   \   0000D2   7B00         MOV     R3,#0x0
   \   0000D4   90....       MOV     DPTR,#p2p_test_TaskID
   \   0000D7   E0           MOVX    A,@DPTR
   \   0000D8   F9           MOV     R1,A
   \   0000D9   12....       LCALL   ??osal_start_timerEx?relay
    342          
    343              // return unprocessed events
    344              return (events ^ p2p_test_SEND_MSG_EVT);
   \   0000DC   7401         MOV     A,#0x1
   \   0000DE   6E           XRL     A,R6
   \   0000DF   FA           MOV     R2,A
   \   0000E0   EF           MOV     A,R7
   \   0000E1   808F         SJMP    ??p2p_test_ProcessEvent_10
    345            }
    346          
    347            // Discard unknown events
    348            return 0;
   \                     ??p2p_test_ProcessEvent_12:
   \   0000E3   7A00         MOV     R2,#0x0
   \   0000E5   7B00         MOV     R3,#0x0
   \                     ??p2p_test_ProcessEvent_11:
   \   0000E7   7F04         MOV     R7,#0x4
   \   0000E9   02....       LJMP    ?BANKED_LEAVE_XDATA
    349          }
    350          
    351          /*********************************************************************
    352           * Event Generation Functions
    353           */
    354          /*********************************************************************
    355           * @fn      p2p_test_ProcessZDOMsgs()
    356           *
    357           * @brief   Process response messages
    358           *
    359           * @param   none
    360           *
    361           * @return  none
    362           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    363          void p2p_test_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
   \                     p2p_test_ProcessZDOMsgs:
    364          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    365            switch ( inMsg->clusterID )
   \   000005   EA           MOV     A,R2
   \   000006   240C         ADD     A,#0xc
   \   000008   F582         MOV     DPL,A
   \   00000A   EB           MOV     A,R3
   \   00000B   3400         ADDC    A,#0x0
   \   00000D   F583         MOV     DPH,A
   \   00000F   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000012   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for p2p_test_ProcessZDOMsgs>_0`:
   \   000015   0000         DW        0
   \   000017   0200         DW        2
   \   000019   0680         DW        32774
   \   00001B   ....         DW        ??p2p_test_ProcessZDOMsgs_0
   \   00001D   2080         DW        32800
   \   00001F   ....         DW        ??p2p_test_ProcessZDOMsgs_1
   \   000021   ....         DW        ??p2p_test_ProcessZDOMsgs_2
    366            {
    367              case End_Device_Bind_rsp:
    368                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
   \                     ??p2p_test_ProcessZDOMsgs_1:
   \   000023   EA           MOV     A,R2
   \   000024   2411         ADD     A,#0x11
   \   000026   F582         MOV     DPL,A
   \   000028   EB           MOV     A,R3
   \   000029   3400         ADDC    A,#0x0
   \   00002B   F583         MOV     DPH,A
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   F8           MOV     R0,A
   \   00002F   A3           INC     DPTR
   \   000030   E0           MOVX    A,@DPTR
   \   000031   F583         MOV     DPH,A
   \   000033   8882         MOV     DPL,R0
   \   000035   E0           MOVX    A,@DPTR
   \   000036   7009         JNZ     ??p2p_test_ProcessZDOMsgs_3
    369                {
    370                  // Light LED
    371                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   000038                ; Setup parameters for call to function HalLedSet
   \   000038   7A01         MOV     R2,#0x1
   \                     ??p2p_test_ProcessZDOMsgs_4:
   \   00003A   7908         MOV     R1,#0x8
   \   00003C   12....       LCALL   ??HalLedSet?relay
   \   00003F   8055         SJMP    ??p2p_test_ProcessZDOMsgs_2
    372                }
    373          #if defined(BLINK_LEDS)
    374                else
    375                {
    376                  // Flash LED to show failure
    377                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
   \                     ??p2p_test_ProcessZDOMsgs_3:
   \   000041                ; Setup parameters for call to function HalLedSet
   \   000041   7A04         MOV     R2,#0x4
   \   000043   80F5         SJMP    ??p2p_test_ProcessZDOMsgs_4
    378                }
    379          #endif
    380                break;
    381          
    382              case Match_Desc_rsp:
    383                {
    384                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
   \                     ??p2p_test_ProcessZDOMsgs_0:
   \   000045                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   000045   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   000048   8A..         MOV     ?V0 + 0,R2
   \   00004A   8B..         MOV     ?V0 + 1,R3
   \   00004C   AE..         MOV     R6,?V0 + 0
   \   00004E   AF..         MOV     R7,?V0 + 1
    385                  if ( pRsp )
   \   000050   EE           MOV     A,R6
   \   000051   7001         JNZ     ??p2p_test_ProcessZDOMsgs_5
   \   000053   EF           MOV     A,R7
   \                     ??p2p_test_ProcessZDOMsgs_5:
   \   000054   6040         JZ      ??p2p_test_ProcessZDOMsgs_2
    386                  {
    387                    if ( pRsp->status == ZSuccess && pRsp->cnt )
   \   000056   8E82         MOV     DPL,R6
   \   000058   8F83         MOV     DPH,R7
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   7032         JNZ     ??p2p_test_ProcessZDOMsgs_6
   \   00005D   A3           INC     DPTR
   \   00005E   A3           INC     DPTR
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   602C         JZ      ??p2p_test_ProcessZDOMsgs_6
    388                    {
    389                      p2p_test_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000063   7402         MOV     A,#0x2
   \   000065   90....       MOV     DPTR,#(p2p_test_DstAddr + 2)
   \   000068   F0           MOVX    @DPTR,A
    390                      p2p_test_DstAddr.addr.shortAddr = pRsp->nwkAddr;
   \   000069   8E82         MOV     DPL,R6
   \   00006B   8F83         MOV     DPH,R7
   \   00006D   A3           INC     DPTR
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F8           MOV     R0,A
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   F9           MOV     R1,A
   \   000073   90....       MOV     DPTR,#p2p_test_DstAddr
   \   000076   E8           MOV     A,R0
   \   000077   F0           MOVX    @DPTR,A
   \   000078   A3           INC     DPTR
   \   000079   E9           MOV     A,R1
   \   00007A   F0           MOVX    @DPTR,A
    391                      // Take the first endpoint, Can be changed to search through endpoints
    392                      p2p_test_DstAddr.endPoint = pRsp->epList[0];
   \   00007B   8E82         MOV     DPL,R6
   \   00007D   8F83         MOV     DPH,R7
   \   00007F   A3           INC     DPTR
   \   000080   A3           INC     DPTR
   \   000081   A3           INC     DPTR
   \   000082   A3           INC     DPTR
   \   000083   E0           MOVX    A,@DPTR
   \   000084   90....       MOV     DPTR,#(p2p_test_DstAddr + 3)
   \   000087   F0           MOVX    @DPTR,A
    393          
    394                      // Light LED
    395                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   000088                ; Setup parameters for call to function HalLedSet
   \   000088   7A01         MOV     R2,#0x1
   \   00008A   7908         MOV     R1,#0x8
   \   00008C   12....       LCALL   ??HalLedSet?relay
    396                    }
    397                    osal_mem_free( pRsp );
   \                     ??p2p_test_ProcessZDOMsgs_6:
   \   00008F                ; Setup parameters for call to function osal_mem_free
   \   00008F   EE           MOV     A,R6
   \   000090   FA           MOV     R2,A
   \   000091   EF           MOV     A,R7
   \   000092   FB           MOV     R3,A
   \   000093   12....       LCALL   ??osal_mem_free?relay
    398                  }
    399                }
    400                break;
    401            }
    402          }
   \                     ??p2p_test_ProcessZDOMsgs_2:
   \   000096   02....       LJMP    ??Subroutine1_1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7403         MOV     A,#0x3
   \                     ??Subroutine1_0:
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??Subroutine1_1:
   \   000005   7F02         MOV     R7,#0x2
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F5..         MOV     ?V0 + 0,A
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   F5..         MOV     ?V0 + 1,A
   \   000007   78..         MOV     R0,#?V0 + 0
   \   000009   22           RET
    403          
    404          /*********************************************************************
    405           * @fn      p2p_test_HandleKeys
    406           *
    407           * @brief   Handles all key events for this device.
    408           *
    409           * @param   shift - true if in shift/alt.
    410           * @param   keys - bit field for key events. Valid entries:
    411           *                 HAL_KEY_SW_4
    412           *                 HAL_KEY_SW_3
    413           *                 HAL_KEY_SW_2
    414           *                 HAL_KEY_SW_1
    415           *
    416           * @return  none
    417           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    418          void p2p_test_SendRainfall(void)
   \                     p2p_test_SendRainfall:
    419          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 3
   \   000005   74FD         MOV     A,#-0x3
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    420            if (  (p2p_test_NwkState == DEV_ROUTER)
    421                        || (p2p_test_NwkState == DEV_END_DEVICE) )
   \   00000A   90....       MOV     DPTR,#p2p_test_NwkState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6407         XRL     A,#0x7
   \   000010   6005         JZ      ??p2p_test_SendRainfall_0
   \   000012   E0           MOVX    A,@DPTR
   \   000013   6406         XRL     A,#0x6
   \   000015   7069         JNZ     ??p2p_test_SendRainfall_1
    422            {
    423              unsigned char p2p_msg[3];
    424              p2p_msg[0] = HI_UINT16(shortaddr);
   \                     ??p2p_test_SendRainfall_0:
   \   000017   90....       MOV     DPTR,#(shortaddr + 1)
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   85..82       MOV     DPL,?XSP + 0
   \   00001E   85..83       MOV     DPH,?XSP + 1
   \   000021   F0           MOVX    @DPTR,A
    425              p2p_msg[1] = LO_UINT16(shortaddr);
   \   000022   90....       MOV     DPTR,#shortaddr
   \   000025   E0           MOVX    A,@DPTR
   \   000026   C0E0         PUSH    A
   \   000028   7401         MOV     A,#0x1
   \   00002A   12....       LCALL   ?XSTACK_DISP0_8
   \   00002D   D0E0         POP     A
   \   00002F   F0           MOVX    @DPTR,A
    426              p2p_msg[2] = 1;
   \   000030   7402         MOV     A,#0x2
   \   000032   12....       LCALL   ?XSTACK_DISP0_8
   \   000035   7401         MOV     A,#0x1
   \   000037   F0           MOVX    @DPTR,A
    427              
    428              AF_DataRequest( &p2p_test_DstAddr, &p2p_test_epDesc,
    429                                 p2p_test_CLUSTERID,
    430                                 3,
    431                                 (byte *)&p2p_msg,
    432                                 &p2p_test_TransID,
    433                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS );
   \   000038                ; Setup parameters for call to function AF_DataRequest
   \   000038   75..0A       MOV     ?V0 + 0,#0xa
   \   00003B   78..         MOV     R0,#?V0 + 0
   \   00003D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000040   75....       MOV     ?V0 + 0,#(p2p_test_TransID & 0xff)
   \   000043   75....       MOV     ?V0 + 1,#((p2p_test_TransID >> 8) & 0xff)
   \   000046   78..         MOV     R0,#?V0 + 0
   \   000048   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004B   7403         MOV     A,#0x3
   \   00004D   12....       LCALL   ?XSTACK_DISP0_8
   \   000050   8582..       MOV     ?V0 + 0,DPL
   \   000053   8583..       MOV     ?V0 + 1,DPH
   \   000056   78..         MOV     R0,#?V0 + 0
   \   000058   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005B   75..03       MOV     ?V0 + 0,#0x3
   \   00005E   75..00       MOV     ?V0 + 1,#0x0
   \   000061   78..         MOV     R0,#?V0 + 0
   \   000063   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000066   75..01       MOV     ?V0 + 0,#0x1
   \   000069   78..         MOV     R0,#?V0 + 0
   \   00006B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006E   7920         MOV     R1,#0x20
   \   000070   7C..         MOV     R4,#(p2p_test_epDesc & 0xff)
   \   000072   7D..         MOV     R5,#((p2p_test_epDesc >> 8) & 0xff)
   \   000074   7A..         MOV     R2,#(p2p_test_DstAddr & 0xff)
   \   000076   7B..         MOV     R3,#((p2p_test_DstAddr >> 8) & 0xff)
   \   000078   12....       LCALL   ??AF_DataRequest?relay
   \   00007B   7409         MOV     A,#0x9
   \   00007D   12....       LCALL   ?DEALLOC_XSTACK8
    434            }
    435          }
   \                     ??p2p_test_SendRainfall_1:
   \   000080   02....       LJMP    ?Subroutine1 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    436          void p2p_test_HandleKeys( byte shift, byte keys )
   \                     p2p_test_HandleKeys:
    437          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
    438            zAddrType_t dstAddr;
    439          
    440            // Shift is used to make each button/switch dual purpose.
    441            if ( shift )
   \   00000C   E9           MOV     A,R1
   \   00000D   6003         JZ      $+5
   \   00000F   02....       LJMP    ??p2p_test_HandleKeys_0 & 0xFFFF
    442            {
    443              if ( keys & HAL_KEY_SW_1 )
    444              {
    445              }
    446              if ( keys & HAL_KEY_SW_2 )
    447              {
    448              }
    449              if ( keys & HAL_KEY_SW_3 )
    450              {
    451              }
    452              if ( keys & HAL_KEY_SW_4 )
    453              {
    454              }
    455            }
    456            else
    457            {
    458              if ( keys & HAL_KEY_SW_1 )
    459              {
    460              }
    461          
    462              if ( keys & HAL_KEY_SW_2 )
   \   000012   EE           MOV     A,R6
   \   000013   A2E1         MOV     C,0xE0 /* A   */.1
   \   000015   5070         JNC     ??p2p_test_HandleKeys_1
    463              {
    464                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   000017                ; Setup parameters for call to function HalLedSet
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7908         MOV     R1,#0x8
   \   00001B   12....       LCALL   ??HalLedSet?relay
    465          
    466                // Initiate an End Device Bind Request for the mandatory endpoint
    467                dstAddr.addrMode = Addr16Bit;
   \   00001E   7408         MOV     A,#0x8
   \   000020   12....       LCALL   ?XSTACK_DISP0_8
   \   000023   7402         MOV     A,#0x2
   \   000025   F0           MOVX    @DPTR,A
    468                dstAddr.addr.shortAddr = 0x0000; // Coordinator
   \   000026   85..82       MOV     DPL,?XSP + 0
   \   000029   85..83       MOV     DPH,?XSP + 1
   \   00002C   E4           CLR     A
   \   00002D   F0           MOVX    @DPTR,A
   \   00002E   A3           INC     DPTR
   \   00002F   F0           MOVX    @DPTR,A
    469                ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(),
    470                                      p2p_test_epDesc.endPoint,
    471                                      p2p_test_PROFID,
    472                                      p2p_test_MAX_CLUSTERS, (cId_t *)p2p_test_ClusterList,
    473                                      p2p_test_MAX_CLUSTERS, (cId_t *)p2p_test_ClusterList,
    474                                      FALSE );
   \   000030                ; Setup parameters for call to function NLME_GetShortAddr
   \   000030   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000033   8A..         MOV     ?V0 + 0,R2
   \   000035   8B..         MOV     ?V0 + 1,R3
   \   000037   AC..         MOV     R4,?V0 + 0
   \   000039   AD..         MOV     R5,?V0 + 1
   \   00003B                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   00003B   75..00       MOV     ?V0 + 0,#0x0
   \   00003E   78..         MOV     R0,#?V0 + 0
   \   000040   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000043   75....       MOV     ?V0 + 0,#(p2p_test_ClusterList & 0xff)
   \   000046   75....       MOV     ?V0 + 1,#((p2p_test_ClusterList >> 8) & 0xff)
   \   000049   78..         MOV     R0,#?V0 + 0
   \   00004B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004E   75..02       MOV     ?V0 + 0,#0x2
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000056   75....       MOV     ?V0 + 0,#(p2p_test_ClusterList & 0xff)
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005E   75..02       MOV     ?V0 + 0,#0x2
   \   000061   78..         MOV     R0,#?V0 + 0
   \   000063   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000066   75..04       MOV     ?V0 + 0,#0x4
   \   000069   75..0F       MOV     ?V0 + 1,#0xf
   \   00006C   78..         MOV     R0,#?V0 + 0
   \   00006E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000071   90....       MOV     DPTR,#p2p_test_epDesc
   \   000074   E0           MOVX    A,@DPTR
   \   000075   F9           MOV     R1,A
   \   000076   7409         MOV     A,#0x9
   \   000078   12....       LCALL   ?XSTACK_DISP0_8
   \   00007B   AA82         MOV     R2,DPL
   \   00007D   AB83         MOV     R3,DPH
   \   00007F   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   000082   7409         MOV     A,#0x9
   \   000084   12....       LCALL   ?DEALLOC_XSTACK8
    475              }
    476          
    477              if ( keys & HAL_KEY_SW_3 )
    478              {
    479              }
    480          
    481              if ( keys & HAL_KEY_SW_4 )
   \                     ??p2p_test_HandleKeys_1:
   \   000087   EE           MOV     A,R6
   \   000088   A2E3         MOV     C,0xE0 /* A   */.3
   \   00008A   505F         JNC     ??p2p_test_HandleKeys_0
    482              {
    483                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   00008C                ; Setup parameters for call to function HalLedSet
   \   00008C   7A00         MOV     R2,#0x0
   \   00008E   7908         MOV     R1,#0x8
   \   000090   12....       LCALL   ??HalLedSet?relay
    484          
    485                // Initiate a Match Description Request (Service Discovery)
    486                dstAddr.addrMode = AddrBroadcast;
   \   000093   7408         MOV     A,#0x8
   \   000095   12....       LCALL   ?XSTACK_DISP0_8
   \   000098   740F         MOV     A,#0xf
   \   00009A   F0           MOVX    @DPTR,A
    487                dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
   \   00009B   85..82       MOV     DPL,?XSP + 0
   \   00009E   85..83       MOV     DPH,?XSP + 1
   \   0000A1   74FF         MOV     A,#-0x1
   \   0000A3   F0           MOVX    @DPTR,A
   \   0000A4   A3           INC     DPTR
   \   0000A5   F0           MOVX    @DPTR,A
    488                ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    489                                  p2p_test_PROFID,
    490                                  p2p_test_MAX_CLUSTERS, (cId_t *)p2p_test_ClusterList,
    491                                  p2p_test_MAX_CLUSTERS, (cId_t *)p2p_test_ClusterList,
    492                                  FALSE );
   \   0000A6                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0000A6   75..00       MOV     ?V0 + 0,#0x0
   \   0000A9   78..         MOV     R0,#?V0 + 0
   \   0000AB   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000AE   75....       MOV     ?V0 + 0,#(p2p_test_ClusterList & 0xff)
   \   0000B1   75....       MOV     ?V0 + 1,#((p2p_test_ClusterList >> 8) & 0xff)
   \   0000B4   78..         MOV     R0,#?V0 + 0
   \   0000B6   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000B9   75..02       MOV     ?V0 + 0,#0x2
   \   0000BC   78..         MOV     R0,#?V0 + 0
   \   0000BE   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000C1   75....       MOV     ?V0 + 0,#(p2p_test_ClusterList & 0xff)
   \   0000C4   78..         MOV     R0,#?V0 + 0
   \   0000C6   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000C9   75..04       MOV     ?V0 + 0,#0x4
   \   0000CC   75..0F       MOV     ?V0 + 1,#0xf
   \   0000CF   78..         MOV     R0,#?V0 + 0
   \   0000D1   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000D4   7902         MOV     R1,#0x2
   \   0000D6   7CFF         MOV     R4,#-0x1
   \   0000D8   7DFF         MOV     R5,#-0x1
   \   0000DA   7408         MOV     A,#0x8
   \   0000DC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000DF   AA82         MOV     R2,DPL
   \   0000E1   AB83         MOV     R3,DPH
   \   0000E3   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   0000E6   7408         MOV     A,#0x8
   \   0000E8   12....       LCALL   ?DEALLOC_XSTACK8
    493              }
    494            }
    495          }
   \                     ??p2p_test_HandleKeys_0:
   \   0000EB                REQUIRE ?Subroutine2
   \   0000EB                ; // Fall through to label ?Subroutine2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7409         MOV     A,#0x9
   \   000002   80..         SJMP    ??Subroutine1_0
    496          
    497          /*********************************************************************
    498           * LOCAL FUNCTIONS
    499           */
    500          
    501          /*********************************************************************
    502           * @fn      p2p_test_MessageMSGCB
    503           *
    504           * @brief   Data message processor callback.  This function processes
    505           *          any incoming data - probably from other devices.  So, based
    506           *          on cluster ID, perform the intended action.
    507           *
    508           * @param   none
    509           *
    510           * @return  none
    511           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    512          void p2p_test_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     p2p_test_MessageMSGCB:
    513          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 3
   \   000005   74FD         MOV     A,#-0x3
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    514            uint8 msg_head[2];
    515            uint8 check;
    516            switch ( pkt->clusterId )
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000019   12....       LCALL   ?US_SWITCH_DENSE
   \                     `?<Jumptable for p2p_test_MessageMSGCB>_0`:
   \   00001C   0100         DW        1
   \   00001E   00           DB        0
   \   00001F   ....         DW        ??p2p_test_MessageMSGCB_0
   \   000021   ....         DW        ??p2p_test_MessageMSGCB_1
    517            {
    518              case p2p_test_CLUSTERID:
    519                // "the" message
    520                //the head
    521                msg_head[0] = 0xAA;
   \                     ??p2p_test_MessageMSGCB_1:
   \   000023   74AA         MOV     A,#-0x56
   \   000025   85..82       MOV     DPL,?XSP + 0
   \   000028   85..83       MOV     DPH,?XSP + 1
   \   00002B   F0           MOVX    @DPTR,A
    522                msg_head[1] = 0x55;
   \   00002C   7401         MOV     A,#0x1
   \   00002E   12....       LCALL   ?XSTACK_DISP0_8
   \   000031   7455         MOV     A,#0x55
   \   000033   F0           MOVX    @DPTR,A
    523                check = 0x01; //test, not true
   \   000034   7402         MOV     A,#0x2
   \   000036   12....       LCALL   ?XSTACK_DISP0_8
   \   000039   7401         MOV     A,#0x1
   \   00003B   F0           MOVX    @DPTR,A
    524                HalUARTWrite( 0, (uint8*)msg_head, 2 );
   \   00003C                ; Setup parameters for call to function HalUARTWrite
   \   00003C   7C02         MOV     R4,#0x2
   \   00003E   7D00         MOV     R5,#0x0
   \   000040   85..82       MOV     DPL,?XSP + 0
   \   000043   85..83       MOV     DPH,?XSP + 1
   \   000046   AA82         MOV     R2,DPL
   \   000048   AB83         MOV     R3,DPH
   \   00004A   7900         MOV     R1,#0x0
   \   00004C   12....       LCALL   ??HalUARTWrite?relay
    525                HalUARTWrite( 0, (uint8*)pkt->cmd.Data, pkt->cmd.DataLength );
   \   00004F                ; Setup parameters for call to function HalUARTWrite
   \   00004F   EE           MOV     A,R6
   \   000050   2413         ADD     A,#0x13
   \   000052   F582         MOV     DPL,A
   \   000054   EF           MOV     A,R7
   \   000055   3400         ADDC    A,#0x0
   \   000057   F583         MOV     DPH,A
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   FC           MOV     R4,A
   \   00005B   A3           INC     DPTR
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   FD           MOV     R5,A
   \   00005E   EE           MOV     A,R6
   \   00005F   2415         ADD     A,#0x15
   \   000061   F582         MOV     DPL,A
   \   000063   EF           MOV     A,R7
   \   000064   3400         ADDC    A,#0x0
   \   000066   F583         MOV     DPH,A
   \   000068   E0           MOVX    A,@DPTR
   \   000069   FA           MOV     R2,A
   \   00006A   A3           INC     DPTR
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   FB           MOV     R3,A
   \   00006D   7900         MOV     R1,#0x0
   \   00006F   12....       LCALL   ??HalUARTWrite?relay
    526                HalUARTWrite( 0, &check, 1 );
   \   000072                ; Setup parameters for call to function HalUARTWrite
   \   000072   7C01         MOV     R4,#0x1
   \   000074   7D00         MOV     R5,#0x0
   \   000076   7402         MOV     A,#0x2
   \   000078   12....       LCALL   ?XSTACK_DISP0_8
   \   00007B   AA82         MOV     R2,DPL
   \   00007D   AB83         MOV     R3,DPH
   \   00007F   7900         MOV     R1,#0x0
   \   000081   12....       LCALL   ??HalUARTWrite?relay
    527                break;
    528             
    529            }
    530          }
   \                     ??p2p_test_MessageMSGCB_0:
   \   000084   02....       LJMP    ?Subroutine1 & 0xFFFF
    531          
    532          
    533          /*********************************************************************
    534           * @fn      p2p_test_SendTheMessage
    535           *
    536           * @brief   Send "the" message.
    537           *
    538           * @param   none
    539           *
    540           * @return  none
    541           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    542          void p2p_test_SendTheMessage( void )
   \                     p2p_test_SendTheMessage:
    543          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    544             //char p2p_msg[] = "Hello World ";
    545             if ( AF_DataRequest( &p2p_test_DstAddr, &p2p_test_epDesc,
    546                                 p2p_test_CLUSTERID,
    547                                 6,
    548                                 (byte *)&p2p_msg,
    549                                 &p2p_test_TransID,
    550                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   000005                ; Setup parameters for call to function AF_DataRequest
   \   000005   75..0A       MOV     ?V0 + 0,#0xa
   \   000008   78..         MOV     R0,#?V0 + 0
   \   00000A   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00000D   75....       MOV     ?V0 + 0,#(p2p_test_TransID & 0xff)
   \   000010   75....       MOV     ?V0 + 1,#((p2p_test_TransID >> 8) & 0xff)
   \   000013   78..         MOV     R0,#?V0 + 0
   \   000015   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000018   75....       MOV     ?V0 + 0,#(p2p_msg & 0xff)
   \   00001B   75....       MOV     ?V0 + 1,#((p2p_msg >> 8) & 0xff)
   \   00001E   78..         MOV     R0,#?V0 + 0
   \   000020   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000023   75..06       MOV     ?V0 + 0,#0x6
   \   000026   75..00       MOV     ?V0 + 1,#0x0
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   75..01       MOV     ?V0 + 0,#0x1
   \   000031   78..         MOV     R0,#?V0 + 0
   \   000033   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000036   7920         MOV     R1,#0x20
   \   000038   7C..         MOV     R4,#(p2p_test_epDesc & 0xff)
   \   00003A   7D..         MOV     R5,#((p2p_test_epDesc >> 8) & 0xff)
   \   00003C   7A..         MOV     R2,#(p2p_test_DstAddr & 0xff)
   \   00003E   7B..         MOV     R3,#((p2p_test_DstAddr >> 8) & 0xff)
   \   000040   12....       LCALL   ??AF_DataRequest?relay
   \   000043   02....       LJMP    ?Subroutine2 & 0xFFFF
    551          
    552            {
    553              // Successfully requested to be sent.  
    554          //    HalUARTWrite( 0,  (uint8 *)p2p_msg, (byte)osal_strlen( p2p_msg ) + 1);
    555          
    556            } 
    557            
    558            else
    559            {
    560              // Error occurred in request to send.
    561            }
    562          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for p2p_test_ClusterList>`:
   \   000000   0100         DW 1
   \   000002   0000         DB 0, 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for p2p_test_SimpleDesc>`:
   \   000000   0A           DB 10
   \   000001   040F0100     DW 3844, 1
   \   000005   0002         DB 0, 2
   \   000007   ....         DW p2p_test_ClusterList
   \   000009   02           DB 2
   \   00000A   ....         DW p2p_test_ClusterList

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_ProcessZDOMsgs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_ProcessZDOMsgs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_SendRainfall?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_SendRainfall

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_SendTheMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_SendTheMessage
    563          
    564          
    565          

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     p2p_test_HandleKeys              1      0     28
       -> HalLedSet                   0      0     38
       -> NLME_GetShortAddr           0      0     38
       -> ZDP_EndDeviceBindReq        0      0     56
       -> HalLedSet                   0      0     38
       -> ZDP_MatchDescReq            0      0     54
     p2p_test_Init                    2      0      0
       -> afRegister                  4      0      0
       -> RegisterForKeys             4      0      0
       -> ZDO_RegisterForZDOMsg       4      0      0
       -> ZDO_RegisterForZDOMsg       4      0      0
     p2p_test_MessageMSGCB            1      0     25
       -> HalUARTWrite                0      0     26
       -> HalUARTWrite                0      0     26
       -> HalUARTWrite                0      0     26
     p2p_test_ProcessEvent            0      0     12
       -> osal_msg_receive            0      0     24
       -> osal_msg_deallocate         0      0     24
       -> osal_msg_receive            0      0     24
       -> p2p_test_ProcessZDOMsgs     0      0     24
       -> p2p_test_SendRainfall       0      0     24
       -> p2p_test_MessageMSGCB       0      0     24
       -> NLME_GetShortAddr           0      0     24
       -> NLME_GetCoordShortAddr      0      0     24
       -> NLME_GetExtAddr             0      0     24
       -> p2p_test_SendTheMessage     0      0     24
       -> osal_start_timerEx          0      0     24
     p2p_test_ProcessZDOMsgs          0      0     22
       -> HalLedSet                   0      0     20
       -> HalLedSet                   0      0     20
       -> ZDO_ParseEPListRsp          0      0     20
       -> HalLedSet                   0      0     20
       -> osal_mem_free               0      0     20
     p2p_test_SendRainfall            1      0     34
       -> AF_DataRequest              0      0     44
     p2p_test_SendTheMessage          0      0     31
       -> AF_DataRequest              0      0     38


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     p2p_test_ClusterList              4
     p2p_test_SimpleDesc              12
     p2p_test_epDesc                   6
     p2p_test_TaskID                   1
     p2p_test_NwkState                 1
     p2p_test_TransID                  1
     p2p_test_DstAddr                  4
     p2p_msg                           6
     shortaddr                         2
     fatheraddr                        2
     p2p_test_Init                   116
     p2p_test_ProcessEvent           236
     p2p_test_ProcessZDOMsgs         153
     ?Subroutine1                     10
     ?Subroutine0                     10
     p2p_test_SendRainfall           131
     p2p_test_HandleKeys             235
     ?Subroutine2                      4
     p2p_test_MessageMSGCB           135
     p2p_test_SendTheMessage          70
     ?<Initializer for p2p_test_ClusterList>
                                       4
     ?<Initializer for p2p_test_SimpleDesc>
                                      12
     ??p2p_test_Init?relay             6
     ??p2p_test_ProcessEvent?relay     6
     ??p2p_test_ProcessZDOMsgs?relay
                                       6
     ??p2p_test_SendRainfall?relay     6
     ??p2p_test_HandleKeys?relay       6
     ??p2p_test_MessageMSGCB?relay     6
     ??p2p_test_SendTheMessage?relay
                                       6

 
 1 100 bytes in segment BANKED_CODE
    42 bytes in segment BANK_RELAYS
    16 bytes in segment XDATA_I
    16 bytes in segment XDATA_ID
    23 bytes in segment XDATA_Z
 
 1 158 bytes of CODE  memory
    39 bytes of XDATA memory

Errors: none
Warnings: none
