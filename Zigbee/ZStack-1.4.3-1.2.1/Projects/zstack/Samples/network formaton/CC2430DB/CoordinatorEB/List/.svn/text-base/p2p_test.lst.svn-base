###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    24/Jun/2009  11:10:12 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\p2p_test(coordinator)\Source\p2p_tes #
#                          t.c                                                #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\p2p_test(coordinator)\CC2430DB\. #
#                          .\..\..\Tools\CC2430DB\f8wCoord.cfg" (-DCPU32MHZ   #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS           #
#                          "-DCONST=const __code" -DGENERIC=__generic) -f     #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\p2p_test(coordinator)\CC2430DB\..\. #
#                          .\..\Tools\CC2430DB\f8wConfig.cfg" (-DSECURE=0     #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFF0F                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\Source\p2p_test.c" -D   #
#                          CC2430EB -D xREFLECTOR -D ZTOOL_P1 -D MT_TASK -D   #
#                          MT_ZDO_FUNC -D xLCD_SUPPORTED=DEBUG -lC "C:\Texas  #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\CoordinatorEB\ #
#                          List\" -lA "C:\Texas Instruments\ZStack-1.4.3-1.2. #
#                          1\Projects\zstack\Samples\p2p_test(coordinator)\CC #
#                          2430DB\CoordinatorEB\List\" --diag_suppress        #
#                          Pe001,Pa010 --diag_remark pe550 -o "C:\Texas       #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\CoordinatorEB\ #
#                          Obj\" -e --require_prototypes -z9                  #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data --nr_virtual_regs 8 -I      #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\p2p_test(coordinator)\CC2430DB\"    #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\p2p_test(coordinator)\CC2430DB\. #
#                          .\SOURCE\" -I "C:\Texas Instruments\ZStack-1.4.3-1 #
#                          .2.1\Projects\zstack\Samples\p2p_test(coordinator) #
#                          \CC2430DB\..\..\..\ZMAIN\TI2430DB\" -I "C:\Texas   #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MT\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\HAL\TARGET\CC2430EB\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\OSAL\INCLUDE\" -I "C:\Texas            #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\AF\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\NWK\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SEC\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\SYS\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\STACK\ZDO\" -I "C:\Texas               #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\F8W\" -I "C:\Texas                #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\ZMAC\" -I "C:\Texas                    #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SADDR\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\SERVICES\SDATA\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\INCLUDE\" -I "C:\Texas             #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas          #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\" -I "C:\Texas     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\p2p_test(coordinator)\CC2430DB\..\..\..\..\.. #
#                          \COMPONENTS\MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I   #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          4.0 Evaluation version\8051\INC\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\p2p_test(coordinator)\CC2430DB\Coord #
#                          inatorEB\List\p2p_test.lst                         #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\p2p_test(coordinator)\CC2430DB\Coord #
#                          inatorEB\Obj\p2p_test.r51                          #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Samples\p2p_test(coordinator)\Source\p2p_test.c
      1          /**************************************************************************************************
      2            Filename:       p2p_test.c
      3            Revised:        $Date: 2007-10-27 17:16:54 -0700 (Sat, 27 Oct 2007) $
      4            Revision:       $Revision: 15793 $
      5          
      6            Description:    Generic Application (no Profile).
      7          
      8          
      9            Copyright 2004-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends "Hello World" to another "Generic"
     45            application every 15 seconds.  The application will also
     46            receive "Hello World" packets.
     47          
     48            The "Hello World" messages are sent/received as MSG type message.
     49          
     50            This applications doesn't have a profile, so it handles everything
     51            directly - itself.
     52          
     53            Key control:
     54              SW1:
     55              SW2:  initiates end device binding
     56              SW3:
     57              SW4:  initiates a match description request
     58          *********************************************************************/
     59          
     60          /*********************************************************************
     61           * INCLUDES
     62           */
     63          #include "OSAL.h"
     64          #include "AF.h"
     65          #include "ZDApp.h"
     66          #include "ZDObject.h"
     67          #include "ZDProfile.h"
     68          
     69          #include "p2p_test.h"
     70          #include "DebugTrace.h"
     71          
     72          #if !defined( WIN32 )
     73            #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc6
   \   unsigned char volatile __sfr CLKCON
   \                     CLKCON:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf4
   \   unsigned char volatile __sfr P1SEL
   \                     P1SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
     74          #endif
     75          
     76          /* HAL */
     77          #include "hal_lcd.h"
     78          #include "hal_led.h"
     79          #include "hal_key.h"
     80          #include "hal_uart.h"
     81          
     82          /*********************************************************************
     83           * MACROS
     84           */
     85           #define DATA P1_1
     86          #define SCK P1_0
     87          
     88          /*********************************************************************
     89           * CONSTANTS
     90           */
     91          #define CLKSPD_1  (CLKCON & 0x01)
     92          
     93          
     94          // This list should be filled with Application specific Cluster IDs.
     95          /*********************************************************************
     96           * TYPEDEFS
     97           */
     98          
     99          /*********************************************************************
    100           * GLOBAL VARIABLES
    101           */
    102          
    103          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_I, align 1, keep-with-next
    104          const cId_t p2p_test_ClusterList[p2p_test_MAX_CLUSTERS] =
   \                     p2p_test_ClusterList:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for p2p_test_ClusterList>`
   \   000002                REQUIRE __INIT_XDATA_I
    105          {
    106            p2p_test_CLUSTERID
    107          };
    108          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    109          const SimpleDescriptionFormat_t p2p_test_SimpleDesc =
   \                     p2p_test_SimpleDesc:
   \   000000                DS 12
   \   00000C                REQUIRE `?<Initializer for p2p_test_SimpleDesc>`
   \   00000C                REQUIRE __INIT_XDATA_I
    110          {
    111            p2p_test_ENDPOINT,              //  int Endpoint;
    112            p2p_test_PROFID,                //  uint16 AppProfId[2];
    113            p2p_test_DEVICEID,              //  uint16 AppDeviceId[2];
    114            p2p_test_DEVICE_VERSION,        //  int   AppDevVer:4;
    115            p2p_test_FLAGS,                 //  int   AppFlags:4;
    116            p2p_test_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    117            (cId_t *)p2p_test_ClusterList,  //  byte *pAppInClusterList;
    118            p2p_test_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    119            (cId_t *)p2p_test_ClusterList   //  byte *pAppInClusterList;
    120          };
    121          
    122          // This is the Endpoint/Interface description.  It is defined here, but
    123          // filled-in in p2p_test_Init().  Another way to go would be to fill
    124          // in the structure here and make it a "const" (in code space).  The
    125          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    126          endPointDesc_t p2p_test_epDesc;
   \                     p2p_test_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    127          
    128          /*********************************************************************
    129           * EXTERNAL VARIABLES
    130           */
    131          
    132          /*********************************************************************
    133           * EXTERNAL FUNCTIONS
    134           */
    135          
    136          /*********************************************************************
    137           * LOCAL VARIABLES
    138           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    139          byte p2p_test_TaskID;   // Task ID for internal task/event processing
   \                     p2p_test_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    140                                    // This variable will be received when
    141                                    // p2p_test_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          devStates_t p2p_test_NwkState;
   \                     p2p_test_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    143          
    144          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    145          byte p2p_test_TransID;  // This is the unique message ID (counter)
   \                     p2p_test_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    146          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    147          afAddrType_t p2p_test_DstAddr;
   \                     p2p_test_DstAddr:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    148           char p2p_msg[];//the collect message
   \                     p2p_msg:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    149           //uint8 ii = 0;//FOR SENSOR TEST
    150          /*********************************************************************
    151           * LOCAL FUNCTIONS
    152           */
    153          void p2p_test_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    154          void p2p_test_HandleKeys( byte shift, byte keys );
    155          void p2p_test_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    156          void p2p_test_SendTheMessage( void );
    157          byte haltemp(void); //wendu
    158          byte halhumi(void); //shidu
    159          void halWait(byte Wait);
    160          
    161          /*********************************************************************
    162           * NETWORK LAYER CALLBACKS
    163           */
    164          
    165          /*********************************************************************
    166           * PUBLIC FUNCTIONS
    167           */
    168          
    169          /*********************************************************************
    170           * @fn      p2p_test_Init
    171           *
    172           * @brief   Initialization function for the Generic App Task.
    173           *          This is called during initialization and should contain
    174           *          any application specific initialization (ie. hardware
    175           *          initialization/setup, table initialization, power up
    176           *          notificaiton ... ).
    177           *
    178           * @param   task_id - the ID assigned by OSAL.  This ID should be
    179           *                    used to send messages and set timers.
    180           *
    181           * @return  none
    182           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    183          void p2p_test_Init( byte task_id )
   \                     p2p_test_Init:
    184          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    185            p2p_test_TaskID = task_id;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#p2p_test_TaskID
   \   000008   F0           MOVX    @DPTR,A
    186            p2p_test_NwkState = DEV_INIT;
   \   000009   7401         MOV     A,#0x1
   \   00000B   90....       MOV     DPTR,#p2p_test_NwkState
   \   00000E   F0           MOVX    @DPTR,A
    187            p2p_test_TransID = 0;
   \   00000F   E4           CLR     A
   \   000010   90....       MOV     DPTR,#p2p_test_TransID
   \   000013   F0           MOVX    @DPTR,A
    188          
    189            // Device hardware initialization can be added here or in main() (Zmain.c).
    190            // If the hardware is application specific - add it here.
    191            // If the hardware is other parts of the device add it in main().
    192          
    193            p2p_test_DstAddr.addrMode = (afAddrMode_t)AddrBroadcast;
   \   000014   740F         MOV     A,#0xf
   \   000016   90....       MOV     DPTR,#(p2p_test_DstAddr + 2)
   \   000019   F0           MOVX    @DPTR,A
    194            p2p_test_DstAddr.endPoint = 10;
   \   00001A   740A         MOV     A,#0xa
   \   00001C   90....       MOV     DPTR,#(p2p_test_DstAddr + 3)
   \   00001F   F0           MOVX    @DPTR,A
    195            p2p_test_DstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
   \   000020   90....       MOV     DPTR,#p2p_test_DstAddr
   \   000023   74FF         MOV     A,#-0x1
   \   000025   F0           MOVX    @DPTR,A
   \   000026   A3           INC     DPTR
   \   000027   F0           MOVX    @DPTR,A
    196          
    197            // Fill out the endpoint description.
    198            p2p_test_epDesc.endPoint = p2p_test_ENDPOINT;
   \   000028   740A         MOV     A,#0xa
   \   00002A   90....       MOV     DPTR,#p2p_test_epDesc
   \   00002D   F0           MOVX    @DPTR,A
    199            p2p_test_epDesc.task_id = &p2p_test_TaskID;
   \   00002E   90....       MOV     DPTR,#(p2p_test_epDesc + 1)
   \   000031   74..         MOV     A,#(p2p_test_TaskID & 0xff)
   \   000033   F0           MOVX    @DPTR,A
   \   000034   A3           INC     DPTR
   \   000035   74..         MOV     A,#((p2p_test_TaskID >> 8) & 0xff)
   \   000037   F0           MOVX    @DPTR,A
    200            p2p_test_epDesc.simpleDesc
    201                      = (SimpleDescriptionFormat_t *)&p2p_test_SimpleDesc;
   \   000038   90....       MOV     DPTR,#(p2p_test_epDesc + 3)
   \   00003B   74..         MOV     A,#(p2p_test_SimpleDesc & 0xff)
   \   00003D   F0           MOVX    @DPTR,A
   \   00003E   A3           INC     DPTR
   \   00003F   74..         MOV     A,#((p2p_test_SimpleDesc >> 8) & 0xff)
   \   000041   F0           MOVX    @DPTR,A
    202            p2p_test_epDesc.latencyReq = noLatencyReqs;
   \   000042   E4           CLR     A
   \   000043   90....       MOV     DPTR,#(p2p_test_epDesc + 5)
   \   000046   F0           MOVX    @DPTR,A
    203          
    204            // Register the endpoint description with the AF
    205            afRegister( &p2p_test_epDesc );
   \   000047                ; Setup parameters for call to function afRegister
   \   000047   7A..         MOV     R2,#(p2p_test_epDesc & 0xff)
   \   000049   7B..         MOV     R3,#((p2p_test_epDesc >> 8) & 0xff)
   \   00004B   12....       LCALL   ??afRegister?relay
    206          
    207            // Register for all key events - This app will handle all key events
    208            RegisterForKeys( p2p_test_TaskID );
   \   00004E                ; Setup parameters for call to function RegisterForKeys
   \   00004E   90....       MOV     DPTR,#p2p_test_TaskID
   \   000051   E0           MOVX    A,@DPTR
   \   000052   F9           MOV     R1,A
   \   000053   12....       LCALL   ??RegisterForKeys?relay
    209          
    210          
    211          
    212            // Update the display
    213          #if defined ( LCD_SUPPORTED )
    214              HalLcdWriteString( "p2p_test", HAL_LCD_LINE_1 );
    215          #endif
    216          
    217            ZDO_RegisterForZDOMsg( p2p_test_TaskID, End_Device_Bind_rsp );
   \   000056                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000056   7A20         MOV     R2,#0x20
   \   000058   7B80         MOV     R3,#-0x80
   \   00005A   90....       MOV     DPTR,#p2p_test_TaskID
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   F9           MOV     R1,A
   \   00005F   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    218            ZDO_RegisterForZDOMsg( p2p_test_TaskID, Match_Desc_rsp );
   \   000062                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000062   7A06         MOV     R2,#0x6
   \   000064   7B80         MOV     R3,#-0x80
   \   000066   90....       MOV     DPTR,#p2p_test_TaskID
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F9           MOV     R1,A
   \   00006B   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
    219          }
   \   00006E   D083         POP     DPH
   \   000070   D082         POP     DPL
   \   000072   02....       LJMP    ?BRET
    220          
    221          /*********************************************************************
    222           * @fn      p2p_test_ProcessEvent
    223           *
    224           * @brief   Generic Application Task event processor.  This function
    225           *          is called to process all events for the task.  Events
    226           *          include timers, messages and any other user defined events.
    227           *
    228           * @param   task_id  - The OSAL assigned task ID.
    229           * @param   events - events to process.  This is a bit map and can
    230           *                   contain more than one event.
    231           *
    232           * @return  none
    233           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    234          UINT16 p2p_test_ProcessEvent( byte task_id, UINT16 events )
   \                     p2p_test_ProcessEvent:
    235          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    236            afIncomingMSGPacket_t *MSGpkt;
    237            afDataConfirm_t *afDataConfirm;
    238          
    239            // Data Confirmation message fields
    240            byte sentEP;
    241            ZStatus_t sentStatus;
    242            byte sentTransID;       // This should match the value sent
    243          
    244            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??p2p_test_ProcessEvent_0
   \   000010   E9           MOV     A,R1
   \                     ??p2p_test_ProcessEvent_0:
   \   000011   7003         JNZ     $+5
   \   000013   02....       LJMP    ??p2p_test_ProcessEvent_1 & 0xFFFF
    245            {
    246              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( p2p_test_TaskID );
   \   000016                ; Setup parameters for call to function osal_msg_receive
   \   000016   8013         SJMP    ??p2p_test_ProcessEvent_2
    247              while ( MSGpkt )
    248              {
    249                switch ( MSGpkt->hdr.event )
    250                {
    251                  case ZDO_CB_MSG:
    252                    p2p_test_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    253                    break;
    254          
    255                  case KEY_CHANGE:
    256                    p2p_test_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    257                    break;
    258          
    259                  case AF_DATA_CONFIRM_CMD:
    260                    // This message is received as a confirmation of a data packet sent.
    261                    // The status is of ZStatus_t type [defined in ZComDef.h]
    262                    // The message fields are defined in AF.h
    263                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    264                    sentEP = afDataConfirm->endpoint;
    265                    sentStatus = afDataConfirm->hdr.status;
    266                    sentTransID = afDataConfirm->transID;
    267                    (void)sentEP;
    268                    (void)sentTransID;
    269          
    270                    // Action taken when confirmation is received.
    271                    if ( sentStatus != ZSuccess )
    272                    {
    273                      // The data wasn't delivered -- Do something
    274                    }
    275                    break;
    276          
    277                  case AF_INCOMING_MSG_CMD:
    278                    p2p_test_MessageMSGCB( MSGpkt );
    279                    HalLedSet( HAL_LED_1, HAL_LED_MODE_ON );
    280                MicroWait( 62500 );
    281                MicroWait( 62500 );
    282                HalLedSet( HAL_LED_1, HAL_LED_MODE_OFF );
    283                    break;
    284          
    285                  case ZDO_STATE_CHANGE:
    286                    p2p_test_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \                     ??p2p_test_ProcessEvent_3:
   \   000018   85..82       MOV     DPL,?V0 + 0
   \   00001B   85..83       MOV     DPH,?V0 + 1
   \   00001E   A3           INC     DPTR
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   90....       MOV     DPTR,#p2p_test_NwkState
   \   000023   F0           MOVX    @DPTR,A
    287                    if ( (p2p_test_NwkState == DEV_ZB_COORD)
    288                        || (p2p_test_NwkState == DEV_ROUTER)
    289                        || (p2p_test_NwkState == DEV_END_DEVICE) )
    290                    {
    291                      // Start sending "the" message in a regular interval.
    292          //            osal_start_timerEx( p2p_test_TaskID,
    293          //                                p2p_test_SEND_MSG_EVT,
    294          //                                p2p_test_SEND_MSG_TIMEOUT );
    295                    }
    296                    break;
    297          
    298                  default:
    299                    break;
    300                }
    301          
    302                // Release the memory
    303                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??p2p_test_ProcessEvent_4:
   \   000024                ; Setup parameters for call to function osal_msg_deallocate
   \   000024   AA..         MOV     R2,?V0 + 0
   \   000026   AB..         MOV     R3,?V0 + 1
   \   000028   12....       LCALL   ??osal_msg_deallocate?relay
    304          
    305                // Next
    306                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( p2p_test_TaskID );
   \   00002B                ; Setup parameters for call to function osal_msg_receive
   \                     ??p2p_test_ProcessEvent_2:
   \   00002B   90....       MOV     DPTR,#p2p_test_TaskID
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   F9           MOV     R1,A
   \   000030   12....       LCALL   ??osal_msg_receive?relay
   \   000033   8A..         MOV     ?V0 + 0,R2
   \   000035   8B..         MOV     ?V0 + 1,R3
   \   000037   E5..         MOV     A,?V0 + 0
   \   000039   7002         JNZ     ??p2p_test_ProcessEvent_5
   \   00003B   E5..         MOV     A,?V0 + 1
   \                     ??p2p_test_ProcessEvent_5:
   \   00003D   6062         JZ      ??p2p_test_ProcessEvent_6
   \   00003F   85..82       MOV     DPL,?V0 + 0
   \   000042   85..83       MOV     DPH,?V0 + 1
   \   000045   E0           MOVX    A,@DPTR
   \   000046   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for p2p_test_ProcessEvent>_0`:
   \   000049   00           DB        0
   \   00004A   04           DB        4
   \   00004B   1A           DB        26
   \   00004C   ....         DW        ??p2p_test_ProcessEvent_7
   \   00004E   C0           DB        192
   \   00004F   ....         DW        ??p2p_test_ProcessEvent_8
   \   000051   D1           DB        209
   \   000052   ....         DW        ??p2p_test_ProcessEvent_3
   \   000054   D3           DB        211
   \   000055   ....         DW        ??p2p_test_ProcessEvent_9
   \   000057   ....         DW        ??p2p_test_ProcessEvent_4
   \                     ??p2p_test_ProcessEvent_9:
   \   000059                ; Setup parameters for call to function p2p_test_ProcessZDOMsgs
   \   000059   AA..         MOV     R2,?V0 + 0
   \   00005B   AB..         MOV     R3,?V0 + 1
   \   00005D   12....       LCALL   ??p2p_test_ProcessZDOMsgs?relay
   \   000060   80C2         SJMP    ??p2p_test_ProcessEvent_4
   \                     ??p2p_test_ProcessEvent_8:
   \   000062                ; Setup parameters for call to function p2p_test_HandleKeys
   \   000062   85..82       MOV     DPL,?V0 + 0
   \   000065   85..83       MOV     DPH,?V0 + 1
   \   000068   A3           INC     DPTR
   \   000069   A3           INC     DPTR
   \   00006A   A3           INC     DPTR
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   FA           MOV     R2,A
   \   00006D   85..82       MOV     DPL,?V0 + 0
   \   000070   85..83       MOV     DPH,?V0 + 1
   \   000073   A3           INC     DPTR
   \   000074   A3           INC     DPTR
   \   000075   E0           MOVX    A,@DPTR
   \   000076   F9           MOV     R1,A
   \   000077   12....       LCALL   ??p2p_test_HandleKeys?relay
   \   00007A   80A8         SJMP    ??p2p_test_ProcessEvent_4
   \                     ??p2p_test_ProcessEvent_7:
   \   00007C                ; Setup parameters for call to function p2p_test_MessageMSGCB
   \   00007C   AA..         MOV     R2,?V0 + 0
   \   00007E   AB..         MOV     R3,?V0 + 1
   \   000080   12....       LCALL   ??p2p_test_MessageMSGCB?relay
   \   000083                ; Setup parameters for call to function HalLedSet
   \   000083   7A01         MOV     R2,#0x1
   \   000085   7901         MOV     R1,#0x1
   \   000087   12....       LCALL   ??HalLedSet?relay
   \   00008A                ; Setup parameters for call to function Onboard_wait
   \   00008A   7A24         MOV     R2,#0x24
   \   00008C   7BF4         MOV     R3,#-0xc
   \   00008E   12....       LCALL   ??Onboard_wait?relay
   \   000091                ; Setup parameters for call to function Onboard_wait
   \   000091   7A24         MOV     R2,#0x24
   \   000093   7BF4         MOV     R3,#-0xc
   \   000095   12....       LCALL   ??Onboard_wait?relay
   \   000098                ; Setup parameters for call to function HalLedSet
   \   000098   7A00         MOV     R2,#0x0
   \   00009A   7901         MOV     R1,#0x1
   \   00009C   12....       LCALL   ??HalLedSet?relay
   \   00009F   8083         SJMP    ??p2p_test_ProcessEvent_4
    307              }
    308          
    309              // return unprocessed events
    310              return (events ^ SYS_EVENT_MSG);
   \                     ??p2p_test_ProcessEvent_6:
   \   0000A1   EE           MOV     A,R6
   \   0000A2   FA           MOV     R2,A
   \   0000A3   7480         MOV     A,#-0x80
   \   0000A5   6F           XRL     A,R7
   \                     ??p2p_test_ProcessEvent_10:
   \   0000A6   FB           MOV     R3,A
   \   0000A7   8023         SJMP    ??p2p_test_ProcessEvent_11
    311            }
    312          
    313            // Send a message out - This event is generated by a timer
    314            //  (setup in p2p_test_Init()).
    315            if ( events & p2p_test_SEND_MSG_EVT )
   \                     ??p2p_test_ProcessEvent_1:
   \   0000A9   EE           MOV     A,R6
   \   0000AA   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000AC   501A         JNC     ??p2p_test_ProcessEvent_12
    316            {
    317             //collect the temp and humi
    318              
    319              //ADDED FOR SENSOR TEST
    320          
    321                //p2p_msg[1]=haltemp();//
    322                //p2p_msg[0]=halhumi();//
    323          
    324            //ADDED FOR SENSOR TEST
    325              
    326              // Send "the" message
    327              p2p_test_SendTheMessage();
   \   0000AE                ; Setup parameters for call to function p2p_test_SendTheMessage
   \   0000AE   12....       LCALL   ??p2p_test_SendTheMessage?relay
    328          
    329              // Setup to send message again
    330              osal_start_timerEx( p2p_test_TaskID,
    331                                  p2p_test_SEND_MSG_EVT,
    332                                  p2p_test_SEND_MSG_TIMEOUT );
   \   0000B1                ; Setup parameters for call to function osal_start_timerEx
   \   0000B1   7CE8         MOV     R4,#-0x18
   \   0000B3   7D03         MOV     R5,#0x3
   \   0000B5   7A01         MOV     R2,#0x1
   \   0000B7   7B00         MOV     R3,#0x0
   \   0000B9   90....       MOV     DPTR,#p2p_test_TaskID
   \   0000BC   E0           MOVX    A,@DPTR
   \   0000BD   F9           MOV     R1,A
   \   0000BE   12....       LCALL   ??osal_start_timerEx?relay
    333          
    334              // return unprocessed events
    335              return (events ^ p2p_test_SEND_MSG_EVT);
   \   0000C1   7401         MOV     A,#0x1
   \   0000C3   6E           XRL     A,R6
   \   0000C4   FA           MOV     R2,A
   \   0000C5   EF           MOV     A,R7
   \   0000C6   80DE         SJMP    ??p2p_test_ProcessEvent_10
    336            }
    337          
    338            // Discard unknown events
    339            return 0;
   \                     ??p2p_test_ProcessEvent_12:
   \   0000C8   7A00         MOV     R2,#0x0
   \   0000CA   7B00         MOV     R3,#0x0
   \                     ??p2p_test_ProcessEvent_11:
   \   0000CC   7F04         MOV     R7,#0x4
   \   0000CE   02....       LJMP    ?BANKED_LEAVE_XDATA
    340          }
    341          
    342          /*********************************************************************
    343           * Event Generation Functions
    344           */
    345          /*********************************************************************
    346           * @fn      p2p_test_ProcessZDOMsgs()
    347           *
    348           * @brief   Process response messages
    349           *
    350           * @param   none
    351           *
    352           * @return  none
    353           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    354          void p2p_test_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
   \                     p2p_test_ProcessZDOMsgs:
    355          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    356            switch ( inMsg->clusterID )
   \   000005   EA           MOV     A,R2
   \   000006   240C         ADD     A,#0xc
   \   000008   F582         MOV     DPL,A
   \   00000A   EB           MOV     A,R3
   \   00000B   3400         ADDC    A,#0x0
   \   00000D   F583         MOV     DPH,A
   \   00000F   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000012   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for p2p_test_ProcessZDOMsgs>_0`:
   \   000015   0000         DW        0
   \   000017   0200         DW        2
   \   000019   0680         DW        32774
   \   00001B   ....         DW        ??p2p_test_ProcessZDOMsgs_0
   \   00001D   2080         DW        32800
   \   00001F   ....         DW        ??p2p_test_ProcessZDOMsgs_1
   \   000021   ....         DW        ??p2p_test_ProcessZDOMsgs_2
    357            {
    358              case End_Device_Bind_rsp:
    359                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
   \                     ??p2p_test_ProcessZDOMsgs_1:
   \   000023   EA           MOV     A,R2
   \   000024   2411         ADD     A,#0x11
   \   000026   F582         MOV     DPL,A
   \   000028   EB           MOV     A,R3
   \   000029   3400         ADDC    A,#0x0
   \   00002B   F583         MOV     DPH,A
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   F8           MOV     R0,A
   \   00002F   A3           INC     DPTR
   \   000030   E0           MOVX    A,@DPTR
   \   000031   F583         MOV     DPH,A
   \   000033   8882         MOV     DPL,R0
   \   000035   E0           MOVX    A,@DPTR
   \   000036   7009         JNZ     ??p2p_test_ProcessZDOMsgs_3
    360                {
    361                  // Light LED
    362                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   000038                ; Setup parameters for call to function HalLedSet
   \   000038   7A01         MOV     R2,#0x1
   \                     ??p2p_test_ProcessZDOMsgs_4:
   \   00003A   7908         MOV     R1,#0x8
   \   00003C   12....       LCALL   ??HalLedSet?relay
   \   00003F   8055         SJMP    ??p2p_test_ProcessZDOMsgs_2
    363                }
    364          #if defined(BLINK_LEDS)
    365                else
    366                {
    367                  // Flash LED to show failure
    368                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
   \                     ??p2p_test_ProcessZDOMsgs_3:
   \   000041                ; Setup parameters for call to function HalLedSet
   \   000041   7A04         MOV     R2,#0x4
   \   000043   80F5         SJMP    ??p2p_test_ProcessZDOMsgs_4
    369                }
    370          #endif
    371                break;
    372          
    373              case Match_Desc_rsp:
    374                {
    375                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
   \                     ??p2p_test_ProcessZDOMsgs_0:
   \   000045                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   000045   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   000048   8A..         MOV     ?V0 + 0,R2
   \   00004A   8B..         MOV     ?V0 + 1,R3
   \   00004C   AE..         MOV     R6,?V0 + 0
   \   00004E   AF..         MOV     R7,?V0 + 1
    376                  if ( pRsp )
   \   000050   EE           MOV     A,R6
   \   000051   7001         JNZ     ??p2p_test_ProcessZDOMsgs_5
   \   000053   EF           MOV     A,R7
   \                     ??p2p_test_ProcessZDOMsgs_5:
   \   000054   6040         JZ      ??p2p_test_ProcessZDOMsgs_2
    377                  {
    378                    if ( pRsp->status == ZSuccess && pRsp->cnt )
   \   000056   8E82         MOV     DPL,R6
   \   000058   8F83         MOV     DPH,R7
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   7032         JNZ     ??p2p_test_ProcessZDOMsgs_6
   \   00005D   A3           INC     DPTR
   \   00005E   A3           INC     DPTR
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   602C         JZ      ??p2p_test_ProcessZDOMsgs_6
    379                    {
    380                      p2p_test_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000063   7402         MOV     A,#0x2
   \   000065   90....       MOV     DPTR,#(p2p_test_DstAddr + 2)
   \   000068   F0           MOVX    @DPTR,A
    381                      p2p_test_DstAddr.addr.shortAddr = pRsp->nwkAddr;
   \   000069   8E82         MOV     DPL,R6
   \   00006B   8F83         MOV     DPH,R7
   \   00006D   A3           INC     DPTR
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F8           MOV     R0,A
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   F9           MOV     R1,A
   \   000073   90....       MOV     DPTR,#p2p_test_DstAddr
   \   000076   E8           MOV     A,R0
   \   000077   F0           MOVX    @DPTR,A
   \   000078   A3           INC     DPTR
   \   000079   E9           MOV     A,R1
   \   00007A   F0           MOVX    @DPTR,A
    382                      // Take the first endpoint, Can be changed to search through endpoints
    383                      p2p_test_DstAddr.endPoint = pRsp->epList[0];
   \   00007B   8E82         MOV     DPL,R6
   \   00007D   8F83         MOV     DPH,R7
   \   00007F   A3           INC     DPTR
   \   000080   A3           INC     DPTR
   \   000081   A3           INC     DPTR
   \   000082   A3           INC     DPTR
   \   000083   E0           MOVX    A,@DPTR
   \   000084   90....       MOV     DPTR,#(p2p_test_DstAddr + 3)
   \   000087   F0           MOVX    @DPTR,A
    384          
    385                      // Light LED
    386                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   000088                ; Setup parameters for call to function HalLedSet
   \   000088   7A01         MOV     R2,#0x1
   \   00008A   7908         MOV     R1,#0x8
   \   00008C   12....       LCALL   ??HalLedSet?relay
    387                    }
    388                    osal_mem_free( pRsp );
   \                     ??p2p_test_ProcessZDOMsgs_6:
   \   00008F                ; Setup parameters for call to function osal_mem_free
   \   00008F   EE           MOV     A,R6
   \   000090   FA           MOV     R2,A
   \   000091   EF           MOV     A,R7
   \   000092   FB           MOV     R3,A
   \   000093   12....       LCALL   ??osal_mem_free?relay
    389                  }
    390                }
    391                break;
    392            }
    393          }
   \                     ??p2p_test_ProcessZDOMsgs_2:
   \   000096   02....       LJMP    ??Subroutine19_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??Subroutine19_0:
   \   000003   7F02         MOV     R7,#0x2
   \   000005   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F5..         MOV     ?V0 + 0,A
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   F5..         MOV     ?V0 + 1,A
   \   000007   78..         MOV     R0,#?V0 + 0
   \   000009   22           RET
    394          
    395          /*********************************************************************
    396           * @fn      p2p_test_HandleKeys
    397           *
    398           * @brief   Handles all key events for this device.
    399           *
    400           * @param   shift - true if in shift/alt.
    401           * @param   keys - bit field for key events. Valid entries:
    402           *                 HAL_KEY_SW_4
    403           *                 HAL_KEY_SW_3
    404           *                 HAL_KEY_SW_2
    405           *                 HAL_KEY_SW_1
    406           *
    407           * @return  none
    408           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    409          void p2p_test_HandleKeys( byte shift, byte keys )
   \                     p2p_test_HandleKeys:
    410          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
    411            zAddrType_t dstAddr;
    412          
    413            // Shift is used to make each button/switch dual purpose.
    414            if ( shift )
   \   00000C   E9           MOV     A,R1
   \   00000D   6003         JZ      $+5
   \   00000F   02....       LJMP    ??p2p_test_HandleKeys_0 & 0xFFFF
    415            {
    416              if ( keys & HAL_KEY_SW_1 )
    417              {
    418              }
    419              if ( keys & HAL_KEY_SW_2 )
    420              {
    421              }
    422              if ( keys & HAL_KEY_SW_3 )
    423              {
    424              }
    425              if ( keys & HAL_KEY_SW_4 )
    426              {
    427              }
    428            }
    429            else
    430            {
    431              if ( keys & HAL_KEY_SW_1 )
    432              {
    433              }
    434          
    435              if ( keys & HAL_KEY_SW_2 )
   \   000012   EE           MOV     A,R6
   \   000013   A2E1         MOV     C,0xE0 /* A   */.1
   \   000015   5070         JNC     ??p2p_test_HandleKeys_1
    436              {
    437                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   000017                ; Setup parameters for call to function HalLedSet
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7908         MOV     R1,#0x8
   \   00001B   12....       LCALL   ??HalLedSet?relay
    438          
    439                // Initiate an End Device Bind Request for the mandatory endpoint
    440                dstAddr.addrMode = Addr16Bit;
   \   00001E   7408         MOV     A,#0x8
   \   000020   12....       LCALL   ?XSTACK_DISP0_8
   \   000023   7402         MOV     A,#0x2
   \   000025   F0           MOVX    @DPTR,A
    441                dstAddr.addr.shortAddr = 0x0000; // Coordinator
   \   000026   85..82       MOV     DPL,?XSP + 0
   \   000029   85..83       MOV     DPH,?XSP + 1
   \   00002C   E4           CLR     A
   \   00002D   F0           MOVX    @DPTR,A
   \   00002E   A3           INC     DPTR
   \   00002F   F0           MOVX    @DPTR,A
    442                ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(),
    443                                      p2p_test_epDesc.endPoint,
    444                                      p2p_test_PROFID,
    445                                      p2p_test_MAX_CLUSTERS, (cId_t *)p2p_test_ClusterList,
    446                                      p2p_test_MAX_CLUSTERS, (cId_t *)p2p_test_ClusterList,
    447                                      FALSE );
   \   000030                ; Setup parameters for call to function NLME_GetShortAddr
   \   000030   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000033   8A..         MOV     ?V0 + 0,R2
   \   000035   8B..         MOV     ?V0 + 1,R3
   \   000037   AC..         MOV     R4,?V0 + 0
   \   000039   AD..         MOV     R5,?V0 + 1
   \   00003B                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   00003B   75..00       MOV     ?V0 + 0,#0x0
   \   00003E   78..         MOV     R0,#?V0 + 0
   \   000040   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000043   75....       MOV     ?V0 + 0,#(p2p_test_ClusterList & 0xff)
   \   000046   75....       MOV     ?V0 + 1,#((p2p_test_ClusterList >> 8) & 0xff)
   \   000049   78..         MOV     R0,#?V0 + 0
   \   00004B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004E   75..01       MOV     ?V0 + 0,#0x1
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000056   75....       MOV     ?V0 + 0,#(p2p_test_ClusterList & 0xff)
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005E   75..01       MOV     ?V0 + 0,#0x1
   \   000061   78..         MOV     R0,#?V0 + 0
   \   000063   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000066   75..04       MOV     ?V0 + 0,#0x4
   \   000069   75..0F       MOV     ?V0 + 1,#0xf
   \   00006C   78..         MOV     R0,#?V0 + 0
   \   00006E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000071   90....       MOV     DPTR,#p2p_test_epDesc
   \   000074   E0           MOVX    A,@DPTR
   \   000075   F9           MOV     R1,A
   \   000076   7409         MOV     A,#0x9
   \   000078   12....       LCALL   ?XSTACK_DISP0_8
   \   00007B   AA82         MOV     R2,DPL
   \   00007D   AB83         MOV     R3,DPH
   \   00007F   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   000082   7409         MOV     A,#0x9
   \   000084   12....       LCALL   ?DEALLOC_XSTACK8
    448              }
    449          
    450              if ( keys & HAL_KEY_SW_3 )
    451              {
    452              }
    453          
    454              if ( keys & HAL_KEY_SW_4 )
   \                     ??p2p_test_HandleKeys_1:
   \   000087   EE           MOV     A,R6
   \   000088   A2E3         MOV     C,0xE0 /* A   */.3
   \   00008A   505F         JNC     ??p2p_test_HandleKeys_0
    455              {
    456                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   00008C                ; Setup parameters for call to function HalLedSet
   \   00008C   7A00         MOV     R2,#0x0
   \   00008E   7908         MOV     R1,#0x8
   \   000090   12....       LCALL   ??HalLedSet?relay
    457          
    458                // Initiate a Match Description Request (Service Discovery)
    459                dstAddr.addrMode = AddrBroadcast;
   \   000093   7408         MOV     A,#0x8
   \   000095   12....       LCALL   ?XSTACK_DISP0_8
   \   000098   740F         MOV     A,#0xf
   \   00009A   F0           MOVX    @DPTR,A
    460                dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
   \   00009B   85..82       MOV     DPL,?XSP + 0
   \   00009E   85..83       MOV     DPH,?XSP + 1
   \   0000A1   74FF         MOV     A,#-0x1
   \   0000A3   F0           MOVX    @DPTR,A
   \   0000A4   A3           INC     DPTR
   \   0000A5   F0           MOVX    @DPTR,A
    461                ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    462                                  p2p_test_PROFID,
    463                                  p2p_test_MAX_CLUSTERS, (cId_t *)p2p_test_ClusterList,
    464                                  p2p_test_MAX_CLUSTERS, (cId_t *)p2p_test_ClusterList,
    465                                  FALSE );
   \   0000A6                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0000A6   75..00       MOV     ?V0 + 0,#0x0
   \   0000A9   78..         MOV     R0,#?V0 + 0
   \   0000AB   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000AE   75....       MOV     ?V0 + 0,#(p2p_test_ClusterList & 0xff)
   \   0000B1   75....       MOV     ?V0 + 1,#((p2p_test_ClusterList >> 8) & 0xff)
   \   0000B4   78..         MOV     R0,#?V0 + 0
   \   0000B6   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000B9   75..01       MOV     ?V0 + 0,#0x1
   \   0000BC   78..         MOV     R0,#?V0 + 0
   \   0000BE   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000C1   75....       MOV     ?V0 + 0,#(p2p_test_ClusterList & 0xff)
   \   0000C4   78..         MOV     R0,#?V0 + 0
   \   0000C6   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000C9   75..04       MOV     ?V0 + 0,#0x4
   \   0000CC   75..0F       MOV     ?V0 + 1,#0xf
   \   0000CF   78..         MOV     R0,#?V0 + 0
   \   0000D1   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000D4   7901         MOV     R1,#0x1
   \   0000D6   7CFF         MOV     R4,#-0x1
   \   0000D8   7DFF         MOV     R5,#-0x1
   \   0000DA   7408         MOV     A,#0x8
   \   0000DC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000DF   AA82         MOV     R2,DPL
   \   0000E1   AB83         MOV     R3,DPH
   \   0000E3   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   0000E6   7408         MOV     A,#0x8
   \   0000E8   12....       LCALL   ?DEALLOC_XSTACK8
    466              }
    467            }
    468          }
   \                     ??p2p_test_HandleKeys_0:
   \   0000EB   7409         MOV     A,#0x9
   \   0000ED   80..         SJMP    ?Subroutine19
    469          
    470          /*********************************************************************
    471           * LOCAL FUNCTIONS
    472           */
    473          
    474          /*********************************************************************
    475           * @fn      p2p_test_MessageMSGCB
    476           *
    477           * @brief   Data message processor callback.  This function processes
    478           *          any incoming data - probably from other devices.  So, based
    479           *          on cluster ID, perform the intended action.
    480           *
    481           * @param   none
    482           *
    483           * @return  none
    484           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    485          void p2p_test_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     p2p_test_MessageMSGCB:
    486          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    487            switch ( pkt->clusterId )
   \   000005   8A82         MOV     DPL,R2
   \   000007   8B83         MOV     DPH,R3
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   000010   12....       LCALL   ?US_SWITCH_DENSE
   \                     `?<Jumptable for p2p_test_MessageMSGCB>_0`:
   \   000013   0100         DW        1
   \   000015   00           DB        0
   \   000016   ....         DW        ??p2p_test_MessageMSGCB_0
   \   000018   ....         DW        ??p2p_test_MessageMSGCB_1
    488            {
    489              case p2p_test_CLUSTERID:
    490                // "the" message
    491                HalUARTWrite( 0, (uint8*)pkt->cmd.Data, pkt->cmd.DataLength );
   \                     ??p2p_test_MessageMSGCB_1:
   \   00001A                ; Setup parameters for call to function HalUARTWrite
   \   00001A   EA           MOV     A,R2
   \   00001B   2413         ADD     A,#0x13
   \   00001D   F582         MOV     DPL,A
   \   00001F   EB           MOV     A,R3
   \   000020   3400         ADDC    A,#0x0
   \   000022   F583         MOV     DPH,A
   \   000024   E0           MOVX    A,@DPTR
   \   000025   FC           MOV     R4,A
   \   000026   A3           INC     DPTR
   \   000027   E0           MOVX    A,@DPTR
   \   000028   FD           MOV     R5,A
   \   000029   EA           MOV     A,R2
   \   00002A   2415         ADD     A,#0x15
   \   00002C   F582         MOV     DPL,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   F583         MOV     DPH,A
   \   000033   E0           MOVX    A,@DPTR
   \   000034   FA           MOV     R2,A
   \   000035   A3           INC     DPTR
   \   000036   E0           MOVX    A,@DPTR
   \   000037   FB           MOV     R3,A
   \   000038   7900         MOV     R1,#0x0
   \   00003A   12....       LCALL   ??HalUARTWrite?relay
    492          #if defined( LCD_SUPPORTED )
    493                HalLcdWriteScreen( (char*)pkt->cmd.Data, "rcvd" );
    494          #elif defined( WIN32 )
    495                WPRINTSTR( pkt->cmd.Data );
    496          #endif
    497                break;
    498            }
    499          }
   \                     ??p2p_test_MessageMSGCB_0:
   \   00003D   80..         SJMP    ??Subroutine19_0
    500          /*********************************************************************
    501           * @fn      haltemp
    502           *
    503           * @brief   wait some time
    504          
    505           *
    506           * @param   none
    507           *
    508           * @return  none
    509           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    510          void halWait(byte wait){
   \                     halWait:
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
    511              uint32 largeWait;
    512          
    513             if(wait == 0)
   \   000005   E9           MOV     A,R1
   \   000006   605A         JZ      ??halWait_0
    514             {return;}
    515             largeWait = ((UINT16) (wait << 7));
    516             largeWait += 114*wait;
    517          
    518          
    519             largeWait = (largeWait >> CLKSPD_1);
   \   000008   8982         MOV     DPL,R1
   \   00000A   AA82         MOV     R2,DPL
   \   00000C   8A..         MOV     ?V0 + 0,R2
   \   00000E   75..00       MOV     ?V0 + 1,#0x0
   \   000011   7407         MOV     A,#0x7
   \   000013   78..         MOV     R0,#?V0 + 0
   \   000015   12....       LCALL   ?S_SHL
   \   000018   F5..         MOV     ?V0 + 2,A
   \   00001A   F5..         MOV     ?V0 + 3,A
   \   00001C   EA           MOV     A,R2
   \   00001D   75F072       MOV     B,#0x72
   \   000020   A4           MUL     AB
   \   000021   FA           MOV     R2,A
   \   000022   ACF0         MOV     R4,B
   \   000024   E4           CLR     A
   \   000025   2C           ADD     A,R4
   \   000026   8A..         MOV     ?V0 + 4,R2
   \   000028   F5..         MOV     ?V0 + 5,A
   \   00002A   33           RLC     A
   \   00002B   95E0         SUBB    A,0xE0 /* A   */
   \   00002D   F5..         MOV     ?V0 + 6,A
   \   00002F   F5..         MOV     ?V0 + 7,A
   \   000031   78..         MOV     R0,#?V0 + 0
   \   000033   79..         MOV     R1,#?V0 + 4
   \   000035   12....       LCALL   ?L_ADD
   \   000038   E5C6         MOV     A,0xc6
   \   00003A   A2E0         MOV     C,0xE0 /* A   */.0
   \   00003C   E4           CLR     A
   \   00003D   92E0         MOV     0xE0 /* A   */.0,C
   \   00003F   78..         MOV     R0,#?V0 + 0
   \   000041   12....       LCALL   ?UL_SHR
    520             while(largeWait--);
   \                     ??halWait_1:
   \   000044   85....       MOV     ?V0 + 4,?V0 + 0
   \   000047   85....       MOV     ?V0 + 5,?V0 + 1
   \   00004A   85....       MOV     ?V0 + 6,?V0 + 2
   \   00004D   85....       MOV     ?V0 + 7,?V0 + 3
   \   000050   90....       MOV     DPTR,#__Constant_ffffffff
   \   000053   78..         MOV     R0,#?V0 + 0
   \   000055   12....       LCALL   ?L_ADD_X
   \   000058   90....       MOV     DPTR,#__Constant_0
   \   00005B   78..         MOV     R0,#?V0 + 4
   \   00005D   12....       LCALL   ?L_EQ_X
   \   000060   70E2         JNZ     ??halWait_1
   \                     ??halWait_0:
   \   000062   7F08         MOV     R7,#0x8
   \   000064   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000067                REQUIRE CLKCON
    521          
    522             return;
    523          }
    524          /*********************************************************************
    525           * @fn      haltemp
    526           *
    527           * @brief   wait some time
    528          
    529           *
    530           * @param   none
    531           *
    532           * @return  none
    533           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    534          byte halhumi(void)
   \                     halhumi:
    535          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    536            byte i,j,k;
    537            byte HI,LO,READ,HUMI;
    538            byte status;
    539          
    540              k = IEN0;
   \   000005   12....       LCALL   ?Subroutine0 & 0xFFFF
    541              IEN0 = 0;
    542              HI = 0;
    543              LO = 0;
    544             status = 1;
    545             P1SEL &= ~0X03;
    546             P1DIR |= 0X03;
    547             DATA = 0;
    548             SCK = 0;
    549             //³õÊ¼»¯
    550             halWait(20);
    551             for(i=0;i<11;i++){
   \                     ??CrossCallReturnLabel_0:
   \   000008   7E0B         MOV     R6,#0xb
    552               DATA = 1;
   \                     ??halhumi_0:
   \   00000A   D291         SETB    0x90.1
    553               SCK = 1;
   \   00000C   D290         SETB    0x90.0
    554               halWait(6);
   \   00000E                ; Setup parameters for call to function halWait
   \   00000E   7906         MOV     R1,#0x6
   \   000010   12....       LCALL   ??Subroutine2_1 & 0xFFFF
    555               SCK = 0;
    556               halWait(2);
    557             }
   \                     ??CrossCallReturnLabel_8:
   \   000013   70F5         JNZ     ??halhumi_0
    558             //×¼±¸´«ËÍ
    559             SCK = 1;
   \   000015   12....       LCALL   ?Subroutine4 & 0xFFFF
    560             halWait(3);
    561             DATA = 0;
    562             halWait(3);
    563             SCK = 0;
    564             halWait(2);
    565             SCK = 1;
    566             halWait(3);
    567             DATA = 1;
    568             halWait(3);
    569             //·¢ËÍ²É¼¯Êª¶ÈÃüÁî
    570             for(i=0;i<5;i++){
   \                     ??CrossCallReturnLabel_13:
   \   000018   7E05         MOV     R6,#0x5
    571               SCK = 0;
   \                     ??halhumi_1:
   \   00001A   12....       LCALL   ?Subroutine8 & 0xFFFF
    572               halWait(1);
    573               DATA = 0;
    574               halWait(1);
    575               SCK = 1;
    576               halWait(6);
    577             }
   \                     ??CrossCallReturnLabel_22:
   \   00001D   70FB         JNZ     ??halhumi_1
    578               SCK = 0;
   \   00001F   12....       LCALL   ?Subroutine5 & 0xFFFF
    579               halWait(1);
    580               DATA = 1;
    581               halWait(1);
    582               SCK = 1;
    583               halWait(6);
    584               SCK = 0;
   \                     ??CrossCallReturnLabel_15:
   \   000022   12....       LCALL   ?Subroutine13 & 0xFFFF
    585               halWait(1);
    586               DATA = 0;
    587               halWait(1);
    588               SCK = 1;
    589               halWait(6);
    590               SCK = 0;
   \                     ??CrossCallReturnLabel_32:
   \   000025   12....       LCALL   ?Subroutine5 & 0xFFFF
    591               halWait(1);
    592               DATA = 1;
    593               halWait(1);
    594               SCK = 1;
    595               halWait(6);
    596          
    597             //½«DATA¸ÄÎªÊäÈë
    598             P1DIR &= ~0X02;
   \                     ??CrossCallReturnLabel_16:
   \   000028   12....       LCALL   ?Subroutine11 & 0xFFFF
    599             SCK = 0;
    600             halWait(2);
    601             do{
    602             SCK = 1;
   \                     ??CrossCallReturnLabel_46:
   \   00002B   D290         SETB    0x90.0
    603             halWait(4);
   \   00002D                ; Setup parameters for call to function halWait
   \   00002D   7904         MOV     R1,#0x4
   \   00002F   12....       LCALL   ??halWait?relay
    604             }
    605             while(DATA!=0);
   \   000032   A291         MOV     C,0x90.1
   \   000034   40F5         JC      ??CrossCallReturnLabel_46
    606             if(DATA == 0)//±íÊ¾ÊÕµ½ACK
   \   000036   A291         MOV     C,0x90.1
   \   000038   4046         JC      ??halhumi_2
    607             {
    608               SCK = 0;
   \   00003A   12....       LCALL   ?Subroutine6 & 0xFFFF
    609               halWait(2);
    610               SCK = 1;
    611               halWait(6);
    612               SCK = 0;
    613               halWait(2);
    614               SCK = 1;
    615               halWait(6);
    616               SCK = 0;
    617               halWait(88);//µÈ´ýÊý¾Ý²É¼¯£¬×î´ó¾«¶ÈÒªÇóµÄÊ±¼ä
   \                     ??CrossCallReturnLabel_18:
   \   00003D                ; Setup parameters for call to function halWait
   \   00003D   7958         MOV     R1,#0x58
   \   00003F   12....       LCALL   ??halWait?relay
    618               //µÈ´ý´«¸ÐÆ÷Ìá¹©µÄACK
    619               for(i=0;i<4;i++){
   \   000042   7E00         MOV     R6,#0x0
    620                 SCK = 1;
   \                     ??halhumi_3:
   \   000044   12....       LCALL   ?Subroutine9 & 0xFFFF
    621                 halWait(3);
    622                 j = DATA;
    623                 halWait(3);
    624                 if(j != 0)
   \                     ??CrossCallReturnLabel_24:
   \   000047   7037         JNZ     ??halhumi_2
    625                 {status=0;
    626                 break;}
    627                 else{
    628                   SCK = 0;
   \   000049   C290         CLR     0x90.0
    629                   halWait(2);
   \   00004B                ; Setup parameters for call to function halWait
   \   00004B   7902         MOV     R1,#0x2
   \   00004D   12....       LCALL   ??halWait?relay
    630                 }
    631               }
   \   000050   0E           INC     R6
   \   000051   EE           MOV     A,R6
   \   000052   C3           CLR     C
   \   000053   9404         SUBB    A,#0x4
   \   000055   40ED         JC      ??halhumi_3
    632               if(status != 0)
    633               {//½ÓÊÜÇ°4¸öÊý¾Ý
    634                  SCK = 1;
   \   000057   12....       LCALL   ?Subroutine7 & 0xFFFF
    635                  halWait(1);
    636                  READ = DATA;
    637                  HI = HI|READ;
    638                  halWait(1);
    639                  SCK = 0;
    640                  halWait(2);
    641                 for(i=0;i<3;i++){
   \                     ??CrossCallReturnLabel_20:
   \   00005A   7E03         MOV     R6,#0x3
    642                    SCK = 1;
   \                     ??halhumi_4:
   \   00005C   12....       LCALL   ?Subroutine2 & 0xFFFF
    643                    halWait(1);
    644                    READ = DATA;
    645                    HI = HI<<1;
    646                    HI = HI|READ;
    647                    halWait(1);
    648                    SCK = 0;
    649                    halWait(2);
    650                 }
   \                     ??CrossCallReturnLabel_4:
   \   00005F   70FB         JNZ     ??halhumi_4
    651                 //·¢ËÍACK¸ø´«¸ÐÆ÷
    652                 P1DIR |= 0X02;
   \   000061   12....       LCALL   ?Subroutine3 & 0xFFFF
    653                 DATA = 0;
    654                 SCK = 1;
    655                 halWait(2);
    656                 SCK = 0;
    657                 halWait(2);
    658                 P1DIR &= ~0X02;
    659                 //¼ÌÐø½ÓÊÜºó°ËÎ»µÄÊý¾Ý
    660                 SCK = 1;
    661                 halWait(1);
    662                 READ = DATA;
    663                 LO = LO|READ;
    664                 halWait(1);
    665                 SCK = 0;
    666                 halWait(2);
    667                 for(i=0;i<7;i++){
    668                    SCK = 1;
   \                     ??CrossCallReturnLabel_11:
   \   000064   12....       LCALL   ?Subroutine10 & 0xFFFF
    669                    halWait(1);
    670                    READ = DATA;
    671                    LO = LO<<1;
    672                    LO = LO|READ;
    673                    halWait(1);
   \                     ??CrossCallReturnLabel_26:
   \   000067                ; Setup parameters for call to function halWait
   \   000067   12....       LCALL   ??Subroutine2_0 & 0xFFFF
    674                    SCK = 0;
    675                    halWait(2);
    676                 }
   \                     ??CrossCallReturnLabel_6:
   \   00006A   70F8         JNZ     ??CrossCallReturnLabel_11
    677                HUMI = HI<<4|LO>>4;
   \   00006C   E5..         MOV     A,?V0 + 1
   \   00006E   C4           SWAP    A
   \   00006F   540F         ANL     A,#0xf
   \   000071   C0E0         PUSH    A
   \   000073   E5..         MOV     A,?V0 + 0
   \   000075   C4           SWAP    A
   \   000076   54F0         ANL     A,#0xf0
   \   000078   FA           MOV     R2,A
   \   000079   D0E0         POP     A
   \   00007B   4A           ORL     A,R2
   \   00007C   F5..         MOV     ?V0 + 0,A
    678                IEN0 = k;
   \   00007E   8FA8         MOV     0xa8,R7
    679               }
    680             }
    681             P1SEL = 0x01;
   \                     ??halhumi_2:
   \   000080   75F401       MOV     0xf4,#0x1
    682             return HUMI;
   \   000083                REQUIRE ?Subroutine21
   \   000083                REQUIRE _A_P1
   \   000083                REQUIRE _A_IEN0
   \   000083                REQUIRE P1SEL
   \   000083                REQUIRE P1DIR
   \   000083                ; // Fall through to label ?Subroutine21
    683          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   A9..         MOV     R1,?V0 + 0
   \   000002   02....       LJMP    ??Subroutine19_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   53FEFD       ANL     0xfe,#0xfd
   \   000003                REQUIRE ?Subroutine20
   \   000003                ; // Fall through to label ?Subroutine20

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   C290         CLR     0x90.0
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002   7902         MOV     R1,#0x2
   \   000004   12....       LCALL   ??halWait?relay
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   000003   E5..         MOV     A,?V0 + 1
   \   000005   C3           CLR     C
   \   000006   33           RLC     A
   \   000007   4A           ORL     A,R2
   \   000008   F5..         MOV     ?V0 + 1,A
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   D290         SETB    0x90.0
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002   7903         MOV     R1,#0x3
   \   000004   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_42:
   \   000007   F5..         MOV     ?V0 + 1,A
   \   000009                ; Setup parameters for call to function halWait
   \   000009                ; Setup parameters for call to function halWait
   \   000009   7903         MOV     R1,#0x3
   \   00000B   12....       LCALL   ??halWait?relay
   \   00000E   E5..         MOV     A,?V0 + 1
   \   000010   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_33:
   \   000003   1E           DEC     R6
   \   000004   EE           MOV     A,R6
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   C290         CLR     0x90.0
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002   7901         MOV     R1,#0x1
   \   000004   12....       LCALL   ??halWait?relay
   \   000007   C291         CLR     0x90.1
   \   000009                ; Setup parameters for call to function halWait
   \   000009                ; Setup parameters for call to function halWait
   \   000009                ; Setup parameters for call to function halWait
   \   000009   12....       LCALL   ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_40:
   \   00000C   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   000003   8A..         MOV     ?V0 + 0,R2
   \   000005                ; Setup parameters for call to function halWait
   \   000005                ; Setup parameters for call to function halWait
   \   000005   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_36:
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   7901         MOV     R1,#0x1
   \                     ??Subroutine15_0:
   \   000002   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_44:
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   12....       LCALL   ??halWait?relay
   \   000003   80..         SJMP    ?Subroutine20

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   C290         CLR     0x90.0
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002   7902         MOV     R1,#0x2
   \   000004   12....       LCALL   ??halWait?relay
   \   000007   D290         SETB    0x90.0
   \   000009                ; Setup parameters for call to function halWait
   \   000009                ; Setup parameters for call to function halWait
   \   000009   7906         MOV     R1,#0x6
   \   00000B   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_34:
   \   00000E                ; Setup parameters for call to function halWait
   \   00000E                ; Setup parameters for call to function halWait
   \   00000E   7906         MOV     R1,#0x6
   \   000010   12....       LCALL   ??halWait?relay
   \   000013   C290         CLR     0x90.0
   \   000015   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   C290         CLR     0x90.0
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002   7901         MOV     R1,#0x1
   \   000004   12....       LCALL   ??halWait?relay
   \   000007   D291         SETB    0x90.1
   \   000009                ; Setup parameters for call to function halWait
   \   000009                ; Setup parameters for call to function halWait
   \   000009                ; Setup parameters for call to function halWait
   \   000009   12....       LCALL   ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_41:
   \   00000C   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   7901         MOV     R1,#0x1
   \   000002   12....       LCALL   ??halWait?relay
   \   000005   D290         SETB    0x90.0
   \   000007                ; Setup parameters for call to function halWait
   \   000007                ; Setup parameters for call to function halWait
   \   000007                ; Setup parameters for call to function halWait
   \   000007                ; Setup parameters for call to function halWait
   \   000007                ; Setup parameters for call to function halWait
   \   000007                ; Setup parameters for call to function halWait
   \   000007   7906         MOV     R1,#0x6
   \   000009   12....       LCALL   ??halWait?relay
   \   00000C   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   D290         SETB    0x90.0
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002   7903         MOV     R1,#0x3
   \   000004   12....       LCALL   ??halWait?relay
   \   000007   C291         CLR     0x90.1
   \   000009                ; Setup parameters for call to function halWait
   \   000009                ; Setup parameters for call to function halWait
   \   000009   7903         MOV     R1,#0x3
   \   00000B   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_35:
   \   00000E                ; Setup parameters for call to function halWait
   \   00000E                ; Setup parameters for call to function halWait
   \   00000E   7903         MOV     R1,#0x3
   \   000010   12....       LCALL   ??halWait?relay
   \   000013   D291         SETB    0x90.1
   \   000015                ; Setup parameters for call to function halWait
   \   000015                ; Setup parameters for call to function halWait
   \   000015   7903         MOV     R1,#0x3
   \   000017   12....       LCALL   ??halWait?relay
   \   00001A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_45:
   \   000003   D290         SETB    0x90.0
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   43FE02       ORL     0xfe,#0x2
   \   000003   C291         CLR     0x90.1
   \   000005   D290         SETB    0x90.0
   \   000007                ; Setup parameters for call to function halWait
   \   000007                ; Setup parameters for call to function halWait
   \   000007   7902         MOV     R1,#0x2
   \   000009   12....       LCALL   ??Subroutine15_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_38:
   \   00000C   53FEFD       ANL     0xfe,#0xfd
   \   00000F   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   000012   8A..         MOV     ?V0 + 1,R2
   \   000014                ; Setup parameters for call to function halWait
   \   000014                ; Setup parameters for call to function halWait
   \   000014   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_37:
   \   000017   7E07         MOV     R6,#0x7
   \   000019   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   D290         SETB    0x90.0
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002                ; Setup parameters for call to function halWait
   \   000002   7901         MOV     R1,#0x1
   \   000004   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_43:
   \   000007   FA           MOV     R2,A
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   12....       LCALL   ??halWait?relay
   \   000003   A291         MOV     C,0x90.1
   \   000005   E4           CLR     A
   \   000006   92E0         MOV     0xE0 /* A   */.0,C
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   000003   E5..         MOV     A,?V0 + 0
   \   000005   C3           CLR     C
   \   000006   33           RLC     A
   \   000007   4A           ORL     A,R2
   \   000008   F5..         MOV     ?V0 + 0,A
   \   00000A                ; Setup parameters for call to function halWait
   \   00000A                ; Setup parameters for call to function halWait
   \                     ??Subroutine2_0:
   \   00000A   7901         MOV     R1,#0x1
   \                     ??Subroutine2_1:
   \   00000C   12....       LCALL   ??Subroutine15_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_39:
   \   00000F   1E           DEC     R6
   \   000010   EE           MOV     A,R6
   \   000011   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   E5A8         MOV     A,0xa8
   \   000002   FF           MOV     R7,A
   \   000003   75A800       MOV     0xa8,#0x0
   \   000006   53F4FC       ANL     0xf4,#0xfc
   \   000009   E5F4         MOV     A,0xf4
   \   00000B   43FE03       ORL     0xfe,#0x3
   \   00000E   E5FE         MOV     A,0xfe
   \   000010   C291         CLR     0x90.1
   \   000012   C290         CLR     0x90.0
   \   000014                ; Setup parameters for call to function halWait
   \   000014                ; Setup parameters for call to function halWait
   \   000014   7914         MOV     R1,#0x14
   \   000016   12....       LCALL   ??halWait?relay
   \   000019   22           RET
    684          
    685          
    686          /*********************************************************************
    687           * @fn      haltemp
    688           *
    689           * @brief   collect the temperature
    690          
    691           *
    692           * @param   none
    693           *
    694           * @return  the temperature
    695           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    696          byte haltemp(void)
   \                     haltemp:
    697          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    698          byte i,j,k;
    699            byte HI,LO,READ,TEMP;
    700            byte status;
    701          
    702              k = IEN0;
   \   000005   12....       LCALL   ?Subroutine0 & 0xFFFF
    703              IEN0 = 0;
    704              HI = 0;
    705              LO = 0;
    706             status = 1;
    707             P1SEL &= ~0X03;
    708             P1DIR |= 0X03;
    709             DATA = 0;
    710             SCK = 0;
    711             //³õÊ¼»¯
    712             halWait(20);
    713             for(i=0;i<9;i++){
   \                     ??CrossCallReturnLabel_1:
   \   000008   7E09         MOV     R6,#0x9
    714               SCK = 1;
   \                     ??haltemp_0:
   \   00000A   D290         SETB    0x90.0
    715               halWait(6);
   \   00000C                ; Setup parameters for call to function halWait
   \   00000C   7906         MOV     R1,#0x6
   \   00000E   12....       LCALL   ??Subroutine2_1 & 0xFFFF
    716               SCK = 0;
    717               halWait(2);
    718             }
   \                     ??CrossCallReturnLabel_9:
   \   000011   70F7         JNZ     ??haltemp_0
    719             for(i=0;i<11;i++){
   \   000013   7E0B         MOV     R6,#0xb
    720               DATA = 1;
   \                     ??haltemp_1:
   \   000015   D291         SETB    0x90.1
    721               SCK = 1;
   \   000017   D290         SETB    0x90.0
    722               halWait(6);
   \   000019                ; Setup parameters for call to function halWait
   \   000019   7906         MOV     R1,#0x6
   \   00001B   12....       LCALL   ??Subroutine2_1 & 0xFFFF
    723               SCK = 0;
    724               halWait(2);
    725             }
   \                     ??CrossCallReturnLabel_10:
   \   00001E   70F5         JNZ     ??haltemp_1
    726             //×¼±¸´«ËÍ
    727             SCK = 1;
   \   000020   12....       LCALL   ?Subroutine4 & 0xFFFF
    728             halWait(3);
    729             DATA = 0;
    730             halWait(3);
    731             SCK = 0;
    732             halWait(2);
    733             SCK = 1;
    734             halWait(3);
    735             DATA = 1;
    736             halWait(3);
    737             //·¢ËÍ²É¼¯ÎÂ¶ÈÃüÁî
    738             for(i=0;i<6;i++){
   \                     ??CrossCallReturnLabel_14:
   \   000023   7E06         MOV     R6,#0x6
    739               SCK = 0;
   \                     ??haltemp_2:
   \   000025   12....       LCALL   ?Subroutine8 & 0xFFFF
    740               halWait(1);
    741               DATA = 0;
    742               halWait(1);
    743               SCK = 1;
    744               halWait(6);
    745             }
   \                     ??CrossCallReturnLabel_23:
   \   000028   70FB         JNZ     ??haltemp_2
    746             for(i=0;i<2;i++){
   \   00002A   7E02         MOV     R6,#0x2
    747               SCK = 0;
   \                     ??haltemp_3:
   \   00002C   12....       LCALL   ?Subroutine5 & 0xFFFF
    748               halWait(1);
    749               DATA = 1;
    750               halWait(1);
    751               SCK = 1;
    752               halWait(6);
    753             }
   \                     ??CrossCallReturnLabel_17:
   \   00002F   1E           DEC     R6
   \   000030   EE           MOV     A,R6
   \   000031   70F9         JNZ     ??haltemp_3
    754             //½«DATA¸ÄÎªÊäÈë
    755             P1DIR &= ~0X02;
   \   000033   12....       LCALL   ?Subroutine11 & 0xFFFF
    756             SCK = 0;
    757             halWait(2);
    758             do{
    759             SCK = 1;
   \                     ??CrossCallReturnLabel_47:
   \   000036   D290         SETB    0x90.0
    760             halWait(4);
   \   000038                ; Setup parameters for call to function halWait
   \   000038   7904         MOV     R1,#0x4
   \   00003A   12....       LCALL   ??halWait?relay
    761             }
    762             while(DATA!=0);
   \   00003D   A291         MOV     C,0x90.1
   \   00003F   40F5         JC      ??CrossCallReturnLabel_47
    763             if(DATA == 0)//±íÊ¾ÊÕµ½ACK
   \   000041   A291         MOV     C,0x90.1
   \   000043   4049         JC      ??haltemp_4
    764             {
    765               SCK = 0;
   \   000045   12....       LCALL   ?Subroutine6 & 0xFFFF
    766               halWait(2);
    767               SCK = 1;
    768               halWait(6);
    769               SCK = 0;
    770               halWait(2);
    771               SCK = 1;
    772               halWait(6);
    773               SCK = 0;
    774               halWait(250);//µÈ´ýÊý¾Ý²É¼¯£¬×î´ó¾«¶ÈÒªÇóµÄÊ±¼ä
   \                     ??CrossCallReturnLabel_19:
   \   000048                ; Setup parameters for call to function halWait
   \   000048   79FA         MOV     R1,#-0x6
   \   00004A   12....       LCALL   ??halWait?relay
    775               //µÈ´ý´«¸ÐÆ÷Ìá¹©µÄACK
    776               for(i=0;i<2;i++){
   \   00004D   7E00         MOV     R6,#0x0
    777                 SCK = 1;
   \                     ??haltemp_5:
   \   00004F   12....       LCALL   ?Subroutine9 & 0xFFFF
    778                 halWait(3);
    779                 j = DATA;
    780                 halWait(3);
    781                 if(j != 0)
   \                     ??CrossCallReturnLabel_25:
   \   000052   703A         JNZ     ??haltemp_4
    782                 {status=0;
    783                 break;}
    784                 else{
    785                   SCK = 0;
   \   000054   C290         CLR     0x90.0
    786                   halWait(2);
   \   000056                ; Setup parameters for call to function halWait
   \   000056   7902         MOV     R1,#0x2
   \   000058   12....       LCALL   ??halWait?relay
    787                 }
    788               }
   \   00005B   0E           INC     R6
   \   00005C   EE           MOV     A,R6
   \   00005D   C3           CLR     C
   \   00005E   9402         SUBB    A,#0x2
   \   000060   40ED         JC      ??haltemp_5
    789               if(status != 0)
    790               {//½ÓÊÜÇ°6¸öÊý¾Ý
    791                  SCK = 1;
   \   000062   12....       LCALL   ?Subroutine7 & 0xFFFF
    792                  halWait(1);
    793                  READ = DATA;
    794                  HI = HI|READ;
    795                  halWait(1);
    796                  SCK = 0;
    797                  halWait(2);
    798                 for(i=0;i<5;i++){
   \                     ??CrossCallReturnLabel_21:
   \   000065   7E05         MOV     R6,#0x5
    799                    SCK = 1;
   \                     ??haltemp_6:
   \   000067   12....       LCALL   ?Subroutine2 & 0xFFFF
    800                    halWait(1);
    801                    READ = DATA;
    802                    HI = HI<<1;
    803                    HI = HI|READ;
    804                    halWait(1);
    805                    SCK = 0;
    806                    halWait(2);
    807                 }
   \                     ??CrossCallReturnLabel_5:
   \   00006A   70FB         JNZ     ??haltemp_6
    808                 //·¢ËÍACK¸ø´«¸ÐÆ÷
    809                 P1DIR |= 0X02;
   \   00006C   12....       LCALL   ?Subroutine3 & 0xFFFF
    810                 DATA = 0;
    811                 SCK = 1;
    812                 halWait(2);
    813                 SCK = 0;
    814                 halWait(2);
    815                 P1DIR &= ~0X02;
    816                 //¼ÌÐø½ÓÊÜºó°ËÎ»µÄÊý¾Ý
    817                 SCK = 1;
    818                 halWait(1);
    819                 READ = DATA;
    820                 LO = LO|READ;
    821                 halWait(1);
    822                 SCK = 0;
    823                 halWait(2);
    824                 for(i=0;i<7;i++){
    825                    SCK = 1;
   \                     ??CrossCallReturnLabel_12:
   \   00006F   12....       LCALL   ?Subroutine10 & 0xFFFF
    826                    halWait(1);
    827                    READ = DATA;
    828                    LO = LO<<1;
    829                    LO = LO|READ;
    830                    halWait(1);
   \                     ??CrossCallReturnLabel_27:
   \   000072                ; Setup parameters for call to function halWait
   \   000072   12....       LCALL   ??Subroutine2_0 & 0xFFFF
    831                    SCK = 0;
    832                    halWait(2);
    833                 }
   \                     ??CrossCallReturnLabel_7:
   \   000075   70F8         JNZ     ??CrossCallReturnLabel_12
    834                 TEMP = HI<<2|LO>>6;
   \   000077   E5..         MOV     A,?V0 + 1
   \   000079   C4           SWAP    A
   \   00007A   13           RRC     A
   \   00007B   13           RRC     A
   \   00007C   5403         ANL     A,#0x3
   \   00007E   C0E0         PUSH    A
   \   000080   E5..         MOV     A,?V0 + 0
   \   000082   33           RLC     A
   \   000083   33           RLC     A
   \   000084   54FC         ANL     A,#0xfc
   \   000086   FA           MOV     R2,A
   \   000087   D0E0         POP     A
   \   000089   4A           ORL     A,R2
   \   00008A   F5..         MOV     ?V0 + 0,A
    835                 IEN0 = k;
   \   00008C   8FA8         MOV     0xa8,R7
    836               }
    837             }
    838             return TEMP;
   \                     ??haltemp_4:
   \   00008E   02....       LJMP    ?Subroutine21 & 0xFFFF
   \   000091                REQUIRE _A_P1
   \   000091                REQUIRE _A_IEN0
   \   000091                REQUIRE P1SEL
   \   000091                REQUIRE P1DIR
    839          }
    840          /*********************************************************************
    841           * @fn      p2p_test_SendTheMessage
    842           *
    843           * @brief   Send "the" message.
    844           *
    845           * @param   none
    846           *
    847           * @return  none
    848           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    849          void p2p_test_SendTheMessage( void )
   \                     p2p_test_SendTheMessage:
    850          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 13
   \   000005   74F3         MOV     A,#-0xd
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    851           char p2p_msg[] = "Hello World ";
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AC82         MOV     R4,DPL
   \   000012   AD83         MOV     R5,DPH
   \   000014   7583..       MOV     DPH,#((`?<Constant "Hello World ">` >> 8) & 0xff)
   \   000017   7582..       MOV     DPL,#(`?<Constant "Hello World ">` & 0xff)
   \   00001A   740D         MOV     A,#0xd
   \   00001C   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
    852            if ( AF_DataRequest( &p2p_test_DstAddr, &p2p_test_epDesc,
    853                                 p2p_test_CLUSTERID,
    854                                 (byte)osal_strlen( p2p_msg ) + 1,
    855                                 (byte *)&p2p_msg,
    856                                 &p2p_test_TransID,
    857                                 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   00001F                ; Setup parameters for call to function AF_DataRequest
   \   00001F   75..0A       MOV     ?V0 + 0,#0xa
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000027   75....       MOV     ?V0 + 0,#(p2p_test_TransID & 0xff)
   \   00002A   75....       MOV     ?V0 + 1,#((p2p_test_TransID >> 8) & 0xff)
   \   00002D   78..         MOV     R0,#?V0 + 0
   \   00002F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000032   7403         MOV     A,#0x3
   \   000034   12....       LCALL   ?XSTACK_DISP0_8
   \   000037   8582..       MOV     ?V0 + 0,DPL
   \   00003A   8583..       MOV     ?V0 + 1,DPH
   \   00003D   78..         MOV     R0,#?V0 + 0
   \   00003F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000042                ; Setup parameters for call to function osal_strlen
   \   000042   7405         MOV     A,#0x5
   \   000044   12....       LCALL   ?XSTACK_DISP0_8
   \   000047   AA82         MOV     R2,DPL
   \   000049   AB83         MOV     R3,DPH
   \   00004B   12....       LCALL   ??osal_strlen?relay
   \   00004E   EA           MOV     A,R2
   \   00004F   F8           MOV     R0,A
   \   000050   7401         MOV     A,#0x1
   \   000052   28           ADD     A,R0
   \   000053   F5..         MOV     ?V0 + 0,A
   \   000055   E4           CLR     A
   \   000056   3400         ADDC    A,#0x0
   \   000058   F5..         MOV     ?V0 + 1,A
   \   00005A   78..         MOV     R0,#?V0 + 0
   \   00005C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005F   75..01       MOV     ?V0 + 0,#0x1
   \   000062   75..00       MOV     ?V0 + 1,#0x0
   \   000065   78..         MOV     R0,#?V0 + 0
   \   000067   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00006A   7900         MOV     R1,#0x0
   \   00006C   7C..         MOV     R4,#(p2p_test_epDesc & 0xff)
   \   00006E   7D..         MOV     R5,#((p2p_test_epDesc >> 8) & 0xff)
   \   000070   7A..         MOV     R2,#(p2p_test_DstAddr & 0xff)
   \   000072   7B..         MOV     R3,#((p2p_test_DstAddr >> 8) & 0xff)
   \   000074   12....       LCALL   ??AF_DataRequest?relay
   \   000077   7409         MOV     A,#0x9
   \   000079   12....       LCALL   ?DEALLOC_XSTACK8
    858            {
    859              // Successfully requested to be sent.
    860            }
    861            else
    862            {
    863              // Error occurred in request to send.
    864            }
    865          }
   \   00007C   740D         MOV     A,#0xd
   \   00007E   02....       LJMP    ?Subroutine19 & 0xFFFF

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "Hello World ">>`:
   \   000000   48656C6C     DB "Hello World "
   \            6F20576F
   \            726C6420
   \            00      

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for p2p_test_ClusterList>`:
   \   000000   0100         DW 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for p2p_test_SimpleDesc>`:
   \   000000   0A           DB 10
   \   000001   040F0100     DW 3844, 1
   \   000005   0001         DB 0, 1
   \   000007   ....         DW p2p_test_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW p2p_test_ClusterList

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for __Constant_ffffffff>`:
   \   000000   FFFFFFFF     DD 4294967295

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for __Constant_0>`:
   \   000000   00000000     DD 0

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_ProcessZDOMsgs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_ProcessZDOMsgs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??halWait?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    halWait

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??halhumi?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    halhumi

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??haltemp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    haltemp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??p2p_test_SendTheMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    p2p_test_SendTheMessage

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "Hello World ">`:
   \   000000                DS 13
   \   00000D                REQUIRE `?<Initializer for <Constant "Hello World ">>`
   \   00000D                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     __Constant_ffffffff:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for __Constant_ffffffff>`
   \   000004                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     __Constant_0:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for __Constant_0>`
   \   000004                REQUIRE __INIT_XDATA_I
    866          
    867          /*********************************************************************
    868          *********************************************************************/

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     halWait                          0      0     26
     halhumi                          1      0     10
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
     haltemp                          1      0     10
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
       -> halWait                     0      0     20
     p2p_test_HandleKeys              1      0     40
       -> HalLedSet                   0      0     38
       -> NLME_GetShortAddr           0      0     38
       -> ZDP_EndDeviceBindReq        0      0     56
       -> HalLedSet                   0      0     38
       -> ZDP_MatchDescReq            0      0     54
     p2p_test_Init                    2      0      0
       -> afRegister                  4      0      0
       -> RegisterForKeys             4      0      0
       -> ZDO_RegisterForZDOMsg       4      0      0
       -> ZDO_RegisterForZDOMsg       4      0      0
     p2p_test_MessageMSGCB            0      0     22
       -> HalUARTWrite                0      0     20
     p2p_test_ProcessEvent            0      0     12
       -> osal_msg_receive            0      0     24
       -> osal_msg_deallocate         0      0     24
       -> osal_msg_receive            0      0     24
       -> p2p_test_ProcessZDOMsgs     0      0     24
       -> p2p_test_HandleKeys         0      0     24
       -> p2p_test_MessageMSGCB       0      0     24
       -> HalLedSet                   0      0     24
       -> Onboard_wait                0      0     24
       -> Onboard_wait                0      0     24
       -> HalLedSet                   0      0     24
       -> p2p_test_SendTheMessage     0      0     24
       -> osal_start_timerEx          0      0     24
     p2p_test_ProcessZDOMsgs          0      0     22
       -> HalLedSet                   0      0     20
       -> HalLedSet                   0      0     20
       -> ZDO_ParseEPListRsp          0      0     20
       -> HalLedSet                   0      0     20
       -> osal_mem_free               0      0     20
     p2p_test_SendTheMessage          2      0     44
       -> osal_strlen                 0      0     56
       -> AF_DataRequest              0      0     64


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     _A_P1                             1
     _A_IEN0                           1
     CLKCON                            1
     P1SEL                             1
     P1DIR                             1
     p2p_test_ClusterList              2
     p2p_test_SimpleDesc              12
     p2p_test_epDesc                   6
     p2p_test_TaskID                   1
     p2p_test_NwkState                 1
     p2p_test_TransID                  1
     p2p_test_DstAddr                  4
     p2p_msg                           1
     p2p_test_Init                   117
     p2p_test_ProcessEvent           209
     p2p_test_ProcessZDOMsgs         153
     ?Subroutine19                     8
     ?Subroutine1                     10
     p2p_test_HandleKeys             239
     p2p_test_MessageMSGCB            63
     halWait                         103
     halhumi                         131
     ?Subroutine21                     5
     ?Subroutine11                     3
     ?Subroutine20                     8
     ?Subroutine10                    11
     ?Subroutine9                     17
     ?Subroutine8                      6
     ?Subroutine13                    13
     ?Subroutine7                      9
     ?Subroutine15                     6
     ?Subroutine17                     5
     ?Subroutine6                     22
     ?Subroutine5                     13
     ?Subroutine16                    13
     ?Subroutine4                     27
     ?Subroutine14                     6
     ?Subroutine3                     26
     ?Subroutine12                     9
     ?Subroutine18                     9
     ?Subroutine2                     18
     ?Subroutine0                     26
     haltemp                         145
     p2p_test_SendTheMessage         129
     ?<Initializer for <Constant "Hello World ">>
                                      13
     ?<Initializer for p2p_test_ClusterList>
                                       2
     ?<Initializer for p2p_test_SimpleDesc>
                                      12
     ?<Initializer for __Constant_ffffffff>
                                       4
     ?<Initializer for __Constant_0>
                                       4
     ??p2p_test_Init?relay             6
     ??p2p_test_ProcessEvent?relay     6
     ??p2p_test_ProcessZDOMsgs?relay
                                       6
     ??p2p_test_HandleKeys?relay       6
     ??p2p_test_MessageMSGCB?relay     6
     ??halWait?relay                   6
     ??halhumi?relay                   6
     ??haltemp?relay                   6
     ??p2p_test_SendTheMessage?relay
                                       6
     ?<Constant "Hello World ">       13
     __Constant_ffffffff               4
     __Constant_0                      4

 
 1 559 bytes in segment BANKED_CODE
    54 bytes in segment BANK_RELAYS
     5 bytes in segment SFR_AN
    35 bytes in segment XDATA_I
    35 bytes in segment XDATA_ID
    14 bytes in segment XDATA_Z
 
 1 640 bytes of CODE  memory (+ 8 bytes shared)
     0 bytes of DATA  memory (+ 5 bytes shared)
    41 bytes of XDATA memory (+ 8 bytes shared)

Errors: none
Warnings: none
