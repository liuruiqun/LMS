###############################################################################
#                                                                             #
# IAR 8051 C/C++ Compiler V7.30B/W32                    24/Jun/2011  23:53:22 #
# Copyright 2004-2007 IAR Systems. All rights reserved.                       #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data                                               #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components #
#                          \hal\target\CC2430EB\hal_lcd.c                     #
#    Command line       =  -f "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\SampleApp\CC2430DB\..\..\..\Tool #
#                          s\CC2430DB\f8wCoord.cfg" (-DCPU32MHZ               #
#                          -DFORCE_MAC_NEAR -DROOT=__near_func                #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS           #
#                          "-DCONST=const __code" -DGENERIC=__generic) -f     #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\SampleApp\CC2430DB\..\..\..\Tools\C #
#                          C2430DB\f8wConfig.cfg" (-DSECURE=0                 #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=10 -DAPSC_MAX_FRAME_RETRIES=3   #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=20           #
#                          -DNWK_MAX_BINDING_ENTRIES=10                       #
#                          -DMAX_BINDING_CLUSTER_IDS=5 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-1.4.3-1.2.1\Components\hal\targ #
#                          et\CC2430EB\hal_lcd.c" -D CC2430EB -D ZAPP_P1 -D   #
#                          MT_TASK -D LCD_SUPPORTED=DEBUG -lC "C:\Texas       #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\CoordinatorEB\List\" -lA   #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\SampleApp\CC2430DB\CoordinatorEB\Li #
#                          st\" --diag_suppress Pe001,Pa010 --diag_remark     #
#                          pe550 -o "C:\Texas Instruments\ZStack-1.4.3-1.2.1\ #
#                          Projects\zstack\Samples\SampleApp\CC2430DB\Coordin #
#                          atorEB\Obj\" -e --require_prototypes -z9           #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data --nr_virtual_regs 8 -I      #
#                          "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\ #
#                          zstack\Samples\SampleApp\CC2430DB\" -I "C:\Texas   #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\SOURCE\" -I "C:\Texas   #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\ZMAIN\TI2430DB\"  #
#                          -I "C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projec #
#                          ts\zstack\Samples\SampleApp\CC2430DB\..\..\..\..\. #
#                          .\COMPONENTS\MT\" -I "C:\Texas                     #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          HAL\INCLUDE\" -I "C:\Texas                         #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          HAL\TARGET\CC2430EB\" -I "C:\Texas                 #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          OSAL\MCU\CCSOC\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          OSAL\INCLUDE\" -I "C:\Texas                        #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          STACK\AF\" -I "C:\Texas Instruments\ZStack-1.4.3-1 #
#                          .2.1\Projects\zstack\Samples\SampleApp\CC2430DB\.. #
#                          \..\..\..\..\COMPONENTS\STACK\NWK\" -I "C:\Texas   #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          STACK\SEC\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          STACK\SYS\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          STACK\ZDO\" -I "C:\Texas                           #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          ZMAC\F8W\" -I "C:\Texas Instruments\ZStack-1.4.3-1 #
#                          .2.1\Projects\zstack\Samples\SampleApp\CC2430DB\.. #
#                          \..\..\..\..\COMPONENTS\ZMAC\" -I "C:\Texas        #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          SERVICES\SADDR\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          SERVICES\SDATA\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          MAC\INCLUDE\" -I "C:\Texas                         #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          MAC\HIGH_LEVEL\" -I "C:\Texas                      #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          MAC\LOW_LEVEL\SRF03\" -I "C:\Texas                 #
#                          Instruments\ZStack-1.4.3-1.2.1\Projects\zstack\Sam #
#                          ples\SampleApp\CC2430DB\..\..\..\..\..\COMPONENTS\ #
#                          MAC\LOW_LEVEL\SRF03\SINGLE_CHIP\" -I "C:\Program   #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\" -I "C:\Program       #
#                          Files\IAR Systems\Embedded Workbench 4.0           #
#                          Evaluation version\8051\INC\CLIB\"                 #
#    List file          =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\SampleApp\CC2430DB\CoordinatorEB\Lis #
#                          t\hal_lcd.lst                                      #
#    Object file        =  C:\Texas Instruments\ZStack-1.4.3-1.2.1\Projects\z #
#                          stack\Samples\SampleApp\CC2430DB\CoordinatorEB\Obj #
#                          \hal_lcd.r51                                       #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-1.4.3-1.2.1\Components\hal\target\CC2430EB\hal_lcd.c
      1          /**************************************************************************************************
      2            Filename:       hal_lcd.c
      3            Revised:        $Date: 2007-11-01 08:44:53 -0700 (Thu, 01 Nov 2007) $
      4            Revision:       $Revision: 15821 $
      5          
      6            Description:    This file contains the interface to the HAL LCD Service.
      7          
      8          
      9            Copyright 2006-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          /**************************************************************************************************
     41           *                                           INCLUDES
     42           **************************************************************************************************/
     43          #include "hal_types.h"
     44          #include "hal_lcd.h"

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xa0
   \   union <unnamed> volatile __sfr _A_P2
   \                     _A_P2:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf4
   \   unsigned char volatile __sfr P1SEL
   \                     P1SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf5
   \   unsigned char volatile __sfr P2SEL
   \                     P2SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf6
   \   unsigned char volatile __sfr P1INP
   \                     P1INP:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf7
   \   unsigned char volatile __sfr P2INP
   \                     P2INP:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xff
   \   unsigned char volatile __sfr P2DIR
   \                     P2DIR:
   \   000000                DS 1
     45          #include "OSAL.h"
     46          #include "OnBoard.h"
     47          
     48          #ifdef ZTOOL_PORT
     49            #include "DebugTrace.h"
     50          #endif
     51          
     52          /**************************************************************************************************
     53           *                                          CONSTANTS
     54           **************************************************************************************************/
     55          #define LCD_MAX_BUF 25
     56          
     57          // General I/O definitions
     58          #define IO_GIO  0  // General purpose I/O
     59          #define IO_PER  1  // Peripheral function
     60          #define IO_IN   0  // Input pin
     61          #define IO_OUT  1  // Output pin
     62          #define IO_PUD  0  // Pullup/pulldn input
     63          #define IO_TRI  1  // Tri-state input
     64          #define IO_PUP  0  // Pull-up input pin
     65          #define IO_PDN  1  // Pull-down input pin
     66          
     67          // LCD port/bit definitions
     68          #define LCD_CLK_PORT  2
     69          #define LCD_CLK_PIN   0  // P2_0
     70          #define LCD_DATA_PORT 1
     71          #define LCD_DATA_PIN  2  // P1_2
     72          
     73          /* LCD Line Address */
     74          #define LCD_LINE1_ADDR  0x80
     75          #define LCD_LINE2_ADDR  0xC0
     76          
     77          // LCD device definitions
     78          #define LCD_ADDR  0x76  // SM-Bus address of the LCD controller
     79          #define CH1_ADDR  0x08
     80          #define LCD_RS_0  0x00  // RS = 0 => selects instruction register for write/busy flag
     81          #define LCD_RS_1  0x40  // RS = 1 => selects the data register for both read and write
     82          
     83          /**************************************************************************************************
     84           *                                           MACROS
     85           **************************************************************************************************/
     86          
     87          // Removed to allow PNAME macro to expand -
     88          // Problem: in ioCC2430.h, #define P PSW_bit.P
     89          #undef P
     90          
     91            /* I/O PORT CONFIGURATION */
     92          #define CAT1(x,y) x##y  // Concatenates 2 strings
     93          #define CAT2(x,y) CAT1(x,y)  // Forces evaluation of CAT1
     94          
     95          // LCD port I/O defintions
     96          // Builds I/O port name: PNAME(1,INP) ==> P1INP
     97          #define PNAME(y,z) CAT2(P,CAT2(y,z))
     98          // Builds I/O bit name: BNAME(1,2) ==> P1_2
     99          #define BNAME(port,pin) CAT2(CAT2(P,port),CAT2(_,pin))
    100          
    101          #define LCD_SCL BNAME(LCD_CLK_PORT, LCD_CLK_PIN)
    102          #define LCD_SDA BNAME(LCD_DATA_PORT, LCD_DATA_PIN)
    103          
    104          // LCD port I/O defintions
    105          #define LCD_SCL BNAME(LCD_CLK_PORT, LCD_CLK_PIN)
    106          #define LCD_SDA BNAME(LCD_DATA_PORT, LCD_DATA_PIN)
    107          
    108          #define IO_DIR_PORT_PIN(port, pin, dir) \
    109          {\
    110            if ( dir == IO_OUT ) \
    111              PNAME(port,DIR) |= (1<<(pin)); \
    112            else \
    113              PNAME(port,DIR) &= ~(1<<(pin)); \
    114          }
    115          
    116          #define LCD_DATA_HIGH()\
    117          { \
    118            IO_DIR_PORT_PIN(LCD_DATA_PORT, LCD_DATA_PIN, IO_IN); \
    119          }
    120          
    121          #define LCD_DATA_LOW() \
    122          { \
    123            IO_DIR_PORT_PIN(LCD_DATA_PORT, LCD_DATA_PIN, IO_OUT); \
    124            LCD_SDA = 0;\
    125          }
    126          
    127          #define IO_FUNC_PORT_PIN(port, pin, func) \
    128          { \
    129            if( port < 2 ) \
    130            { \
    131              if ( func == IO_PER ) \
    132                PNAME(port,SEL) |= (1<<(pin)); \
    133              else \
    134                PNAME(port,SEL) &= ~(1<<(pin)); \
    135            } \
    136            else \
    137            { \
    138              if ( func == IO_PER ) \
    139                P2SEL |= (1<<(pin>>1)); \
    140              else \
    141                P2SEL &= ~(1<<(pin>>1)); \
    142            } \
    143          }
    144          
    145          #define IO_IMODE_PORT_PIN(port, pin, mode) \
    146          { \
    147            if ( mode == IO_TRI ) \
    148              PNAME(port,INP) |= (1<<(pin)); \
    149            else \
    150              PNAME(port,INP) &= ~(1<<(pin)); \
    151          }
    152          
    153          #define IO_PUD_PORT(port, dir) \
    154          { \
    155            if ( dir == IO_PDN ) \
    156              P2INP |= (1<<(port+5)); \
    157            else \
    158              P2INP &= ~(1<<(port+5)); \
    159          }
    160          
    161          /**************************************************************************************************
    162           *                                          TYPEDEFS
    163           **************************************************************************************************/
    164          
    165          
    166          /**************************************************************************************************
    167           *                                       GLOBAL VARIABLES
    168           **************************************************************************************************/
    169          #ifdef LCD_HW

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    170          static uint8 *Lcd_Line1;
   \                     Lcd_Line1:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    171          #endif
    172          
    173          /**************************************************************************************************
    174           *                                       FUNCTIONS - API
    175           **************************************************************************************************/
    176          #if (defined LCD_HW) && (HAL_LCD == TRUE)
    177          static void initLcd( void );
    178          static void initSmb( void );
    179          static void lcdUpdateLine( uint8 line, uint8 *pLine );
    180          static byte lcdConvertChar( byte aChar );
    181          static void smbSend( uint8 *buffer, uint8 len );
    182          static bool smbSendByte( uint8 dByte );
    183          static void smbWrite( bool dBit );
    184          static void smbClock( bool dir );
    185          static void smbStart( void );
    186          static void smbStop( void );
    187          static void smbWait( void );
    188          #endif
    189          
    190          /**************************************************************************************************
    191           * @fn      HalLcdInit
    192           *
    193           * @brief   Initilize LCD Service
    194           *
    195           * @param   init - pointer to void that contains the initialized value
    196           *
    197           * @return  None
    198           **************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    199          void HalLcdInit(void)
   \                     HalLcdInit:
    200          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 8
   \   000004   74F8         MOV     A,#-0x8
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    201          #if (HAL_LCD == TRUE)
    202          
    203          #ifdef LCD_HW
    204            Lcd_Line1 = NULL;
   \   000009   90....       MOV     DPTR,#Lcd_Line1
   \   00000C   E4           CLR     A
   \   00000D   F0           MOVX    @DPTR,A
   \   00000E   A3           INC     DPTR
   \   00000F   F0           MOVX    @DPTR,A
    205            initLcd();
   \   000010   53FFFE       ANL     0xff,#0xfe
   \   000013   53FEFB       ANL     0xfe,#0xfb
   \   000016   53F5FE       ANL     0xf5,#0xfe
   \   000019   53F4FB       ANL     0xf4,#0xfb
   \   00001C   53F7FE       ANL     0xf7,#0xfe
   \   00001F   53F6FB       ANL     0xf6,#0xfb
   \   000022   53F77F       ANL     0xf7,#0x7f
   \   000025   53F7BF       ANL     0xf7,#0xbf
   \   000028   7476         MOV     A,#0x76
   \   00002A   85..82       MOV     DPL,?XSP + 0
   \   00002D   85..83       MOV     DPH,?XSP + 1
   \   000030   F0           MOVX    @DPTR,A
   \   000031   7401         MOV     A,#0x1
   \   000033   12....       LCALL   ?XSTACK_DISP0_8
   \   000036   E4           CLR     A
   \   000037   F0           MOVX    @DPTR,A
   \   000038   7402         MOV     A,#0x2
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   740C         MOV     A,#0xc
   \   00003F   F0           MOVX    @DPTR,A
   \   000040   7403         MOV     A,#0x3
   \   000042   12....       LCALL   ?XSTACK_DISP0_8
   \   000045   7421         MOV     A,#0x21
   \   000047   F0           MOVX    @DPTR,A
   \   000048   7404         MOV     A,#0x4
   \   00004A   12....       LCALL   ?XSTACK_DISP0_8
   \   00004D   74A0         MOV     A,#-0x60
   \   00004F   F0           MOVX    @DPTR,A
   \   000050   7405         MOV     A,#0x5
   \   000052   12....       LCALL   ?XSTACK_DISP0_8
   \   000055   7407         MOV     A,#0x7
   \   000057   F0           MOVX    @DPTR,A
   \   000058   7406         MOV     A,#0x6
   \   00005A   12....       LCALL   ?XSTACK_DISP0_8
   \   00005D   7434         MOV     A,#0x34
   \   00005F   F0           MOVX    @DPTR,A
   \   000060   7407         MOV     A,#0x7
   \   000062   12....       LCALL   ?XSTACK_DISP0_8
   \   000065   7401         MOV     A,#0x1
   \   000067   F0           MOVX    @DPTR,A
   \   000068                ; Setup parameters for call to function smbSend
   \   000068   7908         MOV     R1,#0x8
   \   00006A   85..82       MOV     DPL,?XSP + 0
   \   00006D   85..83       MOV     DPH,?XSP + 1
   \   000070   AA82         MOV     R2,DPL
   \   000072   AB83         MOV     R3,DPH
   \   000074   12....       LCALL   ??smbSend?relay
    206          #endif
    207          
    208          #endif /* HAL_LCD */
    209          
    210          }
   \   000077   7408         MOV     A,#0x8
   \   000079   12....       LCALL   ?DEALLOC_XSTACK8
   \   00007C                REQUIRE ?Subroutine12
   \   00007C                REQUIRE P1SEL
   \   00007C                REQUIRE P2SEL
   \   00007C                REQUIRE P1INP
   \   00007C                REQUIRE P2INP
   \   00007C                REQUIRE P1DIR
   \   00007C                REQUIRE P2DIR
   \   00007C                ; // Fall through to label ?Subroutine12

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    211          
    212          /*************************************************************************************************
    213           *                    LCD EMULATION FUNCTIONS
    214           *
    215           * Some evaluation boards are equipped with Liquid Crystal Displays
    216           * (LCD) which may be used to display diagnostic information. These
    217           * functions provide LCD emulation, sending the diagnostic strings
    218           * to Z-Tool via the RS232 serial port. These functions are enabled
    219           * when the "LCD_SUPPORTED" compiler flag is placed in the makefile.
    220           *
    221           * Most applications update both lines (1 and 2) of the LCD whenever
    222           * text is posted to the device. This emulator assumes that line 1 is
    223           * updated first (saved locally) and the formatting and send operation
    224           * is triggered by receipt of line 2. Nothing will be transmitted if
    225           * only line 1 is updated.
    226           *
    227           *************************************************************************************************/
    228          
    229          
    230          /**************************************************************************************************
    231           * @fn      HalLcdWriteString
    232           *
    233           * @brief   Write a string to the LCD
    234           *
    235           * @param   str    - pointer to the string that will be displayed
    236           *          option - display options
    237           *
    238           * @return  None
    239           **************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    240          void HalLcdWriteString ( char *str, uint8 option)
   \                     HalLcdWriteString:
    241          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV     A,#-0x4
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   7402         MOV     A,#0x2
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   EA           MOV     A,R2
   \   000010   F0           MOVX    @DPTR,A
   \   000011   A3           INC     DPTR
   \   000012   EB           MOV     A,R3
   \   000013   F0           MOVX    @DPTR,A
   \   000014   E9           MOV     A,R1
   \   000015   FE           MOV     R6,A
    242          #if (HAL_LCD == TRUE)
    243          
    244          #ifdef LCD_SD
    245            byte x;
    246            byte bln;
    247            byte sln;
    248            char *buf;
    249          
    250            if ( Lcd_Line1 == NULL )
   \   000016   90....       MOV     DPTR,#Lcd_Line1
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   7002         JNZ     ??HalLcdWriteString_0
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \                     ??HalLcdWriteString_0:
   \   00001E   7018         JNZ     ??HalLcdWriteString_1
    251            {
    252              // Set up system start-up message
    253              Lcd_Line1 = osal_mem_alloc( MAX_LCD_CHARS+1 );
   \   000020                ; Setup parameters for call to function osal_mem_alloc
   \   000020   7A11         MOV     R2,#0x11
   \   000022   7B00         MOV     R3,#0x0
   \   000024   12....       LCALL   ??osal_mem_alloc?relay
   \   000027   90....       MOV     DPTR,#Lcd_Line1
   \   00002A   EA           MOV     A,R2
   \   00002B   F0           MOVX    @DPTR,A
   \   00002C   A3           INC     DPTR
   \   00002D   EB           MOV     A,R3
   \   00002E   F0           MOVX    @DPTR,A
    254              HalLcdWriteString( "Figure8 Wireless", HAL_LCD_LINE_1 );
   \   00002F                ; Setup parameters for call to function HalLcdWriteString
   \   00002F   7901         MOV     R1,#0x1
   \   000031   7A..         MOV     R2,#(`?<Constant "Figure8 Wireless">` & 0xff)
   \   000033   7B..         MOV     R3,#((`?<Constant "Figure8 Wireless">` >> 8) & 0xff)
   \   000035   12....       LCALL   ??HalLcdWriteString?relay
    255            }
    256          
    257            sln = (byte)osal_strlen( str );
   \                     ??HalLcdWriteString_1:
   \   000038                ; Setup parameters for call to function osal_strlen
   \   000038   7402         MOV     A,#0x2
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000040   F5..         MOV     ?V0 + 0,A
    258          
    259            // Check boundries
    260            if ( sln > MAX_LCD_CHARS )
   \   000042   C3           CLR     C
   \   000043   9411         SUBB    A,#0x11
   \   000045   4003         JC      ??HalLcdWriteString_2
    261              sln = MAX_LCD_CHARS;
   \   000047   75..10       MOV     ?V0 + 0,#0x10
    262          
    263            if ( option == HAL_LCD_LINE_1 ) {
   \                     ??HalLcdWriteString_2:
   \   00004A   7401         MOV     A,#0x1
   \   00004C   6E           XRL     A,R6
   \   00004D   7025         JNZ     ??HalLcdWriteString_3
    264              // Line 1 gets saved for later
    265              osal_memcpy( Lcd_Line1, str, sln );
   \   00004F                ; Setup parameters for call to function osal_memcpy
   \   00004F   7402         MOV     A,#0x2
   \   000051   12....       LCALL   ?XSTACK_DISP0_8
   \   000054   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000057   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00005A   AC..         MOV     R4,?V0 + 0
   \   00005C   7D00         MOV     R5,#0x0
   \   00005E   90....       MOV     DPTR,#Lcd_Line1
   \   000061   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   000064   12....       LCALL   ?DEALLOC_XSTACK8
    266              Lcd_Line1[sln] = '\0';
   \   000067   A8..         MOV     R0,?V0 + 0
   \   000069   90....       MOV     DPTR,#Lcd_Line1
   \   00006C   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   00006F   E4           CLR     A
   \   000070   F0           MOVX    @DPTR,A
   \   000071   02....       LJMP    ??HalLcdWriteString_4 & 0xFFFF
    267            }
    268            else {
    269              // Line 2 triggers action
    270              x = (byte)osal_strlen( (char*)Lcd_Line1 );
   \                     ??HalLcdWriteString_3:
   \   000074                ; Setup parameters for call to function osal_strlen
   \   000074   90....       MOV     DPTR,#Lcd_Line1
   \   000077   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   00007A   F5..         MOV     ?V0 + 2,A
    271              bln = x + 1 + sln + 1;
    272              buf = osal_mem_alloc( bln );
   \   00007C                ; Setup parameters for call to function osal_mem_alloc
   \   00007C   E5..         MOV     A,?V0 + 0
   \   00007E   25..         ADD     A,?V0 + 2
   \   000080   2402         ADD     A,#0x2
   \   000082   FA           MOV     R2,A
   \   000083   7B00         MOV     R3,#0x0
   \   000085   12....       LCALL   ??osal_mem_alloc?relay
   \   000088   85..82       MOV     DPL,?XSP + 0
   \   00008B   85..83       MOV     DPH,?XSP + 1
   \   00008E   EA           MOV     A,R2
   \   00008F   F0           MOVX    @DPTR,A
   \   000090   A3           INC     DPTR
   \   000091   EB           MOV     A,R3
   \   000092   12....       LCALL   ?Subroutine4 & 0xFFFF
    273              if ( buf != NULL ) {
   \                     ??CrossCallReturnLabel_6:
   \   000095   7002         JNZ     ??HalLcdWriteString_5
   \   000097   A3           INC     DPTR
   \   000098   E0           MOVX    A,@DPTR
   \                     ??HalLcdWriteString_5:
   \   000099   6076         JZ      ??HalLcdWriteString_4
    274                // Concatenate strings
    275                osal_memcpy( buf, Lcd_Line1, x );
   \   00009B                ; Setup parameters for call to function osal_memcpy
   \   00009B   90....       MOV     DPTR,#Lcd_Line1
   \   00009E   12....       LCALL   ?Subroutine0 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   0000A1   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000A4   AC..         MOV     R4,?V0 + 2
   \   0000A6   7D00         MOV     R5,#0x0
   \   0000A8   7403         MOV     A,#0x3
   \   0000AA   12....       LCALL   ?XSTACK_DISP0_8
   \   0000AD   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   0000B0   12....       LCALL   ?DEALLOC_XSTACK8
    276                buf[x++] = ' ';
   \   0000B3   A8..         MOV     R0,?V0 + 2
   \   0000B5   85..82       MOV     DPL,?XSP + 0
   \   0000B8   85..83       MOV     DPH,?XSP + 1
   \   0000BB   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   0000BE   7420         MOV     A,#0x20
   \   0000C0   F0           MOVX    @DPTR,A
   \   0000C1   05..         INC     ?V0 + 2
   \   0000C3                ; Setup parameters for call to function osal_memcpy
   \   0000C3   7402         MOV     A,#0x2
   \   0000C5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C8   E0           MOVX    A,@DPTR
   \   0000C9   F5..         MOV     ?V0 + 4,A
   \   0000CB   A3           INC     DPTR
   \   0000CC   E0           MOVX    A,@DPTR
   \   0000CD   F5..         MOV     ?V0 + 5,A
   \   0000CF   78..         MOV     R0,#?V0 + 4
   \   0000D1   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000D4   AC..         MOV     R4,?V0 + 0
   \   0000D6   7D00         MOV     R5,#0x0
   \   0000D8   A8..         MOV     R0,?V0 + 2
   \   0000DA   7403         MOV     A,#0x3
   \   0000DC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000DF   E0           MOVX    A,@DPTR
   \   0000E0   28           ADD     A,R0
   \   0000E1   FA           MOV     R2,A
   \   0000E2   A3           INC     DPTR
   \   0000E3   E0           MOVX    A,@DPTR
   \   0000E4   3400         ADDC    A,#0x0
   \   0000E6   FB           MOV     R3,A
   \   0000E7   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_23:
   \   0000EA   12....       LCALL   ?DEALLOC_XSTACK8
    277                osal_memcpy( &buf[x], str, sln );
    278                buf[x+sln] = '\0';
   \   0000ED   E5..         MOV     A,?V0 + 0
   \   0000EF   25..         ADD     A,?V0 + 2
   \   0000F1   F8           MOV     R0,A
   \   0000F2   E4           CLR     A
   \   0000F3   3400         ADDC    A,#0x0
   \   0000F5   F9           MOV     R1,A
   \   0000F6   85..82       MOV     DPL,?XSP + 0
   \   0000F9   85..83       MOV     DPH,?XSP + 1
   \   0000FC   E0           MOVX    A,@DPTR
   \   0000FD   28           ADD     A,R0
   \   0000FE   FA           MOV     R2,A
   \   0000FF   A3           INC     DPTR
   \   000100   E0           MOVX    A,@DPTR
   \   000101   39           ADDC    A,R1
   \   000102   8A82         MOV     DPL,R2
   \   000104   F583         MOV     DPH,A
   \   000106   E4           CLR     A
   \   000107   12....       LCALL   ?Subroutine4 & 0xFFFF
    279                // Send it out
    280          #ifdef ZTOOL_PORT
    281                debug_str( (byte*)buf );
    282          #endif
    283                osal_mem_free( buf );
   \                     ??CrossCallReturnLabel_7:
   \   00010A   FA           MOV     R2,A
   \   00010B   A3           INC     DPTR
   \   00010C   E0           MOVX    A,@DPTR
   \   00010D   FB           MOV     R3,A
   \   00010E   12....       LCALL   ??osal_mem_free?relay
    284              }
    285            }
    286          #endif // LCD_SD
    287          
    288          #ifdef LCD_HW
    289            lcdUpdateLine( option, (byte*)str );
   \                     ??HalLcdWriteString_4:
   \   000111                ; Setup parameters for call to function lcdUpdateLine
   \   000111   7402         MOV     A,#0x2
   \   000113   12....       LCALL   ?XSTACK_DISP0_8
   \   000116   E0           MOVX    A,@DPTR
   \   000117   FA           MOV     R2,A
   \   000118   A3           INC     DPTR
   \   000119   E0           MOVX    A,@DPTR
   \   00011A   FB           MOV     R3,A
   \   00011B   EE           MOV     A,R6
   \   00011C   F9           MOV     R1,A
   \   00011D   12....       LCALL   ??lcdUpdateLine?relay
    290          #endif
    291          
    292          #endif /* HAL_LCD */
    293          
    294          }
   \   000120   7404         MOV     A,#0x4
   \   000122   12....       LCALL   ?DEALLOC_XSTACK8
   \   000125   7F07         MOV     R7,#0x7
   \   000127   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function osal_mem_free
   \   000001   85..82       MOV     DPL,?XSP + 0
   \   000004   85..83       MOV     DPH,?XSP + 1
   \   000007   E0           MOVX    A,@DPTR
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FA           MOV     R2,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   FB           MOV     R3,A
   \   000005   12....       LCALL   ??osal_strlen?relay
   \   000008   EA           MOV     A,R2
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FA           MOV     R2,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   FB           MOV     R3,A
   \   000005                REQUIRE ?Subroutine13
   \   000005                ; // Fall through to label ?Subroutine13

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   12....       LCALL   ??osal_memcpy?relay
   \   000003   7403         MOV     A,#0x3
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   28           ADD     A,R0
   \   000002   FA           MOV     R2,A
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   3400         ADDC    A,#0x0
   \   000007   8A82         MOV     DPL,R2
   \   000009   F583         MOV     DPH,A
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F5..         MOV     ?V0 + 4,A
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   F5..         MOV     ?V0 + 5,A
   \   000007   75..00       MOV     ?V0 + 6,#0x0
   \   00000A   78..         MOV     R0,#?V0 + 4
   \   00000C   22           RET
    295          
    296          /**************************************************************************************************
    297           * @fn      HalLcdWriteValue
    298           *
    299           * @brief   Write a value to the LCD
    300           *
    301           * @param   value  - value that will be displayed
    302           *          radix  - 8, 10, 16
    303           *          option - display options
    304           *
    305           * @return  None
    306           **************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    307          void HalLcdWriteValue ( uint32 value, const uint8 radix, uint8 option)
   \                     HalLcdWriteValue:
    308          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 25
   \   000005   74E7         MOV     A,#-0x19
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   7427         MOV     A,#0x27
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   FE           MOV     R6,A
    309          #if (HAL_LCD == TRUE)
    310            uint8 buf[LCD_MAX_BUF];
    311          
    312            _ltoa( value, &buf[0], radix );
   \   000011                ; Setup parameters for call to function _ltoa
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   8582..       MOV     ?V0 + 4,DPL
   \   00001A   8583..       MOV     ?V0 + 5,DPH
   \   00001D   78..         MOV     R0,#?V0 + 4
   \   00001F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000022   12....       LCALL   ??Subroutine6_1 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000025   12....       LCALL   ?DEALLOC_XSTACK8
    313            HalLcdWriteString( (char*)buf, option );
   \   000028                ; Setup parameters for call to function HalLcdWriteString
   \   000028   EE           MOV     A,R6
   \   000029   F9           MOV     R1,A
   \   00002A   02....       LJMP    ?Subroutine15 & 0xFFFF
    314          #endif /* HAL_LCD */
    315          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   A9..         MOV     R1,?V0 + 3
   \   000002   8E..         MOV     ?V0 + 0,R6
   \   000004   8F..         MOV     ?V0 + 1,R7
   \   000006   AA..         MOV     R2,?V0 + 0
   \   000008   AB..         MOV     R3,?V0 + 1
   \                     ??Subroutine6_0:
   \   00000A   7C00         MOV     R4,#0x0
   \   00000C   7D00         MOV     R5,#0x0
   \                     ??Subroutine6_1:
   \   00000E   12....       LCALL   ??_ltoa?relay
   \   000011   7402         MOV     A,#0x2
   \   000013   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   AA82         MOV     R2,DPL
   \   000008   AB83         MOV     R3,DPH
   \   00000A   12....       LCALL   ??HalLcdWriteString?relay
   \   00000D   7419         MOV     A,#0x19
   \   00000F   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??Subroutine15_0:
   \   000012   7F06         MOV     R7,#0x6
   \   000014   02....       LJMP    ?BANKED_LEAVE_XDATA
    316          
    317          /**************************************************************************************************
    318           * @fn      HalLcdWriteScreen
    319           *
    320           * @brief   Write a value to the LCD
    321           *
    322           * @param   line1  - string that will be displayed on line 1
    323           *          line2  - string that will be displayed on line 2
    324           *
    325           * @return  None
    326           **************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    327          void HalLcdWriteScreen( char *line1, char *line2 )
   \                     HalLcdWriteScreen:
    328          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EC           MOV     A,R4
   \   000006   FE           MOV     R6,A
   \   000007   ED           MOV     A,R5
   \   000008   FF           MOV     R7,A
    329          #if (HAL_LCD == TRUE)
    330            HalLcdWriteString( line1, HAL_LCD_LINE_1 );
   \   000009                ; Setup parameters for call to function HalLcdWriteString
   \   000009   7901         MOV     R1,#0x1
   \   00000B   12....       LCALL   ??HalLcdWriteString?relay
    331            HalLcdWriteString( line2, HAL_LCD_LINE_2 );
   \   00000E                ; Setup parameters for call to function HalLcdWriteString
   \   00000E   7902         MOV     R1,#0x2
   \   000010   EE           MOV     A,R6
   \   000011   FA           MOV     R2,A
   \   000012   EF           MOV     A,R7
   \   000013   FB           MOV     R3,A
   \   000014   12....       LCALL   ??HalLcdWriteString?relay
    332          #endif /* HAL_LCD */
    333          }
   \   000017   7F01         MOV     R7,#0x1
   \   000019   02....       LJMP    ?BANKED_LEAVE_XDATA
    334          
    335          /**************************************************************************************************
    336           * @fn      HalLcdWriteStringValue
    337           *
    338           * @brief   Write a string followed by a value to the LCD
    339           *
    340           * @param   title  -
    341           *          value  -
    342           *          format -
    343           *          line   -
    344           *
    345           * @return  None
    346           **************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    347          void HalLcdWriteStringValue( char *title, uint16 value, uint8 format, uint8 line )
   \                     HalLcdWriteStringValue:
    348          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 25
   \   000005   74E7         MOV     A,#-0x19
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   EC           MOV     A,R4
   \   00000F   FE           MOV     R6,A
   \   000010   ED           MOV     A,R5
   \   000011   FF           MOV     R7,A
   \   000012   89..         MOV     ?V0 + 3,R1
   \   000014   7427         MOV     A,#0x27
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   F5..         MOV     ?V0 + 5,A
    349          #if (HAL_LCD == TRUE)
    350            uint8 tmpLen;
    351            uint8 buf[LCD_MAX_BUF];
    352            uint32 err;
    353          
    354            tmpLen = (uint8)osal_strlen( (char*)title );
   \   00001C                ; Setup parameters for call to function osal_strlen
   \   00001C   12....       LCALL   ??osal_strlen?relay
    355            osal_memcpy( buf, title, tmpLen );
   \   00001F                ; Setup parameters for call to function osal_memcpy
   \   00001F   75..00       MOV     ?V0 + 2,#0x0
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000027   EA           MOV     A,R2
   \   000028   F5..         MOV     ?V0 + 0,A
   \   00002A   FC           MOV     R4,A
   \   00002B   7D00         MOV     R5,#0x0
   \   00002D   7403         MOV     A,#0x3
   \   00002F   12....       LCALL   ?XSTACK_DISP0_8
   \   000032   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   000035   12....       LCALL   ?DEALLOC_XSTACK8
    356            buf[tmpLen] = ' ';
   \   000038   12....       LCALL   ?Subroutine5 & 0xFFFF
    357            err = (uint32)(value);
    358            _ltoa( err, &buf[tmpLen+1], format );
   \                     ??CrossCallReturnLabel_8:
   \   00003B                ; Setup parameters for call to function _ltoa
   \   00003B   A3           INC     DPTR
   \   00003C   8582..       MOV     ?V0 + 0,DPL
   \   00003F   8583..       MOV     ?V0 + 1,DPH
   \   000042   78..         MOV     R0,#?V0 + 0
   \   000044   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000047   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   00004A   12....       LCALL   ?DEALLOC_XSTACK8
    359            HalLcdWriteString( (char*)buf, line );		
   \   00004D                ; Setup parameters for call to function HalLcdWriteString
   \   00004D   A9..         MOV     R1,?V0 + 5
   \   00004F   02....       LJMP    ?Subroutine15 & 0xFFFF
    360          #endif /* HAL_LCD */
    361          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   AA82         MOV     R2,DPL
   \   000002   AB83         MOV     R3,DPH
   \   000004   02....       LJMP    ?Subroutine13 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   000003   7420         MOV     A,#0x20
   \   000005   F0           MOVX    @DPTR,A
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   E582         MOV     A,DPL
   \   000008   25..         ADD     A,?V0 + 0
   \   00000A   F582         MOV     DPL,A
   \   00000C   E583         MOV     A,DPH
   \   00000E                REQUIRE ?Subroutine14
   \   00000E                ; // Fall through to label ?Subroutine14

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   22           RET
    362          
    363          /**************************************************************************************************
    364           * @fn      HalLcdWriteStringValue
    365           *
    366           * @brief   Write a string followed by a value to the LCD
    367           *
    368           * @param   title   -
    369           *          value1  -
    370           *          format1 -
    371           *          value2  -
    372           *          format2 -
    373           *          line    -
    374           *
    375           * @return  None
    376           **************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    377          void HalLcdWriteStringValueValue( char *title, uint16 value1, uint8 format1,
   \                     HalLcdWriteStringValueValue:
    378                                            uint16 value2, byte format2, uint8 line )
    379          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 25
   \   000005   74E7         MOV     A,#-0x19
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   \   00000E   EC           MOV     A,R4
   \   00000F   FE           MOV     R6,A
   \   000010   ED           MOV     A,R5
   \   000011   FF           MOV     R7,A
   \   000012   89..         MOV     ?V0 + 3,R1
   \   000014   7429         MOV     A,#0x29
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   F5..         MOV     ?V0 + 6,A
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F5..         MOV     ?V0 + 7,A
    380          #if (HAL_LCD == TRUE)
    381            uint8 tmpLen;
    382            uint8 buf[LCD_MAX_BUF];
    383            uint32 err;
    384          
    385            tmpLen = (uint8)osal_strlen( (char*)title );
   \   000020                ; Setup parameters for call to function osal_strlen
   \   000020   12....       LCALL   ??osal_strlen?relay
   \   000023   EA           MOV     A,R2
   \   000024   F5..         MOV     ?V0 + 4,A
    386            if ( tmpLen )
   \   000026   601E         JZ      ??HalLcdWriteStringValueValue_0
    387            {
    388              osal_memcpy( buf, title, tmpLen );
   \   000028                ; Setup parameters for call to function osal_memcpy
   \   000028   75..00       MOV     ?V0 + 2,#0x0
   \   00002B   78..         MOV     R0,#?V0 + 0
   \   00002D   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000030   EA           MOV     A,R2
   \   000031   F5..         MOV     ?V0 + 0,A
   \   000033   FC           MOV     R4,A
   \   000034   7D00         MOV     R5,#0x0
   \   000036   7403         MOV     A,#0x3
   \   000038   12....       LCALL   ?XSTACK_DISP0_8
   \   00003B   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   00003E   12....       LCALL   ?DEALLOC_XSTACK8
    389              buf[tmpLen++] = ' ';
   \   000041   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000044   05..         INC     ?V0 + 4
    390            }
    391          
    392            err = (uint32)(value1);
    393            _ltoa( err, &buf[tmpLen], format1 );
   \                     ??HalLcdWriteStringValueValue_0:
   \   000046                ; Setup parameters for call to function _ltoa
   \   000046   85..82       MOV     DPL,?XSP + 0
   \   000049   85..83       MOV     DPH,?XSP + 1
   \   00004C   E582         MOV     A,DPL
   \   00004E   25..         ADD     A,?V0 + 4
   \   000050   F5..         MOV     ?V0 + 0,A
   \   000052   E583         MOV     A,DPH
   \   000054   3400         ADDC    A,#0x0
   \   000056   F5..         MOV     ?V0 + 1,A
   \   000058   78..         MOV     R0,#?V0 + 0
   \   00005A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005D   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   000060   12....       LCALL   ?DEALLOC_XSTACK8
    394            tmpLen = (uint8)osal_strlen( (char*)buf );
   \   000063                ; Setup parameters for call to function osal_strlen
   \   000063   85..82       MOV     DPL,?XSP + 0
   \   000066   85..83       MOV     DPH,?XSP + 1
   \   000069   AA82         MOV     R2,DPL
   \   00006B   AB83         MOV     R3,DPH
   \   00006D   12....       LCALL   ??osal_strlen?relay
   \   000070   EA           MOV     A,R2
   \   000071   F5..         MOV     ?V0 + 4,A
    395          
    396            buf[tmpLen++] = ',';
   \   000073   F5..         MOV     ?V0 + 0,A
   \   000075   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   000078   742C         MOV     A,#0x2c
   \   00007A   F0           MOVX    @DPTR,A
   \   00007B   05..         INC     ?V0 + 4
    397            buf[tmpLen++] = ' ';
   \   00007D   85....       MOV     ?V0 + 0,?V0 + 4
   \   000080   12....       LCALL   ?Subroutine5 & 0xFFFF
    398            err = (uint32)(value2);
    399            _ltoa( err, &buf[tmpLen], format2 );
   \                     ??CrossCallReturnLabel_10:
   \   000083                ; Setup parameters for call to function _ltoa
   \   000083   7401         MOV     A,#0x1
   \   000085   25..         ADD     A,?V0 + 4
   \   000087   F8           MOV     R0,A
   \   000088   85..82       MOV     DPL,?XSP + 0
   \   00008B   85..83       MOV     DPH,?XSP + 1
   \   00008E   E582         MOV     A,DPL
   \   000090   28           ADD     A,R0
   \   000091   F5..         MOV     ?V0 + 0,A
   \   000093   E583         MOV     A,DPH
   \   000095   3400         ADDC    A,#0x0
   \   000097   F5..         MOV     ?V0 + 1,A
   \   000099   78..         MOV     R0,#?V0 + 0
   \   00009B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00009E   742D         MOV     A,#0x2d
   \   0000A0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A3   E0           MOVX    A,@DPTR
   \   0000A4   F9           MOV     R1,A
   \   0000A5   AA..         MOV     R2,?V0 + 6
   \   0000A7   AB..         MOV     R3,?V0 + 7
   \   0000A9   12....       LCALL   ??Subroutine6_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   0000AC   12....       LCALL   ?DEALLOC_XSTACK8
    400          
    401            HalLcdWriteString( (char *)buf, line );		
   \   0000AF                ; Setup parameters for call to function HalLcdWriteString
   \   0000AF   742C         MOV     A,#0x2c
   \   0000B1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   F9           MOV     R1,A
   \   0000B6   85..82       MOV     DPL,?XSP + 0
   \   0000B9   85..83       MOV     DPH,?XSP + 1
   \   0000BC   AA82         MOV     R2,DPL
   \   0000BE   AB83         MOV     R3,DPH
   \   0000C0   12....       LCALL   ??HalLcdWriteString?relay
    402          #endif /* HAL_LCD */
    403          }
   \   0000C3   7419         MOV     A,#0x19
   \   0000C5   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000C8   7F08         MOV     R7,#0x8
   \   0000CA   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   000003   22           RET
    404          
    405          /**************************************************************************************************
    406           * @fn      HalLcdDisplayPercentBar
    407           *
    408           * @brief   Display percentage bar on the LCD
    409           *
    410           * @param   title   -
    411           *          value   -
    412           *
    413           * @return  None
    414           **************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    415          void HalLcdDisplayPercentBar( char *title, uint8 value )
   \                     HalLcdDisplayPercentBar:
    416          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    417          #if (HAL_LCD == TRUE)
    418            uint8 percent;
    419            uint8 leftOver;
    420            uint8 buf[17];
    421            uint32 err;
    422            uint8 x;
    423          
    424            /* Write the title: */
    425            HalLcdWriteString( title, HAL_LCD_LINE_1 );
   \   00000C                ; Setup parameters for call to function HalLcdWriteString
   \   00000C   7901         MOV     R1,#0x1
   \   00000E   12....       LCALL   ??HalLcdWriteString?relay
    426          
    427            if ( value > 100 )
   \   000011   EE           MOV     A,R6
   \   000012   C3           CLR     C
   \   000013   9465         SUBB    A,#0x65
   \   000015   4002         JC      ??HalLcdDisplayPercentBar_0
    428              value = 100;
   \   000017   7E64         MOV     R6,#0x64
    429          
    430            /* convert to blocks */
    431            percent = (byte)(value / 10);
   \                     ??HalLcdDisplayPercentBar_0:
   \   000019   75F00A       MOV     B,#0xa
   \   00001C   EE           MOV     A,R6
   \   00001D   84           DIV     AB
   \   00001E   F5..         MOV     ?V0 + 3,A
    432            leftOver = (byte)(value % 10);
   \   000020   EE           MOV     A,R6
   \   000021   75F00A       MOV     B,#0xa
   \   000024   84           DIV     AB
   \   000025   AFF0         MOV     R7,B
    433          
    434            /* Make window */
    435            osal_memcpy( buf, "[          ]  ", 15 );
   \   000027                ; Setup parameters for call to function osal_memcpy
   \   000027   75....       MOV     ?V0 + 0,#(`?<Constant "[          ]  ">` & 0xff)
   \   00002A   75....       MOV     ?V0 + 1,#((`?<Constant "[          ]  ">` >> 8) & 0xff)
   \   00002D   75..00       MOV     ?V0 + 2,#0x0
   \   000030   78..         MOV     R0,#?V0 + 0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000035   7C0F         MOV     R4,#0xf
   \   000037   7D00         MOV     R5,#0x0
   \   000039   7403         MOV     A,#0x3
   \   00003B   12....       LCALL   ?XSTACK_DISP0_8
   \   00003E   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   000041   12....       LCALL   ?DEALLOC_XSTACK8
    436          
    437            for ( x = 0; x < percent; x ++ )
   \   000044   800C         SJMP    ??HalLcdDisplayPercentBar_1
    438            {
    439              buf[1+x] = '>';
   \                     ??HalLcdDisplayPercentBar_2:
   \   000046   85....       MOV     ?V0 + 0,?V0 + 2
   \   000049   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   00004C   A3           INC     DPTR
   \   00004D   743E         MOV     A,#0x3e
   \   00004F   F0           MOVX    @DPTR,A
    440            }
   \   000050   05..         INC     ?V0 + 2
   \                     ??HalLcdDisplayPercentBar_1:
   \   000052   E5..         MOV     A,?V0 + 2
   \   000054   C3           CLR     C
   \   000055   95..         SUBB    A,?V0 + 3
   \   000057   40ED         JC      ??HalLcdDisplayPercentBar_2
    441          
    442            if ( leftOver >= 5 )
   \   000059   EF           MOV     A,R7
   \   00005A   C3           CLR     C
   \   00005B   9405         SUBB    A,#0x5
   \   00005D   4016         JC      ??HalLcdDisplayPercentBar_3
    443              buf[1+x] = '+';
   \   00005F   85..82       MOV     DPL,?XSP + 0
   \   000062   85..83       MOV     DPH,?XSP + 1
   \   000065   E582         MOV     A,DPL
   \   000067   25..         ADD     A,?V0 + 2
   \   000069   F582         MOV     DPL,A
   \   00006B   E583         MOV     A,DPH
   \   00006D   3400         ADDC    A,#0x0
   \   00006F   F583         MOV     DPH,A
   \   000071   A3           INC     DPTR
   \   000072   742B         MOV     A,#0x2b
   \   000074   F0           MOVX    @DPTR,A
    444          
    445            err = (uint32)value;
    446            _ltoa( err, (uint8*)&buf[13], 10 );
   \                     ??HalLcdDisplayPercentBar_3:
   \   000075                ; Setup parameters for call to function _ltoa
   \   000075   740D         MOV     A,#0xd
   \   000077   12....       LCALL   ?XSTACK_DISP0_8
   \   00007A   8582..       MOV     ?V0 + 0,DPL
   \   00007D   8583..       MOV     ?V0 + 1,DPH
   \   000080   78..         MOV     R0,#?V0 + 0
   \   000082   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000085   790A         MOV     R1,#0xa
   \   000087   EE           MOV     A,R6
   \   000088   FA           MOV     R2,A
   \   000089   7B00         MOV     R3,#0x0
   \   00008B   12....       LCALL   ??Subroutine6_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   00008E   12....       LCALL   ?DEALLOC_XSTACK8
    447          
    448            HalLcdWriteString( (char*)buf, HAL_LCD_LINE_2 );
   \   000091                ; Setup parameters for call to function HalLcdWriteString
   \   000091   7902         MOV     R1,#0x2
   \   000093   85..82       MOV     DPL,?XSP + 0
   \   000096   85..83       MOV     DPH,?XSP + 1
   \   000099   AA82         MOV     R2,DPL
   \   00009B   AB83         MOV     R3,DPH
   \   00009D   12....       LCALL   ??HalLcdWriteString?relay
    449          #endif /* HAL_LCD */
    450          }
   \   0000A0   7411         MOV     A,#0x11
   \   0000A2   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000A5   7F04         MOV     R7,#0x4
   \   0000A7   02....       LJMP    ?BANKED_LEAVE_XDATA
    451          
    452          #if (defined LCD_HW) && (HAL_LCD == TRUE)
    453          /*********************************************************************
    454           * @fn      initLcd
    455           * @brief   Initializes LCD I/O bus and LCD device
    456           * @param   void
    457           * @return  void
    458           */
    459          static void initLcd( void )
    460          {
    461            uint8 buffer[8];
    462          
    463            // Initialize the serial I/O bus
    464            initSmb();
    465          
    466            // Load LCD initialization message
    467            buffer[0] = LCD_ADDR;
    468            buffer[1] = LCD_RS_0;  // Instruction Register
    469            buffer[2] = 0x0C;      // Display control         D =  1:      Display On
    470            //                                                C =  0:      Cursor Off
    471            //                                                B =  0:      Cursor character blink off
    472            buffer[3] = 0x21;      // Function set            H =  1:      Use extended instruction set
    473            buffer[4] = 0xA0;      // Set DDRAM address       ADD = 0x20
    474            buffer[5] = 0x07;      // Display configuration   P =  1:      Column data right to left
    475            //                                                Q =  1:      Row data, bottom to top
    476            buffer[6] = 0x34;      // Function set            DL=  0:      4 bits
    477            //                                                M =  1:      2-line by 16 display
    478            //                                                SL=  0:      MUX1:18
    479            //                                                H =  0:      Use basic instruction set
    480            buffer[7] = 0x01;      // Clearing display
    481          
    482            // Send message to LCD device
    483            smbSend( buffer, 8 );
    484          
    485          }
    486          
    487          /*********************************************************************
    488           * @fn      lcdUpdateLine
    489           * @brief   Updates one line of the LCD display
    490           * @param   line - LCD line numberptr to string going to LCD line 1
    491           * @param   p2 - ptr to string going to LCD line 2
    492           * @return  void
    493           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    494          static void lcdUpdateLine( uint8 line, uint8 *pLine )
   \                     lcdUpdateLine:
    495          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    496            uint8 i;
    497            uint8 chr;
    498            uint8 addr;
    499            uint8 *buffer;
    500          
    501            if ( line == HAL_LCD_LINE_1 )
   \   000009   7401         MOV     A,#0x1
   \   00000B   69           XRL     A,R1
   \   00000C   7005         JNZ     ??lcdUpdateLine_0
    502              addr = LCD_LINE1_ADDR;
   \   00000E   75..80       MOV     ?V0 + 4,#-0x80
   \   000011   8003         SJMP    ??lcdUpdateLine_1
    503            else
    504              addr = LCD_LINE2_ADDR;
   \                     ??lcdUpdateLine_0:
   \   000013   75..C0       MOV     ?V0 + 4,#-0x40
    505          
    506            // Get a buffer to work with
    507            buffer = osal_mem_alloc( 2+HAL_LCD_MAX_CHARS );
   \                     ??lcdUpdateLine_1:
   \   000016                ; Setup parameters for call to function osal_mem_alloc
   \   000016   7A12         MOV     R2,#0x12
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   12....       LCALL   ??osal_mem_alloc?relay
   \   00001D   8A..         MOV     ?V0 + 2,R2
   \   00001F   8B..         MOV     ?V0 + 3,R3
   \   000021   AE..         MOV     R6,?V0 + 2
   \   000023   AF..         MOV     R7,?V0 + 3
    508            if ( buffer != NULL )
   \   000025   EE           MOV     A,R6
   \   000026   7001         JNZ     ??lcdUpdateLine_2
   \   000028   EF           MOV     A,R7
   \                     ??lcdUpdateLine_2:
   \   000029   7003         JNZ     $+5
   \   00002B   02....       LJMP    ??lcdUpdateLine_3 & 0xFFFF
    509            {
    510              // Build and send control string
    511              buffer[0] = LCD_ADDR;
   \   00002E   7476         MOV     A,#0x76
   \   000030   8E82         MOV     DPL,R6
   \   000032   8F83         MOV     DPH,R7
   \   000034   F0           MOVX    @DPTR,A
    512              buffer[1] = LCD_RS_0;
   \   000035   A3           INC     DPTR
   \   000036   8582..       MOV     ?V0 + 2,DPL
   \   000039   8583..       MOV     ?V0 + 3,DPH
   \   00003C   E4           CLR     A
   \   00003D   F0           MOVX    @DPTR,A
    513              buffer[2] = addr;
   \   00003E   8E82         MOV     DPL,R6
   \   000040   8F83         MOV     DPH,R7
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   E5..         MOV     A,?V0 + 4
   \   000046   F0           MOVX    @DPTR,A
    514              smbSend( buffer, 3 );
   \   000047                ; Setup parameters for call to function smbSend
   \   000047   7903         MOV     R1,#0x3
   \   000049   12....       LCALL   ??smbSend?relay
    515          
    516              // Build and send message string
    517              buffer[0] = LCD_ADDR;
   \   00004C   7476         MOV     A,#0x76
   \   00004E   8E82         MOV     DPL,R6
   \   000050   8F83         MOV     DPH,R7
   \   000052   F0           MOVX    @DPTR,A
    518              buffer[1] = LCD_RS_1;
   \   000053   7440         MOV     A,#0x40
   \   000055   85..82       MOV     DPL,?V0 + 2
   \   000058   85..83       MOV     DPH,?V0 + 3
   \   00005B   F0           MOVX    @DPTR,A
    519              // Convert and save message bytes
    520              for( i = 2; i < 2+HAL_LCD_MAX_CHARS; i++ )
   \   00005C   75..02       MOV     ?V0 + 2,#0x2
    521              {
    522                chr = *pLine++;
   \                     ??lcdUpdateLine_4:
   \   00005F   85..82       MOV     DPL,?V0 + 0
   \   000062   85..83       MOV     DPH,?V0 + 1
   \   000065   E0           MOVX    A,@DPTR
   \   000066   F5..         MOV     ?V0 + 3,A
   \   000068   A3           INC     DPTR
   \   000069   8582..       MOV     ?V0 + 0,DPL
   \   00006C   8583..       MOV     ?V0 + 1,DPH
    523                if ( chr == '\0' )
   \   00006F   700A         JNZ     ??lcdUpdateLine_5
    524                {
    525                  chr = lcdConvertChar( ' ' );
   \   000071                ; Setup parameters for call to function lcdConvertChar
   \   000071   7920         MOV     R1,#0x20
   \   000073   12....       LCALL   ??lcdConvertChar?relay
   \   000076   E9           MOV     A,R1
   \   000077   F5..         MOV     ?V0 + 3,A
    526                  break;
   \   000079   8015         SJMP    ??lcdUpdateLine_6
    527                }
    528                else
    529                  buffer[i] = lcdConvertChar( chr );
   \                     ??lcdUpdateLine_5:
   \   00007B                ; Setup parameters for call to function lcdConvertChar
   \   00007B   F9           MOV     R1,A
   \   00007C   12....       LCALL   ??lcdConvertChar?relay
   \   00007F   85....       MOV     ?V0 + 4,?V0 + 2
   \   000082   12....       LCALL   ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_26:
   \   000085   E9           MOV     A,R1
   \   000086   F0           MOVX    @DPTR,A
    530              }
   \   000087   05..         INC     ?V0 + 2
   \   000089   E5..         MOV     A,?V0 + 2
   \   00008B   C3           CLR     C
   \   00008C   9412         SUBB    A,#0x12
   \   00008E   40CF         JC      ??lcdUpdateLine_4
    531          
    532              // Fill remainder of line with blanks
    533              for( ; i < 2+HAL_LCD_MAX_CHARS; i++ )
   \                     ??lcdUpdateLine_6:
   \   000090   E5..         MOV     A,?V0 + 2
   \   000092   C3           CLR     C
   \   000093   9412         SUBB    A,#0x12
   \   000095   5014         JNC     ??lcdUpdateLine_7
    534                buffer[i] = chr;
   \   000097   85....       MOV     ?V0 + 0,?V0 + 2
   \   00009A   EE           MOV     A,R6
   \   00009B   25..         ADD     A,?V0 + 0
   \   00009D   F582         MOV     DPL,A
   \   00009F   EF           MOV     A,R7
   \   0000A0   3400         ADDC    A,#0x0
   \   0000A2   F583         MOV     DPH,A
   \   0000A4   E5..         MOV     A,?V0 + 3
   \   0000A6   F0           MOVX    @DPTR,A
   \   0000A7   05..         INC     ?V0 + 2
   \   0000A9   80E5         SJMP    ??lcdUpdateLine_6
    535          
    536              // Put it on the display
    537              smbSend( buffer, 2+HAL_LCD_MAX_CHARS );
   \                     ??lcdUpdateLine_7:
   \   0000AB                ; Setup parameters for call to function smbSend
   \   0000AB   7912         MOV     R1,#0x12
   \   0000AD   EE           MOV     A,R6
   \   0000AE   FA           MOV     R2,A
   \   0000AF   EF           MOV     A,R7
   \   0000B0   FB           MOV     R3,A
   \   0000B1   12....       LCALL   ??smbSend?relay
    538          
    539              // Give back buffer memory
    540              osal_mem_free( buffer );
   \   0000B4                ; Setup parameters for call to function osal_mem_free
   \   0000B4   EE           MOV     A,R6
   \   0000B5   FA           MOV     R2,A
   \   0000B6   EF           MOV     A,R7
   \   0000B7   FB           MOV     R3,A
   \   0000B8   12....       LCALL   ??osal_mem_free?relay
    541            }
    542          }
   \                     ??lcdUpdateLine_3:
   \   0000BB   80..         SJMP    ??Subroutine15_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   EE           MOV     A,R6
   \   000001   25..         ADD     A,?V0 + 4
   \   000003   F582         MOV     DPL,A
   \   000005   EF           MOV     A,R7
   \   000006   02....       LJMP    ?Subroutine14 & 0xFFFF
    543          
    544          /*********************************************************************
    545           * @fn      lcdConvertChar
    546           * @brief   Converts an ASCII character to an LCD character (R sheet)
    547           * @param   aChar - ASCII character
    548           * @return  lChar - LCD character
    549           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    550          static byte lcdConvertChar( byte aChar )
   \                     lcdConvertChar:
    551          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    552            uint8 lChar;
    553          
    554            if ((aChar >= 'a') && (aChar <= 'z'))
   \   000004   E9           MOV     A,R1
   \   000005   C3           CLR     C
   \   000006   9461         SUBB    A,#0x61
   \   000008   E9           MOV     A,R1
   \   000009   400C         JC      ??lcdConvertChar_0
   \   00000B   C3           CLR     C
   \   00000C   947B         SUBB    A,#0x7b
   \   00000E   502B         JNC     ??lcdConvertChar_1
    555              // Lower case
    556              lChar = aChar + ('a' - 0xE1);
   \                     ??lcdConvertChar_2:
   \   000010   7480         MOV     A,#-0x80
   \   000012   29           ADD     A,R1
   \   000013   F9           MOV     R1,A
   \   000014   02....       LJMP    ??lcdConvertChar_3 & 0xFFFF
    557            else if ((aChar >= 'A') && (aChar <= 'Z'))
   \                     ??lcdConvertChar_0:
   \   000017   C3           CLR     C
   \   000018   9441         SUBB    A,#0x41
   \   00001A   E9           MOV     A,R1
   \   00001B   4007         JC      ??lcdConvertChar_4
   \   00001D   C3           CLR     C
   \   00001E   945B         SUBB    A,#0x5b
   \   000020   5019         JNC     ??lcdConvertChar_1
   \   000022   80EC         SJMP    ??lcdConvertChar_2
    558              // Upper case
    559              lChar = aChar + ('A' - 0xC1);
    560            else if (((aChar >= ' ') && (aChar <= '#')) ||
    561                     ((aChar >= '%') && (aChar <= '?')))
   \                     ??lcdConvertChar_4:
   \   000024   C3           CLR     C
   \   000025   9420         SUBB    A,#0x20
   \   000027   4006         JC      ??lcdConvertChar_5
   \   000029   E9           MOV     A,R1
   \   00002A   C3           CLR     C
   \   00002B   9424         SUBB    A,#0x24
   \   00002D   40E1         JC      ??lcdConvertChar_2
   \                     ??lcdConvertChar_5:
   \   00002F   E9           MOV     A,R1
   \   000030   C3           CLR     C
   \   000031   9425         SUBB    A,#0x25
   \   000033   4006         JC      ??lcdConvertChar_1
   \   000035   E9           MOV     A,R1
   \   000036   C3           CLR     C
   \   000037   9440         SUBB    A,#0x40
   \   000039   40D5         JC      ??lcdConvertChar_2
    562              // Sonme symbols
    563              lChar = aChar + (' ' - 0xA0);
    564            else
    565            {
    566              switch ( aChar )
   \                     ??lcdConvertChar_1:
   \   00003B   E9           MOV     A,R1
   \   00003C   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for lcdConvertChar>_0`:
   \   00003F   00           DB        0
   \   000040   10           DB        16
   \   000041   10           DB        16
   \   000042   ....         DW        ??lcdConvertChar_6
   \   000044   11           DB        17
   \   000045   ....         DW        ??lcdConvertChar_7
   \   000047   12           DB        18
   \   000048   ....         DW        ??lcdConvertChar_8
   \   00004A   24           DB        36
   \   00004B   ....         DW        ??lcdConvertChar_9
   \   00004D   40           DB        64
   \   00004E   ....         DW        ??lcdConvertChar_10
   \   000050   5B           DB        91
   \   000051   ....         DW        ??lcdConvertChar_11
   \   000053   5D           DB        93
   \   000054   ....         DW        ??lcdConvertChar_12
   \   000056   5F           DB        95
   \   000057   ....         DW        ??lcdConvertChar_13
   \   000059   A3           DB        163
   \   00005A   ....         DW        ??lcdConvertChar_14
   \   00005C   A7           DB        167
   \   00005D   ....         DW        ??lcdConvertChar_15
   \   00005F   C5           DB        197
   \   000060   ....         DW        ??lcdConvertChar_16
   \   000062   C6           DB        198
   \   000063   ....         DW        ??lcdConvertChar_17
   \   000065   D8           DB        216
   \   000066   ....         DW        ??lcdConvertChar_18
   \   000068   E5           DB        229
   \   000069   ....         DW        ??lcdConvertChar_19
   \   00006B   E6           DB        230
   \   00006C   ....         DW        ??lcdConvertChar_20
   \   00006E   F8           DB        248
   \   00006F   ....         DW        ??lcdConvertChar_21
   \   000071   ....         DW        ??lcdConvertChar_22
    567              {
    568                case '$':
    569                   lChar = 0x82;
   \                     ??lcdConvertChar_9:
   \   000073   7982         MOV     R1,#-0x7e
   \   000075   803E         SJMP    ??lcdConvertChar_3
    570                   break;
    571                case '§':
    572                   lChar = 0xDF;
   \                     ??lcdConvertChar_15:
   \   000077   79DF         MOV     R1,#-0x21
   \   000079   803A         SJMP    ??lcdConvertChar_3
    573                   break;
    574                case '£':
    575                   lChar = 0x81;
   \                     ??lcdConvertChar_14:
   \   00007B   7981         MOV     R1,#-0x7f
   \   00007D   8036         SJMP    ??lcdConvertChar_3
    576                   break;
    577                case '@':
    578                   lChar = 0x80;
   \                     ??lcdConvertChar_10:
   \   00007F   7980         MOV     R1,#-0x80
   \   000081   8032         SJMP    ??lcdConvertChar_3
    579                   break;
    580                case '[':
    581                   lChar = 0x8A;
   \                     ??lcdConvertChar_11:
   \   000083   798A         MOV     R1,#-0x76
   \   000085   802E         SJMP    ??lcdConvertChar_3
    582                   break;
    583                case ']':
    584                   lChar = 0x54;
   \                     ??lcdConvertChar_12:
   \   000087   7954         MOV     R1,#0x54
   \   000089   802A         SJMP    ??lcdConvertChar_3
    585                   break;
    586                case '_':
    587                   lChar = 0x5A;
   \                     ??lcdConvertChar_13:
   \   00008B   795A         MOV     R1,#0x5a
   \   00008D   8026         SJMP    ??lcdConvertChar_3
    588                   break;
    589                case 'æ':
    590                   lChar = 0x9D;
   \                     ??lcdConvertChar_20:
   \   00008F   799D         MOV     R1,#-0x63
   \   000091   8022         SJMP    ??lcdConvertChar_3
    591                   break;
    592                case 'ø':
    593                   lChar = 0x8C;
   \                     ??lcdConvertChar_21:
   \   000093   798C         MOV     R1,#-0x74
   \   000095   801E         SJMP    ??lcdConvertChar_3
    594                   break;
    595                case 'å':
    596                   lChar = 0x8F;
   \                     ??lcdConvertChar_19:
   \   000097   798F         MOV     R1,#-0x71
   \   000099   801A         SJMP    ??lcdConvertChar_3
    597                   break;
    598                case 'Æ':
    599                   lChar = 0x9C;
   \                     ??lcdConvertChar_17:
   \   00009B   799C         MOV     R1,#-0x64
   \   00009D   8016         SJMP    ??lcdConvertChar_3
    600                   break;
    601                case 'Ø':
    602                   lChar = 0x8B;
   \                     ??lcdConvertChar_18:
   \   00009F   798B         MOV     R1,#-0x75
   \   0000A1   8012         SJMP    ??lcdConvertChar_3
    603                   break;
    604                case 'Å':
    605                   lChar = 0x8E;
   \                     ??lcdConvertChar_16:
   \   0000A3   798E         MOV     R1,#-0x72
   \   0000A5   800E         SJMP    ??lcdConvertChar_3
    606                   break;
    607                case 0x10:
    608                   lChar = 0x10;  // Left arrow
   \                     ??lcdConvertChar_6:
   \   0000A7   7910         MOV     R1,#0x10
   \   0000A9   800A         SJMP    ??lcdConvertChar_3
    609                   break;
    610                case 0x11:
    611                   lChar = 0x20;  // Right arrow
   \                     ??lcdConvertChar_7:
   \   0000AB   7920         MOV     R1,#0x20
   \   0000AD   8006         SJMP    ??lcdConvertChar_3
    612                   break;
    613                case 0x12:
    614                   lChar = 0x12;  // Up arrow
   \                     ??lcdConvertChar_8:
   \   0000AF   7912         MOV     R1,#0x12
   \   0000B1   8002         SJMP    ??lcdConvertChar_3
    615                   break;
    616                case 0x13:
    617                   lChar = 0x30;  // Down arrow
   \                     ??lcdConvertChar_22:
   \   0000B3   7930         MOV     R1,#0x30
    618                   break;
    619                default:
    620                   lChar = 0x30;
    621                   break;
    622              }
    623            }
    624          
    625            return ( lChar );
   \                     ??lcdConvertChar_3:
   \   0000B5   02....       LJMP    ?Subroutine12 & 0xFFFF
    626          }
    627          
    628          /*********************************************************************
    629           * @fn      initSmb
    630           * @brief   Initializes two-wire serial I/O bus
    631           * @param   void
    632           * @return  void
    633           */
    634          static void initSmb( void )
    635          {
    636            // Set port pins as inputs
    637            IO_DIR_PORT_PIN( LCD_CLK_PORT, LCD_CLK_PIN, IO_IN );
    638            IO_DIR_PORT_PIN( LCD_DATA_PORT, LCD_DATA_PIN, IO_IN );
    639          
    640            // Set for general I/O operation
    641            IO_FUNC_PORT_PIN( LCD_CLK_PORT, LCD_CLK_PIN, IO_GIO );
    642            IO_FUNC_PORT_PIN( LCD_DATA_PORT, LCD_DATA_PIN, IO_GIO );
    643          
    644            // Set I/O mode for pull-up/pull-down
    645            IO_IMODE_PORT_PIN( LCD_CLK_PORT, LCD_CLK_PIN, IO_PUD );
    646            IO_IMODE_PORT_PIN( LCD_DATA_PORT, LCD_DATA_PIN, IO_PUD );
    647          
    648            // Set pins to pull-up
    649            IO_PUD_PORT( LCD_CLK_PORT, IO_PUP );
    650            IO_PUD_PORT( LCD_DATA_PORT, IO_PUP );
    651          }
    652          
    653          /*********************************************************************
    654           * @fn      smbSend
    655           * @brief   Sends buffer contents to SM-Bus device
    656           * @param   buffer - ptr to buffered data to send
    657           * @param   len - number of bytes in buffer
    658           * @return  void
    659           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    660          static void smbSend( uint8 *buffer, uint8 len )
   \                     smbSend:
    661          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   89..         MOV     ?V0 + 2,R1
    662            uint8 i;
    663          
    664            smbStart();
   \                     ??smbSend_0:
   \   00000B   A2A0         MOV     C,0xa0.0
   \   00000D   50FC         JNC     ??smbSend_0
   \   00000F   A292         MOV     C,0x90.2
   \   000011   50F8         JNC     ??smbSend_0
   \   000013   43FE04       ORL     0xfe,#0x4
   \   000016   C292         CLR     0x90.2
   \   000018                ; Setup parameters for call to function smbWait
   \   000018   12....       LCALL   ??smbWait?relay
   \   00001B                ; Setup parameters for call to function smbClock
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   12....       LCALL   ??smbClock?relay
    665            for ( i = 0; i < len; i++ )
   \   000020   75..00       MOV     ?V0 + 1,#0x0
   \   000023   8027         SJMP    ??smbSend_1
    666            {
    667              while ( !smbSendByte( buffer[i] ) );  // Send until ACK received
   \                     ??smbSend_2:
   \   000025   43FE04       ORL     0xfe,#0x4
   \   000028   C292         CLR     0x90.2
   \                     ??smbSend_3:
   \   00002A                ; Setup parameters for call to function smbClock
   \   00002A   7901         MOV     R1,#0x1
   \   00002C   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   00002F   C3           CLR     C
   \   000030   33           RLC     A
   \   000031   F5..         MOV     ?V0 + 3,A
   \   000033   15..         DEC     ?V0 + 0
   \   000035   E5..         MOV     A,?V0 + 0
   \   000037   7026         JNZ     ??smbSend_4
   \   000039                ; Setup parameters for call to function smbClock
   \   000039   7900         MOV     R1,#0x0
   \   00003B   12....       LCALL   ??smbClock?relay
   \   00003E   53FEFB       ANL     0xfe,#0xfb
   \   000041                ; Setup parameters for call to function smbClock
   \   000041   7901         MOV     R1,#0x1
   \   000043   12....       LCALL   ??smbClock?relay
   \   000046   A292         MOV     C,0x90.2
   \   000048   4009         JC      ??smbSend_5
   \   00004A   05..         INC     ?V0 + 1
   \                     ??smbSend_1:
   \   00004C   E5..         MOV     A,?V0 + 1
   \   00004E   C3           CLR     C
   \   00004F   95..         SUBB    A,?V0 + 2
   \   000051   501A         JNC     ??smbSend_6
   \                     ??smbSend_5:
   \   000053   85....       MOV     ?V0 + 4,?V0 + 1
   \   000056   12....       LCALL   ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_27:
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F5..         MOV     ?V0 + 3,A
   \   00005C   75..08       MOV     ?V0 + 0,#0x8
   \                     ??smbSend_4:
   \   00005F                ; Setup parameters for call to function smbClock
   \   00005F   7900         MOV     R1,#0x0
   \   000061   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   000064   A2E7         MOV     C,0xE0 /* A   */.7
   \   000066   50BD         JNC     ??smbSend_2
   \   000068   53FEFB       ANL     0xfe,#0xfb
   \   00006B   80BD         SJMP    ??smbSend_3
    668            }
   \                     ??smbSend_6:
   \   00006D   A2A0         MOV     C,0xa0.0
   \   00006F   50FC         JNC     ??smbSend_6
   \   000071   A292         MOV     C,0x90.2
   \   000073   40F8         JC      ??smbSend_6
   \   000075                ; Setup parameters for call to function smbClock
   \   000075   7900         MOV     R1,#0x0
   \   000077   12....       LCALL   ??smbClock?relay
   \   00007A   53FEFB       ANL     0xfe,#0xfb
   \   00007D                ; Setup parameters for call to function smbWait
   \   00007D   12....       LCALL   ??smbWait?relay
   \   000080                ; Setup parameters for call to function smbClock
   \   000080   7901         MOV     R1,#0x1
   \   000082   12....       LCALL   ??smbClock?relay
    669            smbStop();
    670          }
   \   000085   02....       LJMP    ??Subroutine15_0 & 0xFFFF
   \   000088                REQUIRE _A_P1
   \   000088                REQUIRE _A_P2
   \   000088                REQUIRE P1DIR

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   12....       LCALL   ??smbClock?relay
   \   000003                ; Setup parameters for call to function smbWait
   \   000003                ; Setup parameters for call to function smbWait
   \   000003   12....       LCALL   ??smbWait?relay
   \   000006   E5..         MOV     A,?V0 + 3
   \   000008   22           RET
    671          
    672          /*********************************************************************
    673           * @fn      smbSendByte
    674           * @brief   Serialize and send one byte to SM-Bus device
    675           * @param   dByte - data byte to send
    676           * @return  ACK status - 0=none, 1=received
    677           */
    678          static bool smbSendByte( uint8 dByte )
    679          {
    680            uint8 i;
    681          
    682            for ( i = 0; i < 8; i++ )
    683            {
    684              // Send the MSB
    685              smbWrite( dByte & 0x80 );
    686              // Next bit into MSB
    687              dByte <<= 1;
    688            }
    689            smbClock( 0 );
    690            LCD_DATA_HIGH();
    691            smbClock( 1 );
    692          
    693            return ( !LCD_SDA );  // Return ACK status
    694          }
    695          
    696          /*********************************************************************
    697           * @fn      smbWrite
    698           * @brief   Send one bit to SM-Bus device
    699           * @param   dBit - data bit to clock onto SM-Bus
    700           * @return  void
    701           */
    702          static void smbWrite( bool dBit )
    703          {
    704            smbClock( 0 );
    705            smbWait();
    706            if ( dBit )
    707            {
    708              LCD_DATA_HIGH();
    709            }
    710            else
    711            {
    712              LCD_DATA_LOW();
    713            }
    714            smbClock( 1 );
    715            smbWait();
    716          }
    717          
    718          /*********************************************************************
    719           * @fn      smbClock
    720           * @brief   Clocks the SM-Bus. If a negative edge is going out, the
    721           *          I/O pin is set as an output and driven low. If a positive
    722           *          edge is going out, the pin is set as an input and the pin
    723           *          pull-up drives the line high. This way, the slave device
    724           *          can hold the node low if longer setup time is desired.
    725           * @param   dir - clock line direction
    726           * @return  void
    727           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    728          static void smbClock( bool dir )
   \                     smbClock:
    729          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    730            if ( dir )
   \   000004   E9           MOV     A,R1
   \   000005   6005         JZ      ??smbClock_0
    731            {
    732              IO_DIR_PORT_PIN( LCD_CLK_PORT, LCD_CLK_PIN, IO_IN );
   \   000007   53FFFE       ANL     0xff,#0xfe
   \   00000A   8005         SJMP    ??smbClock_1
    733            }
    734            else
    735            {
    736              IO_DIR_PORT_PIN( LCD_CLK_PORT, LCD_CLK_PIN, IO_OUT );
   \                     ??smbClock_0:
   \   00000C   43FF01       ORL     0xff,#0x1
    737              LCD_SCL = 0;
   \   00000F   C2A0         CLR     0xa0.0
    738            }
    739            smbWait();
   \                     ??smbClock_1:
   \   000011                ; Setup parameters for call to function smbWait
   \   000011   12....       LCALL   ??smbWait?relay
    740          }
   \   000014   02....       LJMP    ?Subroutine12 & 0xFFFF
   \   000017                REQUIRE _A_P2
   \   000017                REQUIRE P2DIR
    741          
    742          /*********************************************************************
    743           * @fn      smbStart
    744           * @brief   Initiates SM-Bus communication. Makes sure that both the
    745           *          clock and data lines of the SM-Bus are high. Then the data
    746           *          line is set high and clock line is set low to start I/O.
    747           * @param   void
    748           * @return  void
    749           */
    750          static void smbStart( void )
    751          {
    752            // Wait for both clock and data line high
    753            while ( !( LCD_SCL && LCD_SDA) );
    754            LCD_DATA_LOW();
    755            smbWait();
    756            smbClock( 0 );
    757          }
    758          
    759          /*********************************************************************
    760           * @fn      smbStop
    761           * @brief   Terminates SM-Bus communication. Waits unitl the data line
    762           *          is low and the clock line is high. Then sets the data line
    763           *          high, keeping the clock line high to stop I/O.
    764           * @param   void
    765           * @return  void
    766           */
    767          static void smbStop( void )
    768          {
    769            // Wait for clock high and data low
    770            while ( !( LCD_SCL && !LCD_SDA) );
    771            smbClock( 0 );
    772            LCD_DATA_HIGH();
    773            smbWait();
    774            smbClock( 1 );
    775          }
    776          
    777          /*********************************************************************
    778           * @fn      smbWait
    779           * @brief   Wastes a fixed amount of some time.
    780           * @param   void
    781           * @return  void
    782           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    783          static void smbWait( void )
   \                     smbWait:
    784          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    785            uint8 i = 0x01;
   \   000000   7A01         MOV     R2,#0x1
    786            while ( i-- );
   \                     ??smbWait_0:
   \   000002   EA           MOV     A,R2
   \   000003   1A           DEC     R2
   \   000004   70FC         JNZ     ??smbWait_0
    787          }
   \   000006   02....       LJMP    ?BRET

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "Figure8 Wireless"`:
   \   000000   46696775     DB "Figure8 Wireless"
   \            72653820
   \            57697265
   \            6C657373
   \            00      

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for <Constant "[          ]  ">>`:
   \   000000   5B202020     DB "[          ]  "
   \            20202020
   \            2020205D
   \            202000  

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLcdInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLcdInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLcdWriteString?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLcdWriteString

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLcdWriteValue?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLcdWriteValue

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLcdWriteScreen?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLcdWriteScreen

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLcdWriteStringValue?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLcdWriteStringValue

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLcdWriteStringValueValue?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLcdWriteStringValueValue

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??HalLcdDisplayPercentBar?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    HalLcdDisplayPercentBar

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??lcdUpdateLine?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    lcdUpdateLine

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??lcdConvertChar?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    lcdConvertChar

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??smbSend?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    smbSend

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??smbClock?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    smbClock

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??smbWait?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    smbWait

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "Figure8 Wireless">`:
   \   000000                DS 17
   \   000011                REQUIRE `?<Initializer for <Constant "Figure8 Wireless"`
   \   000011                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
   \                     `?<Constant "[          ]  ">`:
   \   000000                DS 15
   \   00000F                REQUIRE `?<Initializer for <Constant "[          ]  ">>`
   \   00000F                REQUIRE __INIT_XDATA_I
    788          #endif // LCD_HW & HAL_LCD
    789          
    790          /**************************************************************************************************
    791          **************************************************************************************************/
    792          
    793          
    794          
    795          

   Maximum stack usage in bytes:

     Function                    ISTACK PSTACK XSTACK
     --------                    ------ ------ ------
     HalLcdDisplayPercentBar         1      0     32
       -> HalLcdWriteString          0      0     58
       -> osal_memcpy                0      0     64
       -> _ltoa                      0      0     62
       -> HalLcdWriteString          0      0     58
     HalLcdInit                      3      0      8
       -> smbSend                    4      0     16
     HalLcdWriteScreen               0      0      9
       -> HalLcdWriteString          0      0     18
       -> HalLcdWriteString          0      0     18
     HalLcdWriteString               1      0     63
       -> osal_mem_alloc             0      0     38
       -> HalLcdWriteString          0      0     38
       -> osal_strlen                0      0     38
       -> osal_memcpy                0      0     44
       -> osal_strlen                0      0     38
       -> osal_mem_alloc             0      0     38
       -> osal_memcpy                0      0     44
       -> osal_memcpy                0      0     44
       -> osal_mem_free              0      0     38
       -> lcdUpdateLine              0      0     38
     HalLcdWriteStringValue          1      0     43
       -> osal_strlen                0      0     78
       -> osal_memcpy                0      0     84
       -> _ltoa                      0      0     82
       -> HalLcdWriteString          0      0     78
     HalLcdWriteStringValueValue     1      0     48
       -> osal_strlen                0      0     82
       -> osal_memcpy                0      0     88
       -> _ltoa                      0      0     86
       -> osal_strlen                0      0     82
       -> _ltoa                      0      0     86
       -> HalLcdWriteString          0      0     82
     HalLcdWriteValue                0      0     42
       -> _ltoa                      0      0     82
       -> HalLcdWriteString          0      0     78
     lcdConvertChar                  2      0     14
     lcdUpdateLine                   1      0     33
       -> osal_mem_alloc             0      0     28
       -> smbSend                    0      0     28
       -> lcdConvertChar             0      0     28
       -> lcdConvertChar             0      0     28
       -> smbSend                    0      0     28
       -> osal_mem_free              0      0     28
     smbClock                        2      0     14
       -> smbWait                    4      0      0
     smbSend                         0      0     28
       -> smbWait                    0      0     28
       -> smbClock                   0      0     28
       -> smbClock                   0      0     28
       -> smbWait                    0      0     28
       -> smbClock                   0      0     28
       -> smbClock                   0      0     28
       -> smbClock                   0      0     28
       -> smbWait                    0      0     28
       -> smbClock                   0      0     28
       -> smbWait                    0      0     28
       -> smbClock                   0      0     28
     smbWait                         0      0     14


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     _A_P1                             1
     _A_P2                             1
     P1SEL                             1
     P2SEL                             1
     P1INP                             1
     P2INP                             1
     P1DIR                             1
     P2DIR                             1
     Lcd_Line1                         2
     HalLcdInit                      124
     ?Subroutine12                     7
     HalLcdWriteString               298
     ?Subroutine4                      9
     ?Subroutine3                     10
     ?Subroutine2                      5
     ?Subroutine13                     6
     ?Subroutine1                     12
     ?Subroutine0                     13
     HalLcdWriteValue                 45
     ?Subroutine6                     20
     ?Subroutine15                    23
     HalLcdWriteScreen                28
     HalLcdWriteStringValue           82
     ?Subroutine8                      7
     ?Subroutine5                      7
     ?Subroutine11                    14
     ?Subroutine14                     5
     HalLcdWriteStringValueValue     205
     ?Subroutine7                      4
     HalLcdDisplayPercentBar         170
     lcdUpdateLine                   189
     ?Subroutine9                      9
     lcdConvertChar                  184
     smbSend                         136
     ?Subroutine10                     9
     smbClock                         23
     smbWait                           9
     ?<Initializer for <Constant "Figure8 Wireless"
                                      17
     ?<Initializer for <Constant "[          ]  ">>
                                      15
     ??HalLcdInit?relay                6
     ??HalLcdWriteString?relay         6
     ??HalLcdWriteValue?relay          6
     ??HalLcdWriteScreen?relay         6
     ??HalLcdWriteStringValue?relay    6
     ??HalLcdWriteStringValueValue?relay
                                       6
     ??HalLcdDisplayPercentBar?relay
                                       6
     ??lcdUpdateLine?relay             6
     ??lcdConvertChar?relay            6
     ??smbSend?relay                   6
     ??smbClock?relay                  6
     ??smbWait?relay                   6
     ?<Constant "Figure8 Wireless">   17
     ?<Constant "[          ]  ">     15

 
 1 653 bytes in segment BANKED_CODE
    72 bytes in segment BANK_RELAYS
     8 bytes in segment SFR_AN
    32 bytes in segment XDATA_I
    32 bytes in segment XDATA_ID
     2 bytes in segment XDATA_Z
 
 1 757 bytes of CODE  memory
     0 bytes of DATA  memory (+ 8 bytes shared)
    34 bytes of XDATA memory

Errors: none
Warnings: none
